!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("video.js"));else if("function"==typeof define&&define.amd)define(["video.js"],e);else{var r,i=e("object"==typeof exports?require("video.js"):t.videojs);for(r in i)("object"==typeof exports?exports:t)[r]=i[r]}}(this,function(r){return a=[function(t,e,r){t.exports=function(r){function i(t){if(a[t])return a[t].exports;var e=a[t]={i:t,l:!1,exports:{}};return r[t].call(e.exports,e,e.exports,i),e.l=!0,e.exports}var a={};return i.m=r,i.c=a,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/dist/",i(i.s=8)}([function(t,e,r){"use strict";function i(){}function a(n){var o=self.console[n];return o?function(){for(var t,e,r=arguments.length,i=Array(r),a=0;a<r;a++)i[a]=arguments[a];i[0]&&(i[0]=(t=n,e=i[0],"["+t+"] > "+e)),o.apply(self.console,i)}:i}r.d(e,"a",function(){return l}),r.d(e,"b",function(){return u});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o={trace:i,debug:i,log:i,warn:i,info:i,error:i},s=o,l=function(t){if(!0===t||"object"===(void 0===t?"undefined":n(t))){!function(e){for(var t=arguments.length,r=Array(1<t?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];r.forEach(function(t){s[t]=e[t]?e[t].bind(e):a(t)})}(t,"debug","log","info","warn","error");try{s.log()}catch(t){s=o}}else s=o},u=s},function(t,e,r){"use strict";e.a={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCH:"hlsLevelSwitch",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCH:"hlsAudioTrackSwitch",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},function(t,e,r){"use strict";r.d(e,"b",function(){return i}),r.d(e,"a",function(){return a});var i={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},a={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"}},function(t,e,r){"use strict";r.d(e,"b",function(){return i});var r=(s.isHeader=function(t,e){return e+10<=t.length&&73===t[e]&&68===t[e+1]&&51===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},s.isFooter=function(t,e){return e+10<=t.length&&51===t[e]&&68===t[e+1]&&73===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},s.getID3Data=function(t,e){for(var r=e,i=0;s.isHeader(t,e);)i+=10,i+=s._readSize(t,e+6),s.isFooter(t,e+10)&&(i+=10),e+=i;if(0<i)return t.subarray(r,r+i)},s._readSize=function(t,e){var r=0,r=(127&t[e])<<21;return r|=(127&t[e+1])<<14,(r|=(127&t[e+2])<<7)|127&t[e+3]},s.getTimeStamp=function(t){for(var e=s.getID3Frames(t),r=0;r<e.length;r++){var i=e[r];if(s.isTimeStampFrame(i))return s._readTimeStamp(i)}},s.isTimeStampFrame=function(t){return t&&"PRIV"===t.key&&"com.apple.streaming.transportStreamTimestamp"===t.info},s._getFrameData=function(t){var e=String.fromCharCode(t[0],t[1],t[2],t[3]),r=s._readSize(t,4);return{type:e,size:r,data:t.subarray(10,10+r)}},s.getID3Frames=function(t){for(var e=0,r=[];s.isHeader(t,e);){for(var i=s._readSize(t,e+6),a=(e+=10)+i;e+8<a;){var n=s._getFrameData(t.subarray(e)),o=s._decodeFrame(n);o&&r.push(o),e+=n.size+10}s.isFooter(t,e)&&(e+=10)}return r},s._decodeFrame=function(t){return"PRIV"===t.type?s._decodePrivFrame(t):"T"===t.type[0]?s._decodeTextFrame(t):"W"===t.type[0]?s._decodeURLFrame(t):void 0},s._readTimeStamp=function(t){if(8===t.data.byteLength){var e=new Uint8Array(t.data),t=1&e[3],e=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return e/=45,t&&(e+=47721858.84),Math.round(e)}},s._decodePrivFrame=function(t){if(!(t.size<2)){var e=s._utf8ArrayToStr(t.data,!0),r=new Uint8Array(t.data.subarray(e.length+1));return{key:t.type,info:e,data:r.buffer}}},s._decodeTextFrame=function(t){if(!(t.size<2)){if("TXXX"===t.type){var e=1,r=s._utf8ArrayToStr(t.data.subarray(1));e+=r.length+1;e=s._utf8ArrayToStr(t.data.subarray(e));return{key:t.type,info:r,data:e}}e=s._utf8ArrayToStr(t.data.subarray(1));return{key:t.type,data:e}}},s._decodeURLFrame=function(t){if("WXXX"===t.type){if(t.size<2)return;var e=1,r=s._utf8ArrayToStr(t.data.subarray(1));e+=r.length+1;e=s._utf8ArrayToStr(t.data.subarray(e));return{key:t.type,info:r,data:e}}e=s._utf8ArrayToStr(t.data);return{key:t.type,data:e}},s._utf8ArrayToStr=function(t){for(var e,r,i=1<arguments.length&&void 0!==arguments[1]&&arguments[1],a=t.length,n=void 0,o="",s=0;s<a;){if(0===(e=t[s++])&&i)return o;if(0!==e&&3!==e)switch(e>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(e);break;case 12:case 13:n=t[s++],o+=String.fromCharCode((31&e)<<6|63&n);break;case 14:n=t[s++],r=t[s++],o+=String.fromCharCode((15&e)<<12|(63&n)<<6|(63&r)<<0)}}return o},s),i=r._utf8ArrayToStr;function s(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s)}e.a=r},function(t,e,r){"use strict";var s=(h.prototype.decrypt=function(t,e){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,t)},h),l=(o.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},o),u=(a.prototype.uint8ArrayToUint32Array_=function(t){for(var e=new DataView(t),r=new Uint32Array(4),i=0;i<4;i++)r[i]=e.getUint32(4*i);return r},a.prototype.initTable=function(){for(var t=this.sBox,e=this.invSBox,r=this.subMix,i=r[0],a=r[1],n=r[2],o=r[3],r=this.invSubMix,s=r[0],l=r[1],u=r[2],d=r[3],h=new Uint32Array(256),c=0,f=0,p=0,p=0;p<256;p++)h[p]=p<128?p<<1:p<<1^283;for(p=0;p<256;p++){var g=f^f<<1^f<<2^f<<3^f<<4;t[c]=g=g>>>8^255&g^99;var y=h[e[g]=c],m=h[y],v=h[m],b=257*h[g]^16843008*g;i[c]=b<<24|b>>>8,a[c]=b<<16|b>>>16,n[c]=b<<8|b>>>24,o[c]=b,s[g]=(b=16843009*v^65537*m^257*y^16843008*c)<<24|b>>>8,l[g]=b<<16|b>>>16,u[g]=b<<8|b>>>24,d[g]=b,c?(c=y^h[h[h[v^y]]],f^=h[h[f]]):c=f=1}},a.prototype.expandKey=function(t){for(var e=this.uint8ArrayToUint32Array_(t),r=!0,i=0;i<e.length&&r;)r=e[i]===this.key[i],i++;if(!r){this.key=e;var a=this.keySize=e.length;if(4!==a&&6!==a&&8!==a)throw new Error("Invalid aes key size="+a);for(var n=this.ksRows=4*(a+6+1),o=void 0,s=void 0,l=this.keySchedule=new Uint32Array(n),u=this.invKeySchedule=new Uint32Array(n),d=this.sBox,h=this.rcon,t=this.invSubMix,c=t[0],f=t[1],p=t[2],g=t[3],y=void 0,m=void 0,o=0;o<n;o++)o<a?y=l[o]=e[o]:(m=y,o%a==0?(m=d[(m=m<<8|m>>>24)>>>24]<<24|d[m>>>16&255]<<16|d[m>>>8&255]<<8|d[255&m],m^=h[o/a|0]<<24):6<a&&o%a==4&&(m=d[m>>>24]<<24|d[m>>>16&255]<<16|d[m>>>8&255]<<8|d[255&m]),l[o]=y=(l[o-a]^m)>>>0);for(s=0;s<n;s++)o=n-s,m=3&s?l[o]:l[o-4],u[s]=s<4||o<=4?m:c[d[m>>>24]]^f[d[m>>>16&255]]^p[d[m>>>8&255]]^g[d[255&m]],u[s]=u[s]>>>0}},a.prototype.networkToHostOrderSwap=function(t){return t<<24|(65280&t)<<8|(16711680&t)>>8|t>>>24},a.prototype.decrypt=function(t,e,r){for(var i,a,n,o,s,l,u=this.keySize+6,d=this.invKeySchedule,h=this.invSBox,c=this.invSubMix,f=c[0],p=c[1],g=c[2],y=c[3],r=this.uint8ArrayToUint32Array_(r),m=r[0],v=r[1],b=r[2],E=r[3],T=new Int32Array(t),R=new Int32Array(T.length),A=void 0,S=void 0,L=void 0,_=void 0,w=void 0,D=void 0,I=void 0,k=void 0,O=this.networkToHostOrderSwap;e<T.length;){for(n=O(T[e]),o=O(T[e+1]),s=O(T[e+2]),l=O(T[e+3]),w=n^d[0],D=l^d[1],I=s^d[2],k=o^d[3],i=4,a=1;a<u;a++)A=f[w>>>24]^p[D>>16&255]^g[I>>8&255]^y[255&k]^d[i],S=f[D>>>24]^p[I>>16&255]^g[k>>8&255]^y[255&w]^d[i+1],L=f[I>>>24]^p[k>>16&255]^g[w>>8&255]^y[255&D]^d[i+2],_=f[k>>>24]^p[w>>16&255]^g[D>>8&255]^y[255&I]^d[i+3],w=A,D=S,I=L,k=_,i+=4;A=h[w>>>24]<<24^h[D>>16&255]<<16^h[I>>8&255]<<8^h[255&k]^d[i],S=h[D>>>24]<<24^h[I>>16&255]<<16^h[k>>8&255]<<8^h[255&w]^d[i+1],L=h[I>>>24]<<24^h[k>>16&255]<<16^h[w>>8&255]<<8^h[255&D]^d[i+2],_=h[k>>>24]<<24^h[w>>16&255]<<16^h[D>>8&255]<<8^h[255&I]^d[i+3],i+=3,R[e]=O(A^m),R[e+1]=O(_^v),R[e+2]=O(L^b),R[e+3]=O(S^E),m=n,v=o,b=s,E=l,e+=4}return R.buffer},a.prototype.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},a),n=r(2),d=r(0),r=(i.prototype.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},i.prototype.decrypt=function(e,r,i,a){var t,n,o=this;this.disableWebCrypto&&this.config.enableSoftwareAES?(this.logEnabled&&(d.b.log("JS AES decrypt"),this.logEnabled=!1),(t=this.decryptor)||(this.decryptor=t=new u),t.expandKey(r),a(t.decrypt(e,0,i))):(this.logEnabled&&(d.b.log("WebCrypto AES decrypt"),this.logEnabled=!1),n=this.subtle,this.key!==r&&(this.key=r,this.fastAesKey=new l(n,r)),this.fastAesKey.expandKey().then(function(t){new s(n,i).decrypt(e,t).catch(function(t){o.onWebCryptoError(t,e,r,i,a)}).then(function(t){a(t)})}).catch(function(t){o.onWebCryptoError(t,e,r,i,a)}))},i.prototype.onWebCryptoError=function(t,e,r,i,a){this.config.enableSoftwareAES?(d.b.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(e,r,i,a)):(d.b.error("decrypting error : "+t.message),this.observer.trigger(Event.ERROR,{type:n.b.MEDIA_ERROR,details:n.a.FRAG_DECRYPT_ERROR,fatal:!0,reason:t.message}))},i.prototype.destroy=function(){var t=this.decryptor;t&&(t.destroy(),this.decryptor=void 0)},i);function i(t,e){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,i),this.observer=t,this.config=e,this.logEnabled=!0;try{var r=crypto||self.crypto;this.subtle=r.subtle||r.webkitSubtle}catch(t){}this.disableWebCrypto=!this.subtle}function a(){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,a),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}function o(t,e){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,o),this.subtle=t,this.key=e}function h(t,e){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,h),this.subtle=t,this.aesIV=e}e.a=r},function(t,e){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function l(t){return"function"==typeof t}function u(t){return"object"==typeof t&&null!==t}function d(t){return void 0===t}((t.exports=i).EventEmitter=i).prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},i.prototype.emit=function(t){var e,r,i,a,n,o;if(this._events||(this._events={}),"error"===t&&(!this._events.error||u(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var s=new Error('Uncaught, unspecified "error" event. ('+e+")");throw s.context=e,s}if(d(r=this._events[t]))return!1;if(l(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),r.apply(this,a)}else if(u(r))for(a=Array.prototype.slice.call(arguments,1),i=(o=r.slice()).length,n=0;n<i;n++)o[n].apply(this,a);return!0},i.prototype.on=i.prototype.addListener=function(t,e){var r;if(!l(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,l(e.listener)?e.listener:e),this._events[t]?u(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,u(this._events[t])&&!this._events[t].warned&&(r=d(this._maxListeners)?i.defaultMaxListeners:this._maxListeners)&&0<r&&this._events[t].length>r&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},i.prototype.once=function(t,e){function r(){this.removeListener(t,r),i||(i=!0,e.apply(this,arguments))}if(!l(e))throw TypeError("listener must be a function");var i=!1;return r.listener=e,this.on(t,r),this},i.prototype.removeListener=function(t,e){var r,i,a,n;if(!l(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(a=(r=this._events[t]).length,i=-1,r===e||l(r.listener)&&r.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(u(r)){for(n=a;0<n--;)if(r[n]===e||r[n].listener&&r[n].listener===e){i=n;break}if(i<0)return this;1===r.length?(r.length=0,delete this._events[t]):r.splice(i,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},i.prototype.removeAllListeners=function(t){var e,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(l(r=this._events[t]))this.removeListener(t,r);else if(r)for(;r.length;)this.removeListener(t,r[r.length-1]);return delete this._events[t],this},i.prototype.listeners=function(t){return this._events&&this._events[t]?l(this._events[t])?[this._events[t]]:this._events[t].slice():[]},i.prototype.listenerCount=function(t){if(this._events){t=this._events[t];if(l(t))return 1;if(t)return t.length}return 0},i.listenerCount=function(t,e){return t.listenerCount(e)}},function(t,e,r){var i,o,s;i=/^((?:[^\/;?#]+:)?)(\/\/[^\/\;?#]*)?(.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,o=/^([^\/;?#]*)(.*)$/,s={buildAbsoluteURL:function(t,e,r){if(r=r||{},t=t.trim(),!(e=e.trim())){if(!r.alwaysNormalize)return t;var i=this.parseURL(t);if(!a)throw new Error("Error trying to parse base URL.");return i.path=s.normalizePath(i.path),s.buildURLFromParts(i)}i=this.parseURL(e);if(!i)throw new Error("Error trying to parse relative URL.");if(i.scheme)return r.alwaysNormalize?(i.path=s.normalizePath(i.path),s.buildURLFromParts(i)):e;var a=this.parseURL(t);if(!a)throw new Error("Error trying to parse base URL.");!a.netLoc&&a.path&&"/"!==a.path[0]&&(n=o.exec(a.path),a.netLoc=n[1],a.path=n[2]),a.netLoc&&!a.path&&(a.path="/");var n,t={scheme:a.scheme,netLoc:i.netLoc,path:null,params:i.params,query:i.query,fragment:i.fragment};return i.netLoc||(t.netLoc=a.netLoc,"/"===i.path[0])||(i.path?(n=(n=a.path).substring(0,n.lastIndexOf("/")+1)+i.path,t.path=s.normalizePath(n)):(t.path=a.path,i.params||(t.params=a.params,i.query||(t.query=a.query)))),null===t.path&&(t.path=r.alwaysNormalize?s.normalizePath(i.path):i.path),s.buildURLFromParts(t)},parseURL:function(t){t=i.exec(t);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(t){for(t=t.split("").reverse().join("").replace(/(?:\/|^)\.(?=\/)/g,"");t.length!==(t=t.replace(/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,"")).length;);return t.split("").reverse().join("")},buildURLFromParts:function(t){return t.scheme+t.netLoc+t.path+t.params+t.query+t.fragment}},t.exports=s},function(t,e,r){"use strict";function i(t,e){return 255===t[e]&&240==(246&t[e+1])}function s(t,e){return 1&t[e+1]?7:9}function l(t,e){return(3&t[e+3])<<11|t[e+4]<<3|(224&t[e+5])>>>5}function p(t,e){return e+1<t.length&&i(t,e)}function g(t,e,r,i,a){var n,o,s,l,u,d;t.samplerate||(n=e,o=r,s=i,l=a,d=navigator.userAgent.toLowerCase(),e=l,r=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],i=1+((192&o[s+2])>>>6),e=(a=(60&o[s+2])>>>2)>r.length-1?void n.trigger(Event.ERROR,{type:K.b.MEDIA_ERROR,details:K.a.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+a}):(n=(1&o[s+2])<<2,n|=(192&o[s+3])>>>6,W.b.log("manifest codec:"+l+",ADTS data:type:"+i+",sampleingIndex:"+a+"["+r[a]+"Hz],channelConfig:"+n),l=/firefox/i.test(d)?6<=a?(i=5,u=new Array(4),a-3):(i=2,u=new Array(2),a):-1!==d.indexOf("android")?(i=2,u=new Array(2),a):(i=5,u=new Array(4),l&&(-1!==l.indexOf("mp4a.40.29")||-1!==l.indexOf("mp4a.40.5"))||!l&&6<=a?a-3:((l&&-1!==l.indexOf("mp4a.40.2")&&(6<=a&&1==n||/vivaldi/i.test(d))||!l&&1==n)&&(i=2,u=new Array(2)),a)),u[0]=i<<3,u[0]|=(14&a)>>1,u[1]|=(1&a)<<7,u[1]|=n<<3,5===i&&(u[1]|=(14&l)>>1,u[2]=(1&l)<<7,u[2]|=8,u[3]=0),{config:u,samplerate:r[a],channelCount:n,codec:"mp4a.40."+i,manifestCodec:e}),t.config=e.config,t.samplerate=e.samplerate,t.channelCount=e.channelCount,t.codec=e.codec,t.manifestCodec=e.manifestCodec,W.b.log("parsed codec:"+t.codec+",rate:"+e.samplerate+",nb channel:"+e.channelCount))}function f(t){return 9216e4/t}function y(t,e,r,i,a){var n=function(t,e,r,i,a){var n=t.length,o=s(t,e),t=l(t,e);if(0<(t-=o)&&e+o+t<=n)return{headerLength:o,frameLength:t,stamp:r+i*a}}(e,r,i,a,f(t.samplerate));if(n){i=n.stamp,a=n.headerLength,n=n.frameLength,i={unit:e.subarray(r+a,r+a+n),pts:i,dts:i};return t.samples.push(i),t.len+=n,{sample:i,length:n+a}}}var H=r(1),K=r(2),m=r(4),W=r(0),v=r(3),A=(F.prototype.resetInitSegment=function(t,e,r,i){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:e,duration:i,inputTimeScale:9e4}},F.prototype.resetTimeStamp=function(){},F.probe=function(t){if(!t)return!1;for(var e=(v.a.getID3Data(t,0)||[]).length,r=t.length;e<r;e++)if(function(t,e){if(e+1<t.length&&i(t,e)){var r=s(t,e),r=e+(r=e+5<t.length?l(t,e):r);if(r===t.length||r+1<t.length&&i(t,r))return 1}}(t,e))return W.b.log("ADTS sync word found !"),!0;return!1},F.prototype.append=function(t,e,r,i){for(var a=this._audioTrack,n=v.a.getID3Data(t,0)||[],o=v.a.getTimeStamp(n),s=o?90*o:9e4*e,l=0,u=s,d=t.length,h=n.length,c=[{pts:u,dts:u,data:n}];h<d-1;)if(p(t,h)&&h+5<d){g(a,this.observer,t,h,a.manifestCodec);var f=y(a,t,h,s,l);if(!f){W.b.log("Unable to parse AAC frame");break}h+=f.length,u=f.sample.pts,l++}else v.a.isHeader(t,h)?(n=v.a.getID3Data(t,h),c.push({pts:u,dts:u,data:n}),h+=n.length):h++;this.remuxer.remux(a,{samples:[]},{samples:c,inputTimeScale:9e4},{samples:[]},e,r,i)},F.prototype.destroy=function(){},F),n=Math.pow(2,32)-1,S=(x.prototype.resetTimeStamp=function(t){this.initPTS=t},x.prototype.resetInitSegment=function(t,e,r,i){var a,n;t&&t.byteLength?(null==e&&(e="mp4a.40.5"),null==r&&(r="avc1.42e01e"),n={},(a=this.initData=x.parseInitSegment(t)).audio&&a.video?n.audiovideo={container:"video/mp4",codec:e+","+r,initSegment:i?t:null}:(a.audio&&(n.audio={container:"audio/mp4",codec:e,initSegment:i?t:null}),a.video&&(n.video={container:"video/mp4",codec:r,initSegment:i?t:null})),this.observer.trigger(H.a.FRAG_PARSING_INIT_SEGMENT,{tracks:n})):(e&&(this.audioCodec=e),r&&(this.videoCodec=r))},x.probe=function(t){return 0<x.findBox({data:t,start:0,end:Math.min(t.length,16384)},["moof"]).length},x.bin2str=function(t){return String.fromCharCode.apply(null,t)},x.readUint32=function(t,e){t.data&&(e+=t.start,t=t.data);e=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3];return e<0?4294967296+e:e},x.writeUint32=function(t,e,r){t.data&&(e+=t.start,t=t.data),t[e]=r>>24,t[e+1]=r>>16&255,t[e+2]=r>>8&255,t[e+3]=255&r},x.findBox=function(t,e){var r,i,a,n,o,s=[];if(t.data?(n=t.start,i=t.end,t=t.data):(n=0,i=t.byteLength),!e.length)return null;for(r=n;r<i;)o=1<(a=x.readUint32(t,r))?r+a:i,x.bin2str(t.subarray(r+4,r+8))===e[0]&&(1===e.length?s.push({data:t,start:r+8,end:o}):(a=x.findBox({data:t,start:r+8,end:o},e.slice(1))).length&&(s=s.concat(a))),r=o;return s},x.parseInitSegment=function(t){var a=[];return x.findBox(t,["moov","trak"]).forEach(function(t){var e,r,i=x.findBox(t,["tkhd"])[0];i&&(r=i.data[i.start],e=x.readUint32(i,0===r?12:20),(i=x.findBox(t,["mdia","mdhd"])[0])&&(r=i.data[i.start],i=x.readUint32(i,0===r?12:20),!(r=x.findBox(t,["mdia","hdlr"])[0])||(r={soun:"audio",vide:"video"}[x.bin2str(r.data.subarray(r.start+8,r.start+12))])&&((t=x.findBox(t,["mdia","minf","stbl","stsd"])).length&&(t=t[0],t=x.bin2str(t.data.subarray(t.start+12,t.start+16)),W.b.log("MP4Demuxer:"+r+":"+t+" found")),a[e]={timescale:i,type:r},a[r]={timescale:i,id:e})))}),a},x.getStartDTS=function(r,t){var t=x.findBox(t,["moof","traf"]),t=[].concat.apply([],t.map(function(e){return x.findBox(e,["tfhd"]).map(function(t){var t=x.readUint32(t,4),t=r[t].timescale||9e4;return x.findBox(e,["tfdt"]).map(function(t){var e=t.data[t.start],r=x.readUint32(t,4);return 1===e&&(r*=Math.pow(2,32),r+=x.readUint32(t,8)),r})[0]/t})})),t=Math.min.apply(null,t);return isFinite(t)?t:0},x.offsetStartDTS=function(r,t,a){x.findBox(t,["moof","traf"]).map(function(e){return x.findBox(e,["tfhd"]).map(function(t){var t=x.readUint32(t,4),i=r[t].timescale||9e4;x.findBox(e,["tfdt"]).map(function(t){var e=t.data[t.start],r=x.readUint32(t,4);0===e?x.writeUint32(t,4,r-a*i):(r*=Math.pow(2,32),r+=x.readUint32(t,8),r-=a*i,r=Math.max(r,0),e=Math.floor(r/(1+n)),r=Math.floor(r%(1+n)),x.writeUint32(t,4,e),x.writeUint32(t,8,r))})})})},x.prototype.append=function(t,e,r,i){var a=this.initData;a||(this.resetInitSegment(t,this.audioCodec,this.videoCodec),a=this.initData);var n,o,s=this.initPTS;void 0===s&&(o=x.getStartDTS(a,t),this.initPTS=s=o-e,this.observer.trigger(H.a.INIT_PTS_FOUND,{initPTS:s})),x.offsetStartDTS(a,t,s),n=x.getStartDTS(a,t),this.remuxer.remux(a.audio,a.video,null,null,n,r,i,t)},x.prototype.destroy=function(){},x),u={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(t,e,r,i,a){if(!(r+24>e.length)){var n=this.parseHeader(e,r);if(n&&r+n.frameLength<=e.length){a=i+a*(9e4*n.samplesPerFrame/n.sampleRate),a={unit:e.subarray(r,r+n.frameLength),pts:a,dts:a};return t.config=[],t.channelCount=n.channelCount,t.samplerate=n.sampleRate,t.samples.push(a),t.len+=n.frameLength,{sample:a,length:n.frameLength}}}},parseHeader:function(t,e){var r=t[e+1]>>3&3,i=t[e+1]>>1&3,a=t[e+2]>>4&15,n=t[e+2]>>2&3,o=t[e+2]>>1&1;if(1!=r&&0!=a&&15!=a&&3!=n){a=1e3*u.BitratesMap[14*(3==r?3-i:3==i?3:4)+a-1],n=u.SamplingRateMap[3*(3==r?0:2==r?1:2)+n],t=t[e+3]>>6==3?1:2,e=u.SamplesCoefficients[r][i],r=u.BytesInSlot[i],i=8*e*r;return{sampleRate:n,channelCount:t,frameLength:parseInt(e*a/n+o,10)*r,samplesPerFrame:i}}},isHeaderPattern:function(t,e){return 255===t[e]&&224==(224&t[e+1])&&0!=(6&t[e+1])},isHeader:function(t,e){return!!(e+1<t.length&&this.isHeaderPattern(t,e))},probe:function(t,e){if(e+1<t.length&&this.isHeaderPattern(t,e)){var r=this.parseHeader(t,e),i=4,i=e+(i=r&&r.frameLength?r.frameLength:i);if(i===t.length||i+1<t.length&&this.isHeaderPattern(t,i))return!0}return!1}},b=u,L=(P.prototype.loadWord=function(){var t=this.data,e=this.bytesAvailable,r=t.byteLength-e,i=new Uint8Array(4),e=Math.min(4,e);if(0===e)throw new Error("no bytes available");i.set(t.subarray(r,r+e)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*e,this.bytesAvailable-=e},P.prototype.skipBits=function(t){var e;this.bitsAvailable>t||(t-=this.bitsAvailable,t-=(e=t>>3)>>3,this.bytesAvailable-=e,this.loadWord()),this.word<<=t,this.bitsAvailable-=t},P.prototype.readBits=function(t){var e=Math.min(this.bitsAvailable,t),r=this.word>>>32-e;return 32<t&&W.b.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,0<this.bitsAvailable?this.word<<=e:0<this.bytesAvailable&&this.loadWord(),0<(e=t-e)&&this.bitsAvailable?r<<e|this.readBits(e):r},P.prototype.skipLZ=function(){for(var t=0;t<this.bitsAvailable;++t)if(0!=(this.word&2147483648>>>t))return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()},P.prototype.skipUEG=function(){this.skipBits(1+this.skipLZ())},P.prototype.skipEG=function(){this.skipBits(1+this.skipLZ())},P.prototype.readUEG=function(){var t=this.skipLZ();return this.readBits(t+1)-1},P.prototype.readEG=function(){var t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)},P.prototype.readBoolean=function(){return 1===this.readBits(1)},P.prototype.readUByte=function(){return this.readBits(8)},P.prototype.readUShort=function(){return this.readBits(16)},P.prototype.readUInt=function(){return this.readBits(32)},P.prototype.skipScalingList=function(t){for(var e=8,r=8,i=0;i<t;i++)e=0===(r=0!==r?(e+this.readEG()+256)%256:r)?e:r},P.prototype.readSPS=function(){var t,e,r,i,a=0,n=0,o=0,s=0,l=this.readUByte.bind(this),u=this.readBits.bind(this),d=this.readUEG.bind(this),h=this.readBoolean.bind(this),c=this.skipBits.bind(this),f=this.skipEG.bind(this),p=this.skipUEG.bind(this),g=this.skipScalingList.bind(this);if(l(),t=l(),u(5),c(3),l(),p(),100===t||110===t||122===t||244===t||44===t||83===t||86===t||118===t||128===t){var y=d();if(3===y&&c(1),p(),p(),c(1),h())for(r=3!==y?8:12,i=0;i<r;i++)h()&&g(i<6?16:64)}p();var y=d();if(0===y)d();else if(1===y)for(c(1),f(),f(),e=d(),i=0;i<e;i++)f();p(),c(1),y=d(),p=d(),0===(u=u(1))&&c(1),c(1),h()&&(a=d(),n=d(),o=d(),s=d());var m=[1,1];if(h()&&h())switch(l()){case 1:m=[1,1];break;case 2:m=[12,11];break;case 3:m=[10,11];break;case 4:m=[16,11];break;case 5:m=[40,33];break;case 6:m=[24,11];break;case 7:m=[20,11];break;case 8:m=[32,11];break;case 9:m=[80,33];break;case 10:m=[18,11];break;case 11:m=[15,11];break;case 12:m=[64,33];break;case 13:m=[160,99];break;case 14:m=[4,3];break;case 15:m=[3,2];break;case 16:m=[2,1];break;case 255:m=[l()<<8|l(),l()<<8|l()]}return{width:Math.ceil(16*(y+1)-2*a-2*n),height:(2-u)*(p+1)*16-(u?2:4)*(o+s),pixelRatio:m}},P.prototype.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},P),a=(C.prototype.decryptBuffer=function(t,e){this.decrypter.decrypt(t,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,e)},C.prototype.decryptAacSample=function(e,r,i,a){var n=e[r].unit,t=n.subarray(16,n.length-n.length%16),t=t.buffer.slice(t.byteOffset,t.byteOffset+t.length),o=this;this.decryptBuffer(t,function(t){t=new Uint8Array(t),n.set(t,16),a||o.decryptAacSamples(e,r+1,i)})},C.prototype.decryptAacSamples=function(t,e,r){for(;;e++){if(e>=t.length)return void r();if(!(t[e].unit.length<32)){var i=this.decrypter.isSync();if(this.decryptAacSample(t,e,r,i),!i)return}}},C.prototype.getAvcEncryptedData=function(t){for(var e=16*Math.floor((t.length-48)/160)+16,r=new Int8Array(e),i=0,a=32;a<=t.length-16;a+=160,i+=16)r.set(t.subarray(a,a+16),i);return r},C.prototype.getAvcDecryptedUnit=function(t,e){e=new Uint8Array(e);for(var r=0,i=32;i<=t.length-16;i+=160,r+=16)t.set(e.subarray(r,r+16),i);return t},C.prototype.decryptAvcSample=function(e,r,i,a,n,o){var s=this.discardEPB(n.data),t=this.getAvcEncryptedData(s),l=this;this.decryptBuffer(t.buffer,function(t){n.data=l.getAvcDecryptedUnit(s,t),o||l.decryptAvcSamples(e,r,i+1,a)})},C.prototype.decryptAvcSamples=function(t,e,r,i){for(;;e++,r=0){if(e>=t.length)return void i();for(var a=t[e].units;!(r>=a.length);r++){var n=a[r];if(!(n.length<=48||1!==n.type&&5!==n.type)){var o=this.decrypter.isSync();if(this.decryptAvcSample(t,e,r,i,n,o),!o)return}}}},C),o={video:0,audio:1,id3:2,text:3},_=(O.prototype.setDecryptData=function(t){null!=t&&null!=t.key&&"SAMPLE-AES"===t.method?this.sampleAes=new a(this.observer,this.config,t,this.discardEPB):this.sampleAes=null},O.probe=function(t){t=O._syncOffset(t);return!(t<0||(t&&W.b.warn("MPEG2-TS detected but first sync word found @ offset "+t+", junk ahead ?"),0))},O._syncOffset=function(t){for(var e=Math.min(1e3,t.length-564),r=0;r<e;){if(71===t[r]&&71===t[r+188]&&71===t[r+376])return r;r++}return-1},O.createTrack=function(t,e){return{container:"video"===t||"audio"===t?"video/mp2t":void 0,type:t,id:o[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:"video"===t?0:void 0,isAAC:"audio"===t||void 0,duration:"audio"===t?e:void 0}},O.prototype.resetInitSegment=function(t,e,r,i){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=O.createTrack("video",i),this._audioTrack=O.createTrack("audio",i),this._id3Track=O.createTrack("id3",i),this._txtTrack=O.createTrack("text",i),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=e,this.videoCodec=r,this._duration=i},O.prototype.resetTimeStamp=function(){},O.prototype.append=function(t,e,r,i){var a,n,o,s,l,u=t.length,d=!1;this.contiguous=r;var h=this.pmtParsed,c=this._avcTrack,f=this._audioTrack,p=this._id3Track,g=c.pid,y=f.pid,m=p.pid,v=this._pmtId,b=c.pesData,E=f.pesData,T=p.pesData,R=this._parsePAT,A=this._parsePMT,S=this._parsePES,L=this._parseAVCPES.bind(this),_=this._parseAACPES.bind(this),w=this._parseMPEGPES.bind(this),D=this._parseID3PES.bind(this),I=O._syncOffset(t);for(u-=(u+I)%188,a=I;a<u;a+=188)if(71===t[a]){if(n=!!(64&t[a+1]),o=((31&t[a+1])<<8)+t[a+2],1<(48&t[a+3])>>4){if((s=a+5+t[a+4])===a+188)continue}else s=a+4;switch(o){case g:n&&(b&&(l=S(b))&&L(l,!1),b={data:[],size:0}),b&&(b.data.push(t.subarray(s,a+188)),b.size+=a+188-s);break;case y:n&&(E&&(l=S(E))&&(f.isAAC?_:w)(l),E={data:[],size:0}),E&&(E.data.push(t.subarray(s,a+188)),E.size+=a+188-s);break;case m:n&&(T&&(l=S(T))&&D(l),T={data:[],size:0}),T&&(T.data.push(t.subarray(s,a+188)),T.size+=a+188-s);break;case 0:n&&(s+=t[s]+1),v=this._pmtId=R(t,s);break;case v:n&&(s+=t[s]+1);var k=A(t,s,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);0<(g=k.avc)&&(c.pid=g),0<(y=k.audio)&&(f.pid=y,f.isAAC=k.isAAC),0<(m=k.id3)&&(p.pid=m),d&&!h&&(W.b.log("reparse from beginning"),d=!1,a=I-188),h=this.pmtParsed=!0;break;case 17:case 8191:break;default:d=!0}}else this.observer.trigger(H.a.ERROR,{type:K.b.MEDIA_ERROR,details:K.a.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});b&&(l=S(b))?(L(l,!0),c.pesData=null):c.pesData=b,E&&(l=S(E))?((f.isAAC?_:w)(l),f.pesData=null):(E&&E.size&&W.b.log("last AAC PES packet truncated,might overlap between fragments"),f.pesData=E),T&&(l=S(T))?(D(l),p.pesData=null):p.pesData=T,null==this.sampleAes?this.remuxer.remux(f,c,p,this._txtTrack,e,r,i):this.decryptAndRemux(f,c,p,this._txtTrack,e,r,i)},O.prototype.decryptAndRemux=function(t,e,r,i,a,n,o){var s;t.samples&&t.isAAC?(s=this).sampleAes.decryptAacSamples(t.samples,0,function(){s.decryptAndRemuxAvc(t,e,r,i,a,n,o)}):this.decryptAndRemuxAvc(t,e,r,i,a,n,o)},O.prototype.decryptAndRemuxAvc=function(t,e,r,i,a,n,o){var s;e.samples?(s=this).sampleAes.decryptAvcSamples(e.samples,0,0,function(){s.remuxer.remux(t,e,r,i,a,n,o)}):this.remuxer.remux(t,e,r,i,a,n,o)},O.prototype.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},O.prototype._parsePAT=function(t,e){return(31&t[e+10])<<8|t[e+11]},O.prototype._parsePMT=function(t,e,r,i){var a,n={audio:-1,avc:-1,id3:-1,isAAC:!0},o=e+3+((15&t[e+1])<<8|t[e+2])-4;for(e+=12+((15&t[e+10])<<8|t[e+11]);e<o;){switch(a=(31&t[e+1])<<8|t[e+2],t[e]){case 207:if(!i){W.b.log("unkown stream type:"+t[e]);break}case 15:-1===n.audio&&(n.audio=a);break;case 21:-1===n.id3&&(n.id3=a);break;case 219:if(!i){W.b.log("unkown stream type:"+t[e]);break}case 27:-1===n.avc&&(n.avc=a);break;case 3:case 4:r?-1===n.audio&&(n.audio=a,n.isAAC=!1):W.b.log("MPEG audio found, not supported in this browser for now");break;case 36:W.b.warn("HEVC stream type found, not supported for now");break;default:W.b.log("unkown stream type:"+t[e])}e+=5+((15&t[e+3])<<8|t[e+4])}return n},O.prototype._parsePES=function(t){var e,r,i,a,n,o=0,s=t.data;if(!t||0===t.size)return null;for(;s[0].length<19&&1<s.length;){var l=new Uint8Array(s[0].length+s[1].length);l.set(s[0]),l.set(s[1],s[0].length),s[0]=l,s.splice(1,1)}if(1!==((c=s[0])[0]<<16)+(c[1]<<8)+c[2])return null;if((e=(c[4]<<8)+c[5])&&e>t.size-6)return null;192&(r=c[7])&&(4294967295<(i=536870912*(14&c[9])+4194304*(255&c[10])+16384*(254&c[11])+128*(255&c[12])+(254&c[13])/2)&&(i-=8589934592),64&r?(4294967295<(a=536870912*(14&c[14])+4194304*(255&c[15])+16384*(254&c[16])+128*(255&c[17])+(254&c[18])/2)&&(a-=8589934592),54e5<i-a&&(W.b.warn(Math.round((i-a)/9e4)+"s delta between PTS and DTS, align them"),i=a)):a=i),r=c[8],t.size-=n=r+9;for(var u=new Uint8Array(t.size),d=0,h=s.length;d<h;d++){var c,f=(c=s[d]).byteLength;if(n){if(f<n){n-=f;continue}c=c.subarray(n),f-=n,n=0}u.set(c,o),o+=f}return e&&(e-=r+3),{data:u,pts:i,dts:a,len:e}},O.prototype.pushAccesUnit=function(t,e){var r,i;t.units.length&&t.frame&&(i=(r=e.samples).length,!this.config.forceKeyFrameOnDiscontinuity||!0===t.key||e.sps&&(i||this.contiguous)?(t.id=i,r.push(t)):e.dropped++),t.debug.length&&W.b.log(t.pts+"/"+t.dts+":"+t.debug)},O.prototype._parseAVCPES=function(f,t){function p(t,e,r,i){return{key:t,pts:e,dts:r,units:[],debug:i}}var g,y,m,v=this,b=this._avcTrack,e=this._parseAVCNALu(f.data),E=this.avcSample,T=!1,R=this.pushAccesUnit.bind(this);f.data=null,E&&e.length&&!b.audFound&&(R(E,b),E=this.avcSample=p(!1,f.pts,f.dts,"")),e.forEach(function(t){switch(t.type){case 1:y=!0,(E=E||(v.avcSample=p(!0,f.pts,f.dts,""))).frame=!0;var e=t.data;T&&4<e.length&&(2!==(u=new L(e).readSliceType())&&4!==u&&7!==u&&9!==u||(E.key=!0));break;case 5:y=!0,(E=E||(v.avcSample=p(!0,f.pts,f.dts,""))).key=!0,E.frame=!0;break;case 6:y=!0,(g=new L(v.discardEPB(t.data))).readUByte();for(var r=0,i=0,a=!1,n=0;!a&&1<g.bytesAvailable;){for(r=0;r+=n=g.readUByte(),255===n;);for(i=0;i+=n=g.readUByte(),255===n;);if(4===r&&0!==g.bytesAvailable){if(a=!0,181===g.readUByte()&&49===g.readUShort()&&1195456820===g.readUInt()&&3===g.readUByte()){var o=g.readUByte(),s=31&o,l=[o,g.readUByte()];for(m=0;m<s;m++)l.push(g.readUByte()),l.push(g.readUByte()),l.push(g.readUByte());v._insertSampleInOrder(v._txtTrack.samples,{type:3,pts:f.pts,bytes:l})}}else if(i<g.bytesAvailable)for(m=0;m<i;m++)g.readUByte()}break;case 7:if(T=y=!0,!b.sps){var u=(g=new L(t.data)).readSPS();b.width=u.width,b.height=u.height,b.pixelRatio=u.pixelRatio,b.sps=[t.data],b.duration=v._duration;var d=t.data.subarray(1,4),h="avc1.";for(m=0;m<3;m++){var c=d[m].toString(16);h+=c=c.length<2?"0"+c:c}b.codec=h}break;case 8:y=!0,b.pps||(b.pps=[t.data]);break;case 9:y=!1,b.audFound=!0,E&&R(E,b),E=v.avcSample=p(!1,f.pts,f.dts,"");break;case 12:y=!1;break;default:y=!1,E&&(E.debug+="unknown NAL "+t.type+" ")}E&&y&&E.units.push(t)}),t&&E&&(R(E,b),this.avcSample=null)},O.prototype._insertSampleInOrder=function(t,e){var r=t.length;if(0<r){if(e.pts>=t[r-1].pts)t.push(e);else for(var i=r-1;0<=i;i--)if(e.pts<t[i].pts){t.splice(i,0,e);break}}else t.push(e)},O.prototype._getLastNalUnit=function(){var t,e=this.avcSample,r=void 0;return r=(e=!e||0===e.units.length?(t=this._avcTrack.samples)[t.length-1]:e)?(e=e.units)[e.length-1]:r},O.prototype._parseAVCNALu=function(t){var e,r,i,a,n,o,s,l,u=0,d=t.byteLength,h=this._avcTrack,c=h.naluState||0,f=c,p=[],g=-1;for(-1===c&&(a=31&t[g=0],c=0,u=1);u<d;)e=t[u++],c=c?1!==c?e?1===e?(0<=g?(i={data:t.subarray(g,u-c-1),type:a},p.push(i)):(n=this._getLastNalUnit())&&(f&&u<=4-f&&n.state&&(n.data=n.data.subarray(0,n.data.byteLength-f)),0<(r=u-c-1))&&((o=new Uint8Array(n.data.byteLength+r)).set(n.data,0),o.set(t.subarray(0,r),n.data.byteLength),n.data=o),u<d?(a=31&t[g=u],0):-1):0:3:e?0:2:e?0:1;return 0<=g&&0<=c&&(i={data:t.subarray(g,d),type:a,state:c},p.push(i)),0===p.length&&(s=this._getLastNalUnit())&&((l=new Uint8Array(s.data.byteLength+t.byteLength)).set(s.data,0),l.set(t,s.data.byteLength),s.data=l),h.naluState=c,p},O.prototype.discardEPB=function(t){for(var e=t.byteLength,r=[],i=1;i<e-2;)0===t[i]&&0===t[i+1]&&3===t[i+2]?(r.push(i+2),i+=2):i++;if(0===r.length)return t;for(var a=e-r.length,n=new Uint8Array(a),o=0,i=0;i<a;o++,i++)o===r[0]&&(o++,r.shift()),n[i]=t[o];return n},O.prototype._parseAACPES=function(t){var e,r,i,a,n=this._audioTrack,o=t.data,s=t.pts,l=this.aacOverFlow,u=this.aacLastPTS;for(l&&((t=new Uint8Array(l.byteLength+o.byteLength)).set(l,0),t.set(o,l.byteLength),o=t),r=0,a=o.length;r<a-1&&!p(o,r);r++);if(r){var d,h=r<a-1?(d="AAC PES did not start with ADTS header,offset:"+r,!1):(d="no ADTS header found in AAC PES",!0);if(W.b.warn("parsing error:"+d),this.observer.trigger(H.a.ERROR,{type:K.b.MEDIA_ERROR,details:K.a.FRAG_PARSING_ERROR,fatal:h,reason:d}),h)return}for(g(n,this.observer,o,r,this.audioCodec),e=0,h=f(n.samplerate),l&&u&&(h=u+h,1<Math.abs(h-s)&&(W.b.log("AAC: align PTS for overlapping frames by "+Math.round((h-s)/90)),s=h));r<a;)if(p(o,r)&&r+5<a){var c=y(n,o,r,s,e);if(!c)break;r+=c.length,i=c.sample.pts,e++}else r++;l=r<a?o.subarray(r,a):null,this.aacOverFlow=l,this.aacLastPTS=i},O.prototype._parseMPEGPES=function(t){for(var e=t.data,r=e.length,i=0,a=0,n=t.pts;a<r;)if(b.isHeader(e,a)){var o=b.appendFrame(this._audioTrack,e,a,n,i);if(!o)break;a+=o.length,i++}else a++},O.prototype._parseID3PES=function(t){this._id3Track.samples.push(t)},O),w=(k.prototype.resetInitSegment=function(t,e,r,i){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:e,duration:i,inputTimeScale:9e4}},k.prototype.resetTimeStamp=function(){},k.probe=function(t){var e,r,i=v.a.getID3Data(t,0);if(i&&void 0!==v.a.getTimeStamp(i))for(e=i.length,r=Math.min(t.length-1,e+100);e<r;e++)if(b.probe(t,e))return W.b.log("MPEG Audio sync word found !"),!0;return!1},k.prototype.append=function(t,e,r,i){for(var a=v.a.getID3Data(t,0),n=v.a.getTimeStamp(a),o=n?90*n:9e4*e,s=a.length,l=t.length,u=0,d=0,h=this._audioTrack,c=[{pts:o,dts:o,data:a}];s<l;)if(b.isHeader(t,s)){var f=b.appendFrame(h,t,s,o,u);if(!f)break;s+=f.length,d=f.sample.pts,u++}else v.a.isHeader(t,s)?(a=v.a.getID3Data(t,s),c.push({pts:d,dts:d,data:a}),s+=a.length):s++;this.remuxer.remux(h,{samples:[]},{samples:c,inputTimeScale:9e4},{samples:[]},e,r,i)},k.prototype.destroy=function(){},k),U=(R.getSilentFrame=function(t,e){if("mp4a.40.2"===t){if(1===e)return new Uint8Array([0,200,0,128,35,128]);if(2===e)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===e)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},R),d=Math.pow(2,32)-1,V=(T.init=function(){for(var t in T.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]})T.types.hasOwnProperty(t)&&(T.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var e=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);T.HDLR_TYPES={video:e,audio:r};var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);T.STTS=T.STSC=T.STCO=a,T.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),T.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),T.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),T.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);e=new Uint8Array([105,115,111,109]),r=new Uint8Array([97,118,99,49]),a=new Uint8Array([0,0,0,1]);T.FTYP=T.box(T.types.ftyp,e,a,e,r),T.DINF=T.box(T.types.dinf,T.box(T.types.dref,i))},T.box=function(t){for(var e,r=Array.prototype.slice.call(arguments,1),i=8,a=r.length,n=a;a--;)i+=r[a].byteLength;for((e=new Uint8Array(i))[0]=i>>24&255,e[1]=i>>16&255,e[2]=i>>8&255,e[3]=255&i,e.set(t,4),a=0,i=8;a<n;a++)e.set(r[a],i),i+=r[a].byteLength;return e},T.hdlr=function(t){return T.box(T.types.hdlr,T.HDLR_TYPES[t])},T.mdat=function(t){return T.box(T.types.mdat,t)},T.mdhd=function(t,e){e*=t;var r=Math.floor(e/(1+d)),e=Math.floor(e%(1+d));return T.box(T.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,e>>24,e>>16&255,e>>8&255,255&e,85,196,0,0]))},T.mdia=function(t){return T.box(T.types.mdia,T.mdhd(t.timescale,t.duration),T.hdlr(t.type),T.minf(t))},T.mfhd=function(t){return T.box(T.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))},T.minf=function(t){return"audio"===t.type?T.box(T.types.minf,T.box(T.types.smhd,T.SMHD),T.DINF,T.stbl(t)):T.box(T.types.minf,T.box(T.types.vmhd,T.VMHD),T.DINF,T.stbl(t))},T.moof=function(t,e,r){return T.box(T.types.moof,T.mfhd(t),T.traf(r,e))},T.moov=function(t){for(var e=t.length,r=[];e--;)r[e]=T.trak(t[e]);return T.box.apply(null,[T.types.moov,T.mvhd(t[0].timescale,t[0].duration)].concat(r).concat(T.mvex(t)))},T.mvex=function(t){for(var e=t.length,r=[];e--;)r[e]=T.trex(t[e]);return T.box.apply(null,[T.types.mvex].concat(r))},T.mvhd=function(t,e){e*=t;var r=Math.floor(e/(1+d)),e=Math.floor(e%(1+d)),e=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,e>>24,e>>16&255,e>>8&255,255&e,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return T.box(T.types.mvhd,e)},T.sdtp=function(t){for(var e,r=t.samples||[],i=new Uint8Array(4+r.length),a=0;a<r.length;a++)e=r[a].flags,i[a+4]=e.dependsOn<<4|e.isDependedOn<<2|e.hasRedundancy;return T.box(T.types.sdtp,i)},T.stbl=function(t){return T.box(T.types.stbl,T.stsd(t),T.box(T.types.stts,T.STTS),T.box(T.types.stsc,T.STSC),T.box(T.types.stsz,T.STSZ),T.box(T.types.stco,T.STCO))},T.avc1=function(t){for(var e,r,i=[],a=[],n=0;n<t.sps.length;n++)r=(e=t.sps[n]).byteLength,i.push(r>>>8&255),i.push(255&r),i=i.concat(Array.prototype.slice.call(e));for(n=0;n<t.pps.length;n++)r=(e=t.pps[n]).byteLength,a.push(r>>>8&255),a.push(255&r),a=a.concat(Array.prototype.slice.call(e));var o=T.box(T.types.avcC,new Uint8Array([1,i[3],i[4],i[5],255,224|t.sps.length].concat(i).concat([t.pps.length]).concat(a))),s=t.width,l=t.height,u=t.pixelRatio[0],d=t.pixelRatio[1];return T.box(T.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,s>>8&255,255&s,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,T.box(T.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),T.box(T.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,d>>24,d>>16&255,d>>8&255,255&d])))},T.esds=function(t){var e=t.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t.config).concat([6,1,2]))},T.mp4a=function(t){var e=t.samplerate;return T.box(T.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,e>>8&255,255&e,0,0]),T.box(T.types.esds,T.esds(t)))},T.mp3=function(t){var e=t.samplerate;return T.box(T.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,e>>8&255,255&e,0,0]))},T.stsd=function(t){return"audio"===t.type?t.isAAC||"mp3"!==t.codec?T.box(T.types.stsd,T.STSD,T.mp4a(t)):T.box(T.types.stsd,T.STSD,T.mp3(t)):T.box(T.types.stsd,T.STSD,T.avc1(t))},T.tkhd=function(t){var e=t.id,r=t.duration*t.timescale,i=t.width,a=t.height,t=Math.floor(r/(1+d)),r=Math.floor(r%(1+d));return T.box(T.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,255&i,0,0,a>>8&255,255&a,0,0]))},T.traf=function(t,e){var r=T.sdtp(t),i=t.id,a=Math.floor(e/(1+d)),e=Math.floor(e%(1+d));return T.box(T.types.traf,T.box(T.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),T.box(T.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,e>>24,e>>16&255,e>>8&255,255&e])),T.trun(t,r.length+16+20+8+16+8+8),r)},T.trak=function(t){return t.duration=t.duration||4294967295,T.box(T.types.trak,T.tkhd(t),T.mdia(t))},T.trex=function(t){t=t.id;return T.box(T.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},T.trun=function(t,e){var r,i,a,n,o,s=t.samples||[],l=s.length,t=12+16*l,u=new Uint8Array(t);for(u.set([0,0,15,1,l>>>24&255,l>>>16&255,l>>>8&255,255&l,(e+=8+t)>>>24&255,e>>>16&255,e>>>8&255,255&e],0),r=0;r<l;r++)i=(o=s[r]).duration,a=o.size,n=o.flags,o=o.cts,u.set([i>>>24&255,i>>>16&255,i>>>8&255,255&i,a>>>24&255,a>>>16&255,a>>>8&255,255&a,n.isLeading<<2|n.dependsOn,n.isDependedOn<<6|n.hasRedundancy<<4|n.paddingValue<<1|n.isNonSync,61440&n.degradPrio,15&n.degradPrio,o>>>24&255,o>>>16&255,o>>>8&255,255&o],12+16*r);return T.box(T.types.trun,u)},T.initSegment=function(t){T.types||T.init();var e=T.moov(t),t=new Uint8Array(T.FTYP.byteLength+e.byteLength);return t.set(T.FTYP),t.set(e,T.FTYP.byteLength),t},T),D=(E.prototype.destroy=function(){},E.prototype.resetTimeStamp=function(t){this._initPTS=this._initDTS=t},E.prototype.resetInitSegment=function(){this.ISGenerated=!1},E.prototype.remux=function(t,e,r,i,a,n,o){var s,l,u,d,h,c;this.ISGenerated||this.generateIS(t,e,a),this.ISGenerated&&(h=t.samples.length,s=e.samples.length,u=l=a,h&&s&&(d=(t.samples[0].dts-e.samples[0].dts)/e.inputTimeScale,l+=Math.max(0,d),u+=Math.max(0,-d)),h?(t.timescale||(W.b.warn("regenerate InitSegment as audio detected"),this.generateIS(t,e,a)),h=this.remuxAudio(t,l,n,o),s&&(c=void 0,h&&(c=h.endPTS-h.startPTS),e.timescale||(W.b.warn("regenerate InitSegment as video detected"),this.generateIS(t,e,a)),this.remuxVideo(e,u,n,c,o))):(c=void 0,(c=s?this.remuxVideo(e,u,n,o):c)&&t.codec&&this.remuxEmptyAudio(t,l,n,c))),r.samples.length&&this.remuxID3(r,a),i.samples.length&&this.remuxText(i,a),this.observer.trigger(H.a.FRAG_PARSED)},E.prototype.generateIS=function(t,e,r){var i,a,n=this.observer,o=t.samples,s=e.samples,l=this.typeSupported,u="audio/mp4",d={},h={tracks:d},c=void 0===this._initPTS;c&&(i=a=1/0),t.config&&o.length&&(t.timescale=t.samplerate,W.b.log("audio sampling rate : "+t.samplerate),t.isAAC||(l.mpeg?(u="audio/mpeg",t.codec=""):l.mp3&&(t.codec="mp3")),d.audio={container:u,codec:t.codec,initSegment:!t.isAAC&&l.mpeg?new Uint8Array:V.initSegment([t]),metadata:{channelCount:t.channelCount}},c&&(i=a=o[0].pts-t.inputTimeScale*r)),e.sps&&e.pps&&s.length&&(t=e.inputTimeScale,e.timescale=t,d.video={container:"video/mp4",codec:e.codec,initSegment:V.initSegment([e]),metadata:{width:e.width,height:e.height}},c&&(i=Math.min(i,s[0].pts-t*r),a=Math.min(a,s[0].dts-t*r),this.observer.trigger(H.a.INIT_PTS_FOUND,{initPTS:i}))),Object.keys(d).length?(n.trigger(H.a.FRAG_PARSING_INIT_SEGMENT,h),this.ISGenerated=!0,c&&(this._initPTS=i,this._initDTS=a)):n.trigger(H.a.ERROR,{type:K.b.MEDIA_ERROR,details:K.a.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},E.prototype.remuxVideo=function(t,e,r,i,a){var n,o,s=8,l=t.timescale,u=t.samples,d=[],h=u.length,c=this._PTSNormalize,f=this._initDTS,p=this.nextAvcDts,g=this.isSafari;g&&(r|=u.length&&p&&(a&&Math.abs(e-p/l)<.1||Math.abs(u[0].pts-p-f)<l/5)),r||(p=e*l),u.forEach(function(t){t.pts=c(t.pts-f,p),t.dts=c(t.dts-f,p)}),u.sort(function(t,e){var r=t.dts-e.dts,i=t.pts-e.pts;return r||i||t.id-e.id});var y=u.reduce(function(t,e){return Math.max(Math.min(t,e.pts-e.dts),-18e3)},0);if(y<0){W.b.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(y/90)+" ms to overcome this issue");for(var m=0;m<u.length;m++)u[m].dts+=y}var a=u[0],v=Math.max(a.dts,0),b=Math.max(a.pts,0),e=Math.round((v-p)/90);r&&e&&(1<e?W.b.log("AVC:"+e+" ms hole between fragments detected,filling it"):e<-1&&W.b.log("AVC:"+-e+" ms overlapping between fragments detected"),v=p,u[0].dts=v,b=Math.max(b-e,p),u[0].pts=b,W.b.log("Video/PTS/DTS adjusted: "+Math.round(b/90)+"/"+Math.round(v/90)+",delta:"+e+" ms")),a=u[u.length-1],r=Math.max(a.dts,0),e=Math.max(a.pts,0,r),g&&(n=Math.round((r-v)/(u.length-1)));for(var E=0,T=0,R=0;R<h;R++){for(var A=u[R],S=A.units,L=S.length,_=0,w=0;w<L;w++)_+=S[w].data.length;T+=_,E+=L,A.length=_,A.dts=g?v+R*n:Math.max(A.dts,v),A.pts=Math.max(A.pts,A.dts)}a=T+4*E+8;try{o=new Uint8Array(a)}catch(t){return void this.observer.trigger(H.a.ERROR,{type:K.b.MUX_ERROR,details:K.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:a,reason:"fail allocating video mdat "+a})}var D=new DataView(o.buffer);D.setUint32(0,a),o.set(V.types.mdat,4);for(var I=0;I<h;I++){for(var k,O,C,P=u[I],x=P.units,F=0,N=void 0,M=0,U=x.length;M<U;M++){var B=x[M],G=B.data,B=B.data.byteLength;D.setUint32(s,B),s+=4,o.set(G,s),s+=B,F+=4+B}N=g?Math.max(0,n*Math.round((P.pts-P.dts)/n)):(I<h-1?n=u[I+1].dts-P.dts:(C=this.config,k=P.dts-u[0<I?I-1:I].dts,C.stretchShortVideoTrack?(O=C.maxBufferHole,C=C.maxSeekHole,Math.floor(Math.min(O,C)*l)<(C=(i?b+i*l:this.nextAudioPts)-P.pts)?((n=C-k)<0&&(n=k),W.b.log("It is approximately "+C/90+" ms to the next segment; using duration "+n/90+" ms for the last video frame.")):n=k):n=k),Math.round(P.pts-P.dts)),d.push({size:F,duration:n,cts:N,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:P.key?2:1,isNonSync:P.key?0:1}})}this.nextAvcDts=r+n;var j,r=t.dropped;t.len=0,t.nbNalu=0,t.dropped=0,d.length&&-1<navigator.userAgent.toLowerCase().indexOf("chrome")&&((j=d[0].flags).dependsOn=2,j.isNonSync=0),t.samples=d,j=V.moof(t.sequenceNumber++,v,t),t.samples=[];r={data1:j,data2:o,startPTS:b/l,endPTS:(e+n)/l,startDTS:v/l,endDTS:this.nextAvcDts/l,type:"video",nb:d.length,dropped:r};return this.observer.trigger(H.a.FRAG_PARSING_DATA,r),r},E.prototype.remuxAudio=function(t,e,r,i){var a,n,o,s,l=t.inputTimeScale,u=t.timescale,d=l/u,h=(t.isAAC?1024:1152)*d,c=this._PTSNormalize,f=this._initDTS,p=!t.isAAC&&this.typeSupported.mpeg,g=t.samples,y=[],m=this.nextAudioPts;if(r|=g.length&&m&&(i&&Math.abs(e-m/l)<.1||Math.abs(g[0].pts-m-f)<20*h),g.forEach(function(t){t.pts=t.dts=c(t.pts-f,e*l)}),0!==(g=g.filter(function(t){return 0<=t.pts})).length){if(r||(m=i?e*l:g[0].pts),t.isAAC)for(var v=this.config.maxAudioFramesDrift,b=0,E=m;b<g.length;){var T=g[b],R=T.pts-E,A=Math.abs(1e3*R/l);if(R<=-v*h)W.b.warn("Dropping 1 audio frame @ "+(E/l).toFixed(3)+"s due to "+Math.round(A)+" ms overlap."),g.splice(b,1),t.len-=T.unit.length;else if(v*h<=R&&A<1e4&&E){var S=Math.round(R/h);W.b.warn("Injecting "+S+" audio frame @ "+(E/l).toFixed(3)+"s due to "+Math.round(1e3*R/l)+" ms gap.");for(var L=0;L<S;L++){var _,w=Math.max(E,0);(_=U.getSilentFrame(t.manifestCodec||t.codec,t.channelCount))||(W.b.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),_=T.unit.subarray()),g.splice(b,0,{unit:_,pts:w,dts:w}),t.len+=_.length,E+=h,b++}T.pts=T.dts=E,E+=h,b++}else Math.abs(R),T.pts=T.dts=E,E+=h,b++}for(var D=0,I=g.length;D<I;D++){var k=g[D],O=k.unit,k=k.pts;if(void 0!==s)a.duration=Math.round((k-s)/d);else{var C=Math.round(1e3*(k-m)/l),P=0;if(r&&t.isAAC&&C){if(0<C&&C<1e4)P=Math.round((k-m)/h),W.b.log(C+" ms hole between AAC samples detected,filling it"),0<P&&(_=(_=U.getSilentFrame(t.manifestCodec||t.codec,t.channelCount))||O.subarray(),t.len+=P*_.length);else if(C<-12){W.b.log("drop overlapping AAC sample, expected/parsed/delta:"+(m/l).toFixed(3)+"s/"+(k/l).toFixed(3)+"s/"+-C+"ms"),t.len-=O.byteLength;continue}k=m}if(o=k,!(0<t.len))return;var C=p?t.len:t.len+8,x=p?0:8;try{n=new Uint8Array(C)}catch(t){return void this.observer.trigger(H.a.ERROR,{type:K.b.MUX_ERROR,details:K.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:C,reason:"fail allocating audio mdat "+C})}p||(new DataView(n.buffer).setUint32(0,C),n.set(V.types.mdat,4));for(var F=0;F<P;F++)(_=U.getSilentFrame(t.manifestCodec||t.codec,t.channelCount))||(W.b.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),_=O.subarray()),n.set(_,x),x+=_.byteLength,a={size:_.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},y.push(a)}n.set(O,x);C=O.byteLength;x+=C,y.push(a={size:C,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}}),s=k}var N=0,M=y.length;if(2<=M&&(N=y[M-2].duration,a.duration=N),M){this.nextAudioPts=m=s+d*N,t.len=0,t.samples=y,u=p?new Uint8Array:V.moof(t.sequenceNumber++,o/d,t),t.samples=[];i=o/l,N=m/l,M={data1:u,data2:n,startPTS:i,endPTS:N,startDTS:i,endDTS:N,type:"audio",nb:M};return this.observer.trigger(H.a.FRAG_PARSING_DATA,M),M}return null}},E.prototype.remuxEmptyAudio=function(t,e,r,i){var a=t.inputTimeScale,n=t.samplerate||a,o=this.nextAudioPts,s=(void 0!==o?o:i.startDTS*a)+this._initDTS,i=i.endDTS*a+this._initDTS,l=1024*(a/n),u=Math.ceil((i-s)/l),d=U.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(W.b.warn("remux empty Audio"),d){for(var h=[],c=0;c<u;c++){var f=s+c*l;h.push({unit:d,pts:f,dts:f}),t.len+=d.length}t.samples=h,this.remuxAudio(t,e,r)}else W.b.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")},E.prototype.remuxID3=function(t,e){var r,i=t.samples.length,a=t.inputTimeScale,n=this._initPTS,o=this._initDTS;if(i){for(var s=0;s<i;s++)(r=t.samples[s]).pts=(r.pts-n)/a,r.dts=(r.dts-o)/a;this.observer.trigger(H.a.FRAG_PARSING_METADATA,{samples:t.samples})}t.samples=[]},E.prototype.remuxText=function(t,e){t.samples.sort(function(t,e){return t.pts-e.pts});var r,i=t.samples.length,a=t.inputTimeScale,n=this._initPTS;if(i){for(var o=0;o<i;o++)(r=t.samples[o]).pts=(r.pts-n)/a;this.observer.trigger(H.a.FRAG_PARSING_USERDATA,{samples:t.samples})}t.samples=[]},E.prototype._PTSNormalize=function(t,e){var r;if(void 0===e)return t;for(r=e<t?-8589934592:8589934592;4294967296<Math.abs(t-e);)t+=r;return t},E),I=(c.prototype.destroy=function(){},c.prototype.resetTimeStamp=function(){},c.prototype.resetInitSegment=function(){},c.prototype.remux=function(t,e,r,i,a,n,o,s){var l=this.observer,u="";t&&(u+="audio"),e&&(u+="video"),l.trigger(H.a.FRAG_PARSING_DATA,{data1:s,startPTS:a,startDTS:a,type:u,nb:1,dropped:0}),l.trigger(H.a.FRAG_PARSED)},c),r=(h.prototype.destroy=function(){var t=this.demuxer;t&&t.destroy()},h.prototype.push=function(t,r,i,a,n,o,s,l,u,d,h,c){if(0<t.byteLength&&null!=r&&null!=r.key&&"AES-128"===r.method){var e=this.decrypter;null==e&&(e=this.decrypter=new m.a(this.observer,this.config));var f,p=this;try{f=performance.now()}catch(t){f=Date.now()}e.decrypt(t,r.key.buffer,r.iv.buffer,function(t){var e;try{e=performance.now()}catch(t){e=Date.now()}p.observer.trigger(H.a.FRAG_DECRYPTED,{stats:{tstart:f,tdecrypt:e}}),p.pushDecrypted(new Uint8Array(t),r,new Uint8Array(i),a,n,o,s,l,u,d,h,c)})}else this.pushDecrypted(new Uint8Array(t),r,new Uint8Array(i),a,n,o,s,l,u,d,h,c)},h.prototype.pushDecrypted=function(t,e,r,i,a,n,o,s,l,u,d,h){if(!(T=this.demuxer)||o&&!this.probe(t)){for(var c=this.observer,f=this.typeSupported,p=this.config,g=[{demux:_,remux:D},{demux:S,remux:I},{demux:A,remux:D},{demux:w,remux:D}],y=0,m=g.length;y<m;y++){var v=g[y],b=v.demux.probe;if(b(t)){var E=this.remuxer=new v.remux(c,p,f,this.vendor),T=new v.demux(c,E,p,f);this.probe=b;break}}if(!T)return void c.trigger(H.a.ERROR,{type:K.b.MEDIA_ERROR,details:K.a.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this.demuxer=T}var R=this.remuxer;(o||s)&&(T.resetInitSegment(r,i,a,u),R.resetInitSegment()),o&&(T.resetTimeStamp(h),R.resetTimeStamp(h)),"function"==typeof T.setDecryptData&&T.setDecryptData(e),T.append(t,n,l,d)},h);function h(t,e,r,i){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,h),this.observer=t,this.typeSupported=e,this.config=r,this.vendor=i}function c(t){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,c),this.observer=t}function E(t,e,r,i){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,E),this.observer=t,this.config=e,this.typeSupported=r;r=navigator.userAgent;this.isSafari=i&&-1<i.indexOf("Apple")&&r&&!r.match("CriOS"),this.ISGenerated=!1}function T(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,T)}function R(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,R)}function k(t,e,r){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,k),this.observer=t,this.config=r,this.remuxer=e}function O(t,e,r,i){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,O),this.observer=t,this.config=r,this.typeSupported=i,this.remuxer=e,this.sampleAes=null}function C(t,e,r,i){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,C),this.decryptdata=r,this.discardEPB=i,this.decrypter=new m.a(t,e)}function P(t){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,P),this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}function x(t,e){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,x),this.observer=t,this.remuxer=e}function F(t,e,r){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,F),this.observer=t,this.config=r,this.remuxer=e}e.a=r},function(t,e,r){"use strict";function d(t,e){return MediaSource.isTypeSupported((e||"video")+'/mp4;codecs="'+t+'"')}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(){if("undefined"!=typeof window)return window.MediaSource||window.WebKitMediaSource}function h(t,e,r){var i=t[e],a=t[r],t=a.startPTS;isNaN(t)?a.start=e<r?i.start+i.duration:Math.max(i.start-a.duration,0):e<r?(i.duration=t-i.start,i.duration<0&&B.b.warn("negative duration computed for frag "+i.sn+",level "+i.level+", there should be some duration drift between playlist and fragment!")):(a.duration=i.start-t,a.duration<0&&B.b.warn("negative duration computed for frag "+a.sn+",level "+a.level+", there should be some duration drift between playlist and fragment!"))}function f(t,e,r,i,a,n){var o=r;isNaN(e.startPTS)||(s=Math.abs(e.startPTS-r),isNaN(e.deltaPTS)?e.deltaPTS=s:e.deltaPTS=Math.max(s,e.deltaPTS),o=Math.max(r,e.startPTS),r=Math.min(r,e.startPTS),i=Math.max(i,e.endPTS),a=Math.min(a,e.startDTS),n=Math.max(n,e.endDTS));var s=r-e.start;e.start=e.startPTS=r,e.maxStartPTS=o,e.endPTS=i,e.startDTS=a,e.endDTS=n,e.duration=i-r;var l,u,r=e.sn;if(!t||r<t.startSN||r>t.endSN)return 0;for(r=r-t.startSN,(l=t.fragments)[r]=e,u=r;0<u;u--)h(l,u,u-1);for(u=r;u<l.length-1;u++)h(l,u,u+1);return t.PTSKnown=!0,s}function s(t,e){var r,i=Math.max(t.startSN,e.startSN)-e.startSN,a=Math.min(t.endSN,e.endSN)-e.startSN,n=e.startSN-t.startSN,o=t.fragments,s=e.fragments,l=0;if(a<i)return e.PTSKnown=!1;for(var u=i;u<=a;u++){var d=o[n+u],h=s[u];h&&d&&(l=d.cc-h.cc,isNaN(d.startPTS)||(h.start=h.startPTS=d.startPTS,h.endPTS=d.endPTS,h.duration=d.duration,h.backtracked=d.backtracked,h.dropped=d.dropped,r=h))}if(l)for(B.b.log("discontinuity sliding from playlist, take drift into account"),u=0;u<s.length;u++)s[u].cc+=l;if(r)f(e,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS);else if(0<=n&&n<o.length)for(var c=o[n].start,u=0;u<s.length;u++)s[u].start+=c;e.PTSKnown=t.PTSKnown}function l(t,e){t=t.fragments,e=e.fragments;if(e.length&&t.length){e=function(t,e){for(var r=null,i=0;i<t.length;i+=1){var a=t[i];if(a&&a.cc===e){r=a;break}}return r}(t,e[0].cc);return!e||e&&!e.startPTS?void B.b.log("No frag in previous level to align on"):e}B.b.log("No fragments to align")}function u(r,t){t.fragments.forEach(function(t){var e;t&&(e=t.start+r,t.start=t.startPTS=e,t.endPTS=e+t.duration)}),t.PTSKnown=!0}function c(t,e,r){var i,a,n,o;i=t,a=r,n=!1,(n=!!((t=e)&&t.details&&a&&(a.endCC>a.startCC||i&&i.cc<a.startCC))||n)&&(o=l(e.details,r))&&(B.b.log("Adjusting PTS using last level due to CC increase within current level"),u(o.start,r)),!1===r.PTSKnown&&e&&e.details&&(o=e.details.programDateTime,e=(r.programDateTime-o)/1e3+e.details.fragments[0].start,isNaN(e)||(B.b.log("adjusting PTS using programDateTime delta, sliding:"+e.toFixed(3)),u(e,r)))}function n(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new R,this.regionList=[]}function p(){this.values=Object.create(null)}function g(t,e,r,i){var a,n,o=i?t.split(i):[t];for(a in o)"string"!=typeof o[a]||2===(n=o[a].split(r)).length&&e(n[0],n[1])}function y(r,t,o){function e(){var t,t=(t=(t=r).match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/))?t[3]?e(t[1],t[2],t[3].replace(":",""),t[4]):59<t[1]?e(t[1],t[2],0,t[4]):e(0,t[1],t[2],t[4]):null;function e(t,e,r,i){return 3600*(0|t)+60*(0|e)+(0|r)+(0|i)/1e3}if(null===t)throw new Error("Malformed timestamp: "+a);return r=r.replace(/^[^\sa-zA-Z-]+/,""),t}function i(){r=r.replace(/^\s+/,"")}var a=r;if(i(),t.startTime=e(),i(),"--\x3e"!==r.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+a);r=r.substr(3),i(),t.endTime=e(),i(),function(t,e){var n=new p;g(t,function(t,e){switch(t){case"region":for(var r=o.length-1;0<=r;r--)if(o[r].id===e){n.set(t,o[r].region);break}break;case"vertical":n.alt(t,e,["rl","lr"]);break;case"line":var i=e.split(","),a=i[0];n.integer(t,a),n.percent(t,a)&&n.set("snapToLines",!1),n.alt(t,a,["auto"]),2===i.length&&n.alt("lineAlign",i[1],["start",te,"end"]);break;case"position":i=e.split(","),n.percent(t,i[0]),2===i.length&&n.alt("positionAlign",i[1],["start",te,"end","line-left","line-right","auto"]);break;case"size":n.percent(t,e);break;case"align":n.alt(t,e,["start",te,"end","left","right"])}},/:/,/\s/),e.region=n.get("region",null),e.vertical=n.get("vertical","");t=n.get("line","auto");"auto"===t&&-1===Zt.line&&(t=-1),e.line=t,e.lineAlign=n.get("lineAlign","start"),e.snapToLines=n.get("snapToLines",!0),e.size=n.get("size",100),e.align=n.get("align",te);t=n.get("position","auto");"auto"===t&&50===Zt.position&&(t="start"===e.align||"left"===e.align?0:"end"===e.align||"right"===e.align?100:50),e.position=t}(r,t)}function m(t){return t.replace(/<br(?: \/)?>/gi,"\n")}function o(t,e,r,i){for(var a,n,o,s,l,u=window.VTTCue||window.TextTrackCue,d=0;d<i.rows.length;d++)if(o=!0,s=0,l="",!(a=i.rows[d]).isEmpty()){for(var h=0;h<a.chars.length;h++)a.chars[h].uchar.match(/\s/)&&o?s++:(l+=a.chars[h].uchar,o=!1);(a.cueStartTime=e)===r&&(r+=1e-4),n=new u(e,r,m(l.trim())),16<=s?s--:s++,navigator.userAgent.match(/Firefox\//)?n.line=d+1:n.line=7<d?d-2:d+1,n.align="left",n.position=Math.max(0,Math.min(100,s/32*100+(navigator.userAgent.match(/Firefox\//)?50:0))),t.addCue(n)}}function v(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function b(t){if(t&&t.cues)for(;0<t.cues.length;)t.removeCue(t.cues[0])}function E(t){for(var e=[],r=0;r<t.length;r++)"subtitles"===t[r].kind&&e.push(t[r]);return e}Object.defineProperty(e,"__esModule",{value:!0});var T={};r.d(T,"newCue",function(){return o});function R(){return{decode:function(t){if(!t)return"";if("string"!=typeof t)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))}}}var A,S,L,_,w,D,I,k,O,C,P,x,F=r(6),N=r.n(F),M=r(1),U=r(2),B=r(0),G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},j=($t.prototype.destroy=function(){this.unregisterListeners()},$t.prototype.isEventHandler=function(){return"object"===G(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent},$t.prototype.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(t){if("hlsEventGeneric"===t)throw new Error("Forbidden event name: "+t);this.hls.on(t,this.onEvent)},this)},$t.prototype.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(t){this.hls.off(t,this.onEvent)},this)},$t.prototype.onEvent=function(t,e){this.onEventGeneric(t,e)},$t.prototype.onEventGeneric=function(t,e){try{!function(t,e){var r="on"+t.replace("hls","");if("function"!=typeof this[r])throw new Error("Event "+t+" has no generic handler in this "+this.constructor.name+" class (tried "+r+")");return this[r].bind(this,e)}.call(this,t,e).call()}catch(e){B.b.error("internal error happened while processing "+t+":"+e.message),this.hls.trigger(M.a.ERROR,{type:U.b.OTHER_ERROR,details:U.a.INTERNAL_EXCEPTION,fatal:!1,event:t,err:e})}},$t),H=/^(\d+)x(\d+)$/,K=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,W=(Jt.prototype.decimalInteger=function(t){t=parseInt(this[t],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},Jt.prototype.hexadecimalInteger=function(t){if(this[t]){for(var e=(1&(e=(this[t]||"0x").slice(2)).length?"0":"")+e,r=new Uint8Array(e.length/2),i=0;i<e.length/2;i++)r[i]=parseInt(e.slice(2*i,2*i+2),16);return r}return null},Jt.prototype.hexadecimalIntegerAsNumber=function(t){t=parseInt(this[t],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},Jt.prototype.decimalFloatingPoint=function(t){return parseFloat(this[t])},Jt.prototype.enumeratedString=function(t){return this[t]},Jt.prototype.decimalResolution=function(t){t=H.exec(this[t]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},Jt.parseAttrList=function(t){var e,r={};for(K.lastIndex=0;null!==(e=K.exec(t));){var i=e[2];0===i.indexOf('"')&&i.lastIndexOf('"')===i.length-1&&(i=i.slice(1,-1)),r[e[1]]=i}return r},Jt),V={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}},Y=function(t,e,r){return e&&Qt(t.prototype,e),r&&Qt(t,r),t},z=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,X=/#EXT-X-MEDIA:(.*)/g,q=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)(\S+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),Q=(Y(qt,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=N.a.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),qt),J=(Xt.prototype.createInitializationVector=function(t){for(var e=new Uint8Array(16),r=12;r<16;r++)e[r]=t>>8*(15-r)&255;return e},Xt.prototype.fragmentDecryptdataFromLevelkey=function(t,e){var r=t;return t&&t.method&&t.uri&&!t.iv&&((r=new Q).method=t.method,r.baseuri=t.baseuri,r.reluri=t.reluri,r.iv=this.createInitializationVector(e)),r},Xt.prototype.cloneObj=function(t){return JSON.parse(JSON.stringify(t))},Y(Xt,[{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=N.a.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(t){this._url=t}},{key:"programDateTime",get:function(){return!this._programDateTime&&this.rawProgramDateTime&&(this._programDateTime=new Date(Date.parse(this.rawProgramDateTime))),this._programDateTime}},{key:"byteRange",get:function(){var t,e,r;return this._byteRange||(t=this._byteRange=[],this.rawByteRange&&(1===(e=this.rawByteRange.split("@",2)).length?(r=this.lastByteRangeEndOffset,t[0]=r||0):t[0]=parseInt(e[1]),t[1]=parseInt(e[0])+t[0])),this._byteRange}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}}]),Xt),$=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(zt,x=j),zt.prototype.destroy=function(){for(var t in this.loaders){t=this.loaders[t];t&&t.destroy()}this.loaders={},j.prototype.destroy.call(this)},zt.prototype.onManifestLoading=function(t){this.load(t.url,{type:"manifest"})},zt.prototype.onLevelLoading=function(t){this.load(t.url,{type:"level",level:t.level,id:t.id})},zt.prototype.onAudioTrackLoading=function(t){this.load(t.url,{type:"audioTrack",id:t.id})},zt.prototype.onSubtitleTrackLoading=function(t){this.load(t.url,{type:"subtitleTrack",id:t.id})},zt.prototype.load=function(t,e){var r=this.loaders[e.type];if(void 0!==r){var i=r.context;if(i&&i.url===t)return void B.b.trace("playlist request ongoing");B.b.warn("abort previous loader for type:"+e.type),r.abort()}var a=this.hls.config,n=void 0,o=void 0,s=void 0,i=void 0;"manifest"===e.type?(n=a.manifestLoadingMaxRetry,o=a.manifestLoadingTimeOut,s=a.manifestLoadingRetryDelay,i=a.manifestLoadingMaxRetryTimeout):"level"===e.type?(n=0,o=a.levelLoadingTimeOut):(n=a.levelLoadingMaxRetry,o=a.levelLoadingTimeOut,s=a.levelLoadingRetryDelay,i=a.levelLoadingMaxRetryTimeout,B.b.log("loading playlist for "+e.type+" "+(e.level||e.id))),r=this.loaders[e.type]=e.loader=new(void 0!==a.pLoader?a.pLoader:a.loader)(a),e.url=t,e.responseType="";a=void 0,t=void 0,a={timeout:o,maxRetry:n,retryDelay:s,maxRetryDelay:i},t={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};r.load(e,a,t)},zt.prototype.resolve=function(t,e){return N.a.buildAbsoluteURL(e,t,{alwaysNormalize:!0})},zt.prototype.parseMasterPlaylist=function(t,e){var r,i=[];for(z.lastIndex=0;null!=(r=z.exec(t));){var a={},n=a.attrs=new W(r[1]);a.url=this.resolve(r[2],e);var o=n.decimalResolution("RESOLUTION");o&&(a.width=o.width,a.height=o.height),a.bitrate=n.decimalInteger("AVERAGE-BANDWIDTH")||n.decimalInteger("BANDWIDTH"),a.name=n.NAME,function(i,a){["video","audio"].forEach(function(r){var t,e=i.filter(function(t){return e=t,!!(t=V[t=r])&&!0===t[e.slice(0,4)];var e});e.length&&(t=e.filter(function(t){return 0===t.lastIndexOf("avc1",0)||0===t.lastIndexOf("mp4a",0)}),a[r+"Codec"]=(0<t.length?t:e)[0],i=i.filter(function(t){return-1===e.indexOf(t)}))}),a.unknownCodecs=i}([].concat((n.CODECS||"").split(/[ ,]+/)),a),a.videoCodec&&-1!==a.videoCodec.indexOf("avc1")&&(a.videoCodec=this.avc1toavcoti(a.videoCodec)),i.push(a)}return i},zt.prototype.parseMasterPlaylistMedia=function(t,e,r){var i,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[],n=[],o=0;for(X.lastIndex=0;null!==(i=X.exec(t));){var s={},l=new W(i[1]);l.TYPE===r&&(s.groupId=l["GROUP-ID"],s.name=l.NAME,s.type=r,s.default="YES"===l.DEFAULT,s.autoselect="YES"===l.AUTOSELECT,s.forced="YES"===l.FORCED,l.URI&&(s.url=this.resolve(l.URI,e)),s.lang=l.LANGUAGE,s.name||(s.name=s.lang),a.length&&(l=function(t,e){if(!t)return null;for(var r=null,i=0;i<t.length;i++){var a=t[i];a.id===e&&(r=a)}return r}(a,s.groupId),s.audioCodec=(l||a[0]).codec),s.id=o++,n.push(s))}return n},zt.prototype.avc1toavcoti=function(t){var e,r=t.split(".");return 2<r.length?(e=r.shift()+".",e+=parseInt(r.shift()).toString(16),e+=("000"+parseInt(r.shift()).toString(16)).substr(-4)):e=t,e},zt.prototype.parseLevelPlaylist=function(t,e,r,i){var a,n,o=0,s=0,l={type:null,version:null,url:e,fragments:[],live:!0,startSN:0},u=new Q,d=0,h=null,c=new J;for(q.lastIndex=0;null!==(a=q.exec(t));){var f,p=a[1];if(p){c.duration=parseFloat(p);var g=(" "+a[2]).slice(1);c.title=g||null,c.tagList.push(g?["INF",p,g]:["INF",p])}else if(a[3])isNaN(c.duration)||(p=o++,c.type=i,c.start=s,c.levelkey=u,c.sn=p,c.level=r,c.cc=d,c.baseurl=e,c.relurl=(" "+a[3]).slice(1),l.fragments.push(c),s+=(h=c).duration,c=new J);else if(a[4])c.rawByteRange=(" "+a[4]).slice(1),h&&(f=h.byteRangeEndOffset)&&(c.lastByteRangeEndOffset=f);else if(a[5])c.rawProgramDateTime=(" "+a[5]).slice(1),c.tagList.push(["PROGRAM-DATE-TIME",c.rawProgramDateTime]),void 0===l.programDateTime&&(l.programDateTime=new Date(new Date(Date.parse(a[5]))-1e3*s));else{for(a=a[0].match(/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)(.*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/),n=1;n<a.length&&void 0===a[n];n++);var y=(" "+a[n+1]).slice(1),m=(" "+a[n+2]).slice(1);switch(a[n]){case"#":c.tagList.push(m?[y,m]:[y]);break;case"PLAYLIST-TYPE":l.type=y.toUpperCase();break;case"MEDIA-SEQUENCE":o=l.startSN=parseInt(y);break;case"TARGETDURATION":l.targetduration=parseFloat(y);break;case"VERSION":l.version=parseInt(y);break;case"EXTM3U":break;case"ENDLIST":l.live=!1;break;case"DIS":d++,c.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":d=parseInt(y);break;case"KEY":var v=new W(y),b=v.enumeratedString("METHOD"),E=v.URI,v=v.hexadecimalInteger("IV");b&&(u=new Q,E&&0<=["AES-128","SAMPLE-AES"].indexOf(b)&&(u.method=b,u.baseuri=e,u.reluri=E,u.key=null,u.iv=v));break;case"START":var T=new W(y).decimalFloatingPoint("TIME-OFFSET");isNaN(T)||(l.startTimeOffset=T);break;case"MAP":T=new W(y);c.relurl=T.URI,c.rawByteRange=T.BYTERANGE,c.baseurl=e,c.level=r,c.type=i,c.sn="initSegment",l.initSegment=c,c=new J;break;default:B.b.warn("line parsed but not handled: "+a)}}}return(c=h)&&!c.relurl&&(l.fragments.pop(),s-=c.duration),l.totalduration=s,l.averagetargetduration=s/l.fragments.length,l.endSN=o-1,l.startCC=l.fragments[0]?l.fragments[0].cc:0,l.endCC=d,l},zt.prototype.loadsuccess=function(t,e,r){var i,a,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,o=t.data,s=t.url,l=r.type,u=r.id,d=r.level,t=this.hls;(this.loaders[l]=void 0)!==s&&0!==s.indexOf("data:")||(s=r.url),e.tload=performance.now(),0===o.indexOf("#EXTM3U")?0<o.indexOf("#EXTINF:")?(r="audioTrack"!==l&&"subtitleTrack"!==l,i=isNaN(d)?isNaN(u)?0:u:d,(i=this.parseLevelPlaylist(o,s,i,"audioTrack"===l?"audio":"subtitleTrack"===l?"subtitle":"main")).tload=e.tload,"manifest"===l&&t.trigger(M.a.MANIFEST_LOADED,{levels:[{url:s,details:i}],audioTracks:[],url:s,stats:e,networkDetails:n}),e.tparsed=performance.now(),i.targetduration?r?t.trigger(M.a.LEVEL_LOADED,{details:i,level:d||0,id:u||0,stats:e,networkDetails:n}):"audioTrack"===l?t.trigger(M.a.AUDIO_TRACK_LOADED,{details:i,id:u,stats:e,networkDetails:n}):"subtitleTrack"===l&&t.trigger(M.a.SUBTITLE_TRACK_LOADED,{details:i,id:u,stats:e,networkDetails:n}):t.trigger(M.a.ERROR,{type:U.b.NETWORK_ERROR,details:U.a.MANIFEST_PARSING_ERROR,fatal:!0,url:s,reason:"invalid targetduration",networkDetails:n})):(i=this.parseMasterPlaylist(o,s)).length?(u=i.map(function(t){return{id:t.attrs.AUDIO,codec:t.audioCodec}}),u=this.parseMasterPlaylistMedia(o,s,"AUDIO",u),o=this.parseMasterPlaylistMedia(o,s,"SUBTITLES"),u.length&&(a=!1,u.forEach(function(t){t.url||(a=!0)}),!1===a&&i[0].audioCodec&&!i[0].attrs.AUDIO&&(B.b.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),u.unshift({type:"main",name:"main"}))),t.trigger(M.a.MANIFEST_LOADED,{levels:i,audioTracks:u,subtitles:o,url:s,stats:e,networkDetails:n})):t.trigger(M.a.ERROR,{type:U.b.NETWORK_ERROR,details:U.a.MANIFEST_PARSING_ERROR,fatal:!0,url:s,reason:"no level found in manifest",networkDetails:n}):t.trigger(M.a.ERROR,{type:U.b.NETWORK_ERROR,details:U.a.MANIFEST_PARSING_ERROR,fatal:!0,url:s,reason:"no EXTM3U delimiter",networkDetails:n})},zt.prototype.loaderror=function(t,e){var r,i,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,n=e.loader;switch(e.type){case"manifest":r=U.a.MANIFEST_LOAD_ERROR,i=!0;break;case"level":r=U.a.LEVEL_LOAD_ERROR,i=!1;break;case"audioTrack":r=U.a.AUDIO_TRACK_LOAD_ERROR,i=!1}n&&(n.abort(),this.loaders[e.type]=void 0),this.hls.trigger(M.a.ERROR,{type:U.b.NETWORK_ERROR,details:r,fatal:i,url:n.url,loader:n,response:t,context:e,networkDetails:a})},zt.prototype.loadtimeout=function(t,e){var r,i,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,n=e.loader;switch(e.type){case"manifest":r=U.a.MANIFEST_LOAD_TIMEOUT,i=!0;break;case"level":r=U.a.LEVEL_LOAD_TIMEOUT,i=!1;break;case"audioTrack":r=U.a.AUDIO_TRACK_LOAD_TIMEOUT,i=!1}n&&(n.abort(),this.loaders[e.type]=void 0),this.hls.trigger(M.a.ERROR,{type:U.b.NETWORK_ERROR,details:r,fatal:i,url:n.url,loader:n,context:e,networkDetails:a})},zt),Z=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(Yt,P=j),Yt.prototype.destroy=function(){var t,e=this.loaders;for(t in e){var r=e[t];r&&r.destroy()}this.loaders={},j.prototype.destroy.call(this)},Yt.prototype.onFragLoading=function(t){var e=t.frag,r=e.type,i=this.loaders[r],a=this.hls.config;e.loaded=0,i&&(B.b.warn("abort previous fragment loader for type:"+r),i.abort());var n,i=this.loaders[r]=e.loader=new(void 0!==a.fLoader?a.fLoader:a.loader)(a),o=void 0,t=void 0,o={url:e.url,frag:e,responseType:"arraybuffer",progressData:!1},r=e.byteRangeStartOffset,e=e.byteRangeEndOffset;isNaN(r)||isNaN(e)||(o.rangeStart=r,o.rangeEnd=e),n={timeout:a.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:a.fragLoadingMaxRetryTimeout},t={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},i.load(o,n,t)},Yt.prototype.loadsuccess=function(t,e,r){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,t=t.data,r=r.frag;r.loader=void 0,this.loaders[r.type]=void 0,this.hls.trigger(M.a.FRAG_LOADED,{payload:t,frag:r,stats:e,networkDetails:i})},Yt.prototype.loaderror=function(t,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=e.loader;i&&i.abort(),this.loaders[e.type]=void 0,this.hls.trigger(M.a.ERROR,{type:U.b.NETWORK_ERROR,details:U.a.FRAG_LOAD_ERROR,fatal:!1,frag:e.frag,response:t,networkDetails:r})},Yt.prototype.loadtimeout=function(t,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=e.loader;i&&i.abort(),this.loaders[e.type]=void 0,this.hls.trigger(M.a.ERROR,{type:U.b.NETWORK_ERROR,details:U.a.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e.frag,networkDetails:r})},Yt.prototype.loadprogress=function(t,e,r){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,e=e.frag;e.loaded=t.loaded,this.hls.trigger(M.a.FRAG_LOAD_PROGRESS,{frag:e,stats:t,networkDetails:i})},Yt),tt=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(Vt,C=j),Vt.prototype.destroy=function(){for(var t in this.loaders){t=this.loaders[t];t&&t.destroy()}this.loaders={},j.prototype.destroy.call(this)},Vt.prototype.onKeyLoading=function(t){var e,r=t.frag,i=r.type,a=this.loaders[i],n=r.decryptdata,o=n.uri;o!==this.decrypturl||null===this.decryptkey?(e=this.hls.config,a&&(B.b.warn("abort previous key loader for type:"+i),a.abort()),r.loader=this.loaders[i]=new e.loader(e),this.decrypturl=o,this.decryptkey=null,i=a=t=void 0,t={url:o,frag:r,responseType:"arraybuffer"},a={timeout:e.fragLoadingTimeOut,maxRetry:e.fragLoadingMaxRetry,retryDelay:e.fragLoadingRetryDelay,maxRetryDelay:e.fragLoadingMaxRetryTimeout},i={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},r.loader.load(t,a,i)):this.decryptkey&&(n.key=this.decryptkey,this.hls.trigger(M.a.KEY_LOADED,{frag:r}))},Vt.prototype.loadsuccess=function(t,e,r){r=r.frag;this.decryptkey=r.decryptdata.key=new Uint8Array(t.data),r.loader=void 0,this.loaders[r.type]=void 0,this.hls.trigger(M.a.KEY_LOADED,{frag:r})},Vt.prototype.loaderror=function(t,e){var r=e.frag,i=r.loader;i&&i.abort(),this.loaders[e.type]=void 0,this.hls.trigger(M.a.ERROR,{type:U.b.NETWORK_ERROR,details:U.a.KEY_LOAD_ERROR,fatal:!1,frag:r,response:t})},Vt.prototype.loadtimeout=function(t,e){var r=e.frag,i=r.loader;i&&i.abort(),this.loaders[e.type]=void 0,this.hls.trigger(M.a.ERROR,{type:U.b.NETWORK_ERROR,details:U.a.KEY_LOAD_TIMEOUT,fatal:!1,frag:r})},Vt),et={search:function(t,e){for(var r=0,i=t.length-1,a=null,n=null;r<=i;){var o=e(n=t[a=(r+i)/2|0]);if(0<o)r=1+a;else{if(!(o<0))return n;i=a-1}}return null}},rt={isBuffered:function(t,e){try{if(t)for(var r=t.buffered,i=0;i<r.length;i++)if(e>=r.start(i)&&e<=r.end(i))return!0}catch(t){}return!1},bufferInfo:function(t,e,r){try{if(t){for(var i=t.buffered,a=[],n=0;n<i.length;n++)a.push({start:i.start(n),end:i.end(n)});return this.bufferedInfo(a,e,r)}}catch(t){}return{len:0,start:e,end:e,nextStart:void 0}},bufferedInfo:function(t,e,r){var i,a,n,o,s,l=[];for(t.sort(function(t,e){return t.start-e.start||e.end-t.end}),s=0;s<t.length;s++){var u,d=l.length;d?(u=l[d-1].end,t[s].start-u<r?t[s].end>u&&(l[d-1].end=t[s].end):l.push(t[s])):l.push(t[s])}for(i=s=0,a=n=e;s<l.length;s++){var h=l[s].start,c=l[s].end;if(h<=e+r&&e<c)a=h,i=(n=c)-e;else if(e+r<h){o=h;break}}return{len:i,start:a,end:n,nextStart:o}}},it=r(7),at=r(5),nt=r.n(at),ot=r(9),st=r.n(ot),lt=a(),ut=(Wt.prototype.destroy=function(){var t=this.w;t?(t.removeEventListener("message",this.onwmsg),t.terminate(),this.w=null):(e=this.demuxer)&&(e.destroy(),this.demuxer=null);var e=this.observer;e&&(e.removeAllListeners(),this.observer=null)},Wt.prototype.push=function(t,e,r,i,a,n,o,s){var l=this.w,u=isNaN(a.startDTS)?a.start:a.startDTS,d=a.decryptdata,h=this.frag,c=!(h&&a.cc===h.cc),f=!(h&&a.level===h.level),h=h&&a.sn===h.sn+1,h=!f&&h;c&&B.b.log(this.id+":discontinuity detected"),f&&B.b.log(this.id+":switch detected"),this.frag=a,l?l.postMessage({cmd:"demux",data:t,decryptdata:d,initSegment:e,audioCodec:r,videoCodec:i,timeOffset:u,discontinuity:c,trackSwitch:f,contiguous:h,duration:n,accurateTimeOffset:o,defaultInitPTS:s},t instanceof ArrayBuffer?[t]:[]):(l=this.demuxer)&&l.push(t,d,e,r,i,u,c,f,h,n,o,s)},Wt.prototype.onWorkerMessage=function(t){var e=t.data,r=this.hls;switch(e.event){case"init":URL.revokeObjectURL(this.w.objectURL);break;case M.a.FRAG_PARSING_DATA:e.data.data1=new Uint8Array(e.data1),e.data2&&(e.data.data2=new Uint8Array(e.data2));default:e.data=e.data||{},e.data.frag=this.frag,e.data.id=this.id,r.trigger(e.event,e.data)}},Wt),dt={toString:function(t){for(var e="",r=t.length,i=0;i<r;i++)e+="["+t.start(i).toFixed(3)+","+t.end(i).toFixed(3)+"]";return e}},ht=function(t,e,r){return e&&Kt(t.prototype,e),r&&Kt(t,r),t},ct={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR"},ft=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(Ht,O=j),Ht.prototype.destroy=function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),j.prototype.destroy.call(this),this.state=ct.STOPPED},Ht.prototype.startLoad=function(t){var e,r,i;this.levels?(e=this.lastCurrentTime,r=this.hls,this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.level=-1,this.fragLoadError=0,this.startFragRequested||(-1===(i=r.startLevel)&&(this.bitrateTest=!(i=0)),this.level=r.nextLoadLevel=i,this.loadedmetadata=!1),0<e&&-1===t&&(B.b.log("override startPosition with lastCurrentTime @"+e.toFixed(3)),t=e),this.state=ct.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()):(this.forceStartLoad=!0,this.state=ct.STOPPED)},Ht.prototype.stopLoad=function(){var t=this.fragCurrent;t&&(t.loader&&t.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=ct.STOPPED,this.forceStartLoad=!1},Ht.prototype.tick=function(){1==++this.ticks&&(this.doTick(),1<this.ticks&&setTimeout(this.tick,1),this.ticks=0)},Ht.prototype.doTick=function(){switch(this.state){case ct.ERROR:break;case ct.BUFFER_FLUSHING:this.fragLoadError=0;break;case ct.IDLE:this._doTickIdle();break;case ct.WAITING_LEVEL:var t=this.levels[this.level];t&&t.details&&(this.state=ct.IDLE);break;case ct.FRAG_LOADING_WAITING_RETRY:var e=performance.now(),t=this.retryDate;(!t||t<=e||this.media&&this.media.seeking)&&(B.b.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=ct.IDLE);break;case ct.ERROR:case ct.STOPPED:case ct.FRAG_LOADING:case ct.PARSING:case ct.PARSED:case ct.ENDED:}this._checkBuffer(),this._checkFragmentChanged()},Ht.prototype._doTickIdle=function(){var t=this.hls,e=t.config,r=this.media;if(void 0!==this.levelLastLoaded&&(r||!this.startFragRequested&&e.startFragPrefetch)){var i=this.loadedmetadata?r.currentTime:this.nextLoadPosition,a=t.nextLoadLevel,n=this.levels[a];if(n){var o=n.bitrate,s=void 0,s=o?Math.max(8*e.maxBufferSize/o,e.maxBufferLength):e.maxBufferLength;s=Math.min(s,e.maxMaxBufferLength);o=rt.bufferInfo(this.mediaBuffer||r,i,e.maxBufferHole),e=o.len;if(!(s<=e)){B.b.trace("buffer length of "+e.toFixed(3)+" is below max of "+s.toFixed(3)+". checking for more payload ..."),this.level=t.nextLoadLevel=a;n=n.details;if(void 0===n||!0===n.live&&this.levelLastLoaded!==a)this.state=ct.WAITING_LEVEL;else{a=this.fragPrevious;if(!n.live&&a&&!a.backtracked&&a.sn===n.endSN&&!o.nextStart&&Math.min(r.duration,a.start+a.duration)-Math.max(o.end,a.start)<=Math.max(.2,a.duration)){a={};return this.altAudio&&(a.type="video"),this.hls.trigger(M.a.BUFFER_EOS,a),void(this.state=ct.ENDED)}this._fetchPayloadOrEos(i,o,n)}}}}},Ht.prototype._fetchPayloadOrEos=function(t,e,r){var i=this.fragPrevious,a=this.level,n=r.fragments,o=n.length;if(0!==o){var s=n[0].start,l=n[o-1].start+n[o-1].duration,u=e.end,d=void 0;if(r.initSegment&&!r.initSegment.data)d=r.initSegment;else if(r.live){e=this.config.initialLiveManifestSize;if(o<e)return void B.b.warn("Can not start playback of a level, reason: not enough fragments "+o+" < "+e);if(null===(d=this._ensureFragmentAtLivePoint(r,u,s,l,i,n,o)))return}else u<s&&(d=n[0]);(d=d||this._findFragment(s,i,o,n,u,l,r))&&this._loadFragmentOrKey(d,a,r,t,u)}},Ht.prototype._ensureFragmentAtLivePoint=function(t,e,r,i,a,n,o){var s=this.hls.config,l=this.media,u=void 0,d=void 0!==s.liveMaxLatencyDuration?s.liveMaxLatencyDuration:s.liveMaxLatencyDurationCount*t.targetduration;return e<Math.max(r-s.maxFragLookUpTolerance,i-d)&&(r=this.liveSyncPosition=this.computeLivePosition(r,t),B.b.log("buffer end: "+e.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+r.toFixed(3)),e=r,l&&l.readyState&&l.duration>r&&(l.currentTime=r),this.nextLoadPosition=r),t.PTSKnown&&i<e&&l&&l.readyState?null:(this.startFragRequested&&!t.PTSKnown&&(a&&((l=a.sn+1)>=t.startSN&&l<=t.endSN&&(t=n[l-t.startSN],a.cc===t.cc&&B.b.log("live playlist, switching playlist, load frag with next SN: "+(u=t).sn)),u||(u=et.search(n,function(t){return a.cc-t.cc}))&&B.b.log("live playlist, switching playlist, load frag with same CC: "+u.sn)),u||(u=n[Math.min(o-1,Math.round(o/2))],B.b.log("live playlist, switching playlist, unknown, load middle frag : "+u.sn))),u)},Ht.prototype._findFragment=function(t,e,r,i,a,n,o){var s=this.hls.config,l=void 0,u=void 0,d=s.maxFragLookUpTolerance,h=e?i[e.sn-i[0].sn+1]:void 0,c=function(t){var e=Math.min(d,t.duration+(t.deltaPTS||0));return t.start+t.duration-e<=a?1:t.start-e>a&&t.start?-1:0};return(u=a<n?(n-d<a&&(d=0),h&&!c(h)?h:et.search(i,c)):i[r-1])&&(c=(l=u).sn-o.startSN,r=e&&l.level===e.level,u=i[c-1],i=i[1+c],e&&l.sn===e.sn&&(r&&!l.backtracked?l.sn<o.endSN?(o=e.deltaPTS)&&o>s.maxBufferHole&&e.dropped&&c?(l=u,B.b.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this"),e.loadCounter--):B.b.log("SN just loaded, load next one: "+(l=i).sn):l=null:l.backtracked&&(i&&i.backtracked?(B.b.warn("Already backtracked from fragment "+i.sn+", will not backtrack to fragment "+l.sn+". Loading fragment "+i.sn),l=i):(B.b.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),l.dropped=0,u?(u.loadCounter&&u.loadCounter--,(l=u).backtracked=!0):c&&(l=null))))),l},Ht.prototype._loadFragmentOrKey=function(t,e,r,i,a){var n=this.hls,o=n.config;if(!t.decryptdata||null==t.decryptdata.uri||null!=t.decryptdata.key){if(B.b.log("Loading "+t.sn+" of ["+r.startSN+" ,"+r.endSN+"],level "+e+", currentTime:"+i.toFixed(3)+",bufferEnd:"+a.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,t.loadCounter){t.loadCounter++;o=o.fragLoadingLoopThreshold;if(t.loadCounter>o&&Math.abs(this.fragLoadIdx-t.loadIdx)<o)return void n.trigger(M.a.ERROR,{type:U.b.MEDIA_ERROR,details:U.a.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:t})}else t.loadCounter=1;return t.loadIdx=this.fragLoadIdx,t.autoLevel=n.autoLevelEnabled,t.bitrateTest=this.bitrateTest,this.fragCurrent=t,this.startFragRequested=!0,isNaN(t.sn)||t.bitrateTest||(this.nextLoadPosition=t.start+t.duration),n.trigger(M.a.FRAG_LOADING,{frag:t}),this.demuxer||(this.demuxer=new ut(n,"main")),void(this.state=ct.FRAG_LOADING)}B.b.log("Loading key for "+t.sn+" of ["+r.startSN+" ,"+r.endSN+"],level "+e),this.state=ct.KEY_LOADING,n.trigger(M.a.KEY_LOADING,{frag:t})},Ht.prototype.getBufferedFrag=function(e){return et.search(this._bufferedFrags,function(t){return e<t.startPTS?-1:e>t.endPTS?1:0})},Ht.prototype.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.endPTS+.5):null},Ht.prototype._checkFragmentChanged=function(){var t,e,r=this.media;r&&r.readyState&&!1===r.seeking&&((t=r.currentTime)>r.playbackRate*this.lastCurrentTime&&(this.lastCurrentTime=t),rt.isBuffered(r,t)?e=this.getBufferedFrag(t):rt.isBuffered(r,t+.1)&&(e=this.getBufferedFrag(t+.1)),e)&&((t=e)!==this.fragPlaying&&(this.hls.trigger(M.a.FRAG_CHANGED,{frag:t}),e=t.level,this.fragPlaying&&this.fragPlaying.level===e||this.hls.trigger(M.a.LEVEL_SWITCHED,{level:e}),this.fragPlaying=t))},Ht.prototype.immediateLevelSwitch=function(){var t;B.b.log("immediateLevelSwitch"),this.immediateSwitch||(this.immediateSwitch=!0,e=void 0,(t=this.media)?(e=t.paused,t.pause()):e=!0,this.previouslyPaused=e);var e=this.fragCurrent;e&&e.loader&&e.loader.abort(),this.fragCurrent=null,void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},Ht.prototype.immediateLevelSwitchEnd=function(){var t=this.media;t&&t.buffered.length&&(this.immediateSwitch=!1,rt.isBuffered(t,t.currentTime)&&(t.currentTime-=1e-4),this.previouslyPaused||t.play())},Ht.prototype.nextLevelSwitch=function(){var t,e,r,i,a=this.media;a&&a.readyState&&((t=e=i=void 0)!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),(e=this.getBufferedFrag(a.currentTime))&&1<e.startPTS&&this.flushMainBuffer(0,e.startPTS-1),i=a.paused?0:(r=this.hls.nextLoadLevel,e=this.levels[r],(r=this.fragLastKbps)&&this.fragCurrent?this.fragCurrent.duration*e.bitrate/(1e3*r)+1:0),(t=this.getBufferedFrag(a.currentTime+i))&&(t=this.followingBufferedFrag(t))&&((i=this.fragCurrent)&&i.loader&&i.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(t.maxStartPTS,Number.POSITIVE_INFINITY)))},Ht.prototype.flushMainBuffer=function(t,e){this.state=ct.BUFFER_FLUSHING;e={startOffset:t,endOffset:e};this.altAudio&&(e.type="video"),this.hls.trigger(M.a.BUFFER_FLUSHING,e)},Ht.prototype.onMediaAttached=function(t){t=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("seeked",this.onvseeked),t.addEventListener("ended",this.onvended);t=this.config;this.levels&&t.autoStartLoad&&this.hls.startLoad(t.startPosition)},Ht.prototype.onMediaDetaching=function(){var t=this.media;t&&t.ended&&(B.b.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var e=this.levels;e&&e.forEach(function(t){t.details&&t.details.fragments.forEach(function(t){t.loadCounter=void 0,t.backtracked=void 0})}),t&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("seeked",this.onvseeked),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},Ht.prototype.onMediaSeeking=function(){var t=this.media,e=t?t.currentTime:void 0,r=this.config;isNaN(e)||B.b.log("media seeking to "+e.toFixed(3));var i,a,n=this.mediaBuffer||t,o=rt.bufferInfo(n,e,this.config.maxBufferHole);this.state===ct.FRAG_LOADING?(i=this.fragCurrent,0===o.len&&i&&(a=r.maxFragLookUpTolerance,n=i.start-a,a=i.start+i.duration+a,e<n||a<e?(i.loader&&(B.b.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),i.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=ct.IDLE):B.b.log("seeking outside of buffer but within currently loaded fragment range"))):this.state===ct.ENDED&&(0===o.len&&(this.fragPrevious=0),this.state=ct.IDLE),t&&(this.lastCurrentTime=e),this.state!==ct.FRAG_LOADING&&void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*r.fragLoadingLoopThreshold),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=e),this.tick()},Ht.prototype.onMediaSeeked=function(){var t=this.media,t=t?t.currentTime:void 0;isNaN(t)||B.b.log("media seeked to "+t.toFixed(3)),this.tick()},Ht.prototype.onMediaEnded=function(){B.b.log("media ended"),this.startPosition=this.lastCurrentTime=0},Ht.prototype.onManifestLoading=function(){B.b.log("trigger BUFFER_RESET"),this.hls.trigger(M.a.BUFFER_RESET),this._bufferedFrags=[],this.stalled=!1,this.startPosition=this.lastCurrentTime=0},Ht.prototype.onManifestParsed=function(t){var e,r=!1,i=!1;t.levels.forEach(function(t){(e=t.audioCodec)&&(-1!==e.indexOf("mp4a.40.2")&&(r=!0),-1!==e.indexOf("mp4a.40.5")&&(i=!0))}),this.audioCodecSwitch=r&&i,this.audioCodecSwitch&&B.b.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1;t=this.config;(t.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(t.startPosition)},Ht.prototype.onLevelLoaded=function(t){var e=t.details,r=t.level,i=this.levels[this.levelLastLoaded],a=this.levels[r],n=e.totalduration,o=0;B.b.log("level "+r+" loaded ["+e.startSN+","+e.endSN+"],duration:"+n),e.live?(t=a.details)&&0<e.fragments.length?(s(t,e),o=e.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(o,t),e.PTSKnown&&!isNaN(o)?B.b.log("live playlist sliding:"+o.toFixed(3)):(B.b.log("live playlist - outdated PTS, unknown sliding"),c(this.fragPrevious,i,e))):(B.b.log("live playlist - first load, unknown sliding"),e.PTSKnown=!1,c(this.fragPrevious,i,e)):e.PTSKnown=!1,a.details=e,this.levelLastLoaded=r,this.hls.trigger(M.a.LEVEL_UPDATED,{details:e,level:r}),!1===this.startFragRequested&&(-1!==this.startPosition&&-1!==this.lastCurrentTime||(r=e.startTimeOffset,isNaN(r)?e.live?(this.startPosition=this.computeLivePosition(o,e),B.b.log("configure startPosition to "+this.startPosition)):this.startPosition=0:(r<0&&(B.b.log("negative start time offset "+r+", count from end of last fragment"),r=o+n+r),B.b.log("start time offset found in playlist, adjust startPosition to "+r),this.startPosition=r),this.lastCurrentTime=this.startPosition),this.nextLoadPosition=this.startPosition),this.state===ct.WAITING_LEVEL&&(this.state=ct.IDLE),this.tick()},Ht.prototype.onKeyLoaded=function(){this.state===ct.KEY_LOADING&&(this.state=ct.IDLE,this.tick())},Ht.prototype.onFragLoaded=function(t){var e,r,i,a,n,o=this.fragCurrent,s=t.frag;this.state===ct.FRAG_LOADING&&o&&"main"===s.type&&s.level===o.level&&s.sn===o.sn&&(i=t.stats,n=(e=this.levels[o.level]).details,B.b.log("Loaded  "+o.sn+" of ["+n.startSN+" ,"+n.endSN+"],level "+o.level),this.bitrateTest=!1,this.stats=i,!0===s.bitrateTest&&this.hls.nextLoadLevel?(this.state=ct.IDLE,this.startFragRequested=!1,i.tparsed=i.tbuffered=performance.now(),this.hls.trigger(M.a.FRAG_BUFFERED,{stats:i,frag:o,id:"main"}),this.tick()):"initSegment"===s.sn?(this.state=ct.IDLE,i.tparsed=i.tbuffered=performance.now(),n.initSegment.data=t.payload,this.hls.trigger(M.a.FRAG_BUFFERED,{stats:i,frag:o,id:"main"}),this.tick()):(this.state=ct.PARSING,r=n.totalduration,a=o.level,s=o.sn,i=this.config.defaultAudioCodec||e.audioCodec,this.audioCodecSwap&&(B.b.log("swapping playlist audio codec"),i=(i=void 0===i?this.lastAudioCodec:i)&&(-1!==i.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),this.pendingBuffering=!0,this.appended=!1,B.b.log("Parsing "+s+" of ["+n.startSN+" ,"+n.endSN+"],level "+a+", cc "+o.cc),s=(s=this.demuxer)||(this.demuxer=new ut(this.hls,"main")),a=!((a=this.media)&&a.seeking)&&(n.PTSKnown||!n.live),n=n.initSegment?n.initSegment.data:[],s.push(t.payload,n,i,e.videoCodec,o,r,a,void 0))),this.fragLoadError=0},Ht.prototype.onFragParsingInitSegment=function(t){var e=this.fragCurrent,r=t.frag;if(e&&"main"===t.id&&r.sn===e.sn&&r.level===e.level&&this.state===ct.PARSING){var i,a,n=t.tracks;for(i in n.audio&&this.altAudio&&delete n.audio,(a=n.audio)&&(r=this.levels[this.level].audioCodec,e=navigator.userAgent.toLowerCase(),r&&this.audioCodecSwap&&(B.b.log("swapping playlist audio codec"),r=-1!==r.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==a.metadata.channelCount&&-1===e.indexOf("firefox")&&(r="mp4a.40.5"),-1!==e.indexOf("android")&&"audio/mpeg"!==a.container&&B.b.log("Android: force audio codec to "+(r="mp4a.40.2")),a.levelCodec=r,a.id=t.id),(a=n.video)&&(a.levelCodec=this.levels[this.level].videoCodec,a.id=t.id),this.hls.trigger(M.a.BUFFER_CODECS,n),n){a=n[i],B.b.log("main track:"+i+",container:"+a.container+",codecs[level/parsed]=["+a.levelCodec+"/"+a.codec+"]");var o=a.initSegment;o&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(M.a.BUFFER_APPENDING,{type:i,data:o,parent:"main",content:"initSegment"}))}this.tick()}},Ht.prototype.onFragParsingData=function(e){var r=this,t=this.fragCurrent,i=e.frag;if(t&&"main"===e.id&&i.sn===t.sn&&i.level===t.level&&("audio"!==e.type||!this.altAudio)&&this.state===ct.PARSING){var a=this.levels[this.level],i=t;if(isNaN(e.endPTS)&&(e.endPTS=e.startPTS+t.duration,e.endDTS=e.startDTS+t.duration),B.b.log("Parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb+",dropped:"+(e.dropped||0)),"video"===e.type)if(i.dropped=e.dropped,i.dropped)if(i.backtracked)B.b.warn("Already backtracked on this fragment, appending with the gap");else{t=a.details;if(!t||i.sn!==t.startSN)return B.b.warn("missing video frame(s), backtracking fragment"),i.backtracked=!0,this.nextLoadPosition=e.startPTS,this.state=ct.IDLE,this.fragPrevious=i,void this.tick();B.b.warn("missing video frame(s) on first frag, appending with gap")}else i.backtracked=!1;var i=f(a.details,i,e.startPTS,e.endPTS,e.startDTS,e.endDTS),n=this.hls;n.trigger(M.a.LEVEL_PTS_UPDATED,{details:a.details,level:this.level,drift:i,type:e.type,start:e.startPTS,end:e.endPTS}),[e.data1,e.data2].forEach(function(t){t&&t.length&&r.state===ct.PARSING&&(r.appended=!0,r.pendingBuffering=!0,n.trigger(M.a.BUFFER_APPENDING,{type:e.type,data:t,parent:"main",content:"data"}))}),this.tick()}},Ht.prototype.onFragParsed=function(t){var e=this.fragCurrent,r=t.frag;e&&"main"===t.id&&r.sn===e.sn&&r.level===e.level&&this.state===ct.PARSING&&(this.stats.tparsed=performance.now(),this.state=ct.PARSED,this._checkAppendedParsed())},Ht.prototype.onAudioTrackSwitching=function(t){var e,r=!!t.url,t=t.id;r||(this.mediaBuffer!==this.media&&(B.b.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media,(e=this.fragCurrent).loader&&(B.b.log("switching to main audio track, cancel main fragment load"),e.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=ct.IDLE),(e=this.hls).trigger(M.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),e.trigger(M.a.AUDIO_TRACK_SWITCHED,{id:t}),this.altAudio=!1)},Ht.prototype.onAudioTrackSwitched=function(t){var e=t.id,t=!!this.hls.audioTracks[e].url;!t||(e=this.videoBuffer)&&this.mediaBuffer!==e&&(B.b.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=e),this.altAudio=t,this.tick()},Ht.prototype.onBufferCreated=function(t){var e,r=t.tracks,i=void 0,a=void 0,n=!1;for(e in r){var o=r[e];"main"===o.id?(i=o,"video"===(a=e)&&(this.videoBuffer=r[e].buffer)):n=!0}n&&i?(B.b.log("alternate track found, use "+a+".buffered to schedule main fragment loading"),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media},Ht.prototype.onBufferAppended=function(t){var e;"main"===t.parent&&((e=this.state)!==ct.PARSING&&e!==ct.PARSED||(this.pendingBuffering=0<t.pending,this._checkAppendedParsed()))},Ht.prototype._checkAppendedParsed=function(){var t,e,r;this.state!==ct.PARSED||this.appended&&this.pendingBuffering||((t=this.fragCurrent)&&(e=this.mediaBuffer||this.media,B.b.log("main buffered : "+dt.toString(e.buffered)),(r=this._bufferedFrags.filter(function(t){return rt.isBuffered(e,(t.startPTS+t.endPTS)/2)})).push(t),this._bufferedFrags=r.sort(function(t,e){return t.startPTS-e.startPTS}),this.fragPrevious=t,(r=this.stats).tbuffered=performance.now(),this.fragLastKbps=Math.round(8*r.total/(r.tbuffered-r.tfirst)),this.hls.trigger(M.a.FRAG_BUFFERED,{stats:r,frag:t,id:"main"}),this.state=ct.IDLE),this.tick())},Ht.prototype.onError=function(t){var e=t.frag||this.fragCurrent;if(!e||"main"===e.type){var r,i=!!this.media&&rt.isBuffered(this.media,this.media.currentTime)&&rt.isBuffered(this.media,this.media.currentTime+.5);switch(t.details){case U.a.FRAG_LOAD_ERROR:case U.a.FRAG_LOAD_TIMEOUT:case U.a.KEY_LOAD_ERROR:case U.a.KEY_LOAD_TIMEOUT:t.fatal||(this.fragLoadError+1<=this.config.fragLoadingMaxRetry?(r=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout),e.loadCounter=0,B.b.warn("mediaController: frag loading failed, retry in "+r+" ms"),this.retryDate=performance.now()+r,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=ct.FRAG_LOADING_WAITING_RETRY):(B.b.error("mediaController: "+t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.state=ct.ERROR));break;case U.a.FRAG_LOOP_LOADING_ERROR:t.fatal||(i?(this._reduceMaxBufferLength(e.duration),this.state=ct.IDLE):e.autoLevel&&0!==e.level||(t.fatal=!0,this.state=ct.ERROR));break;case U.a.LEVEL_LOAD_ERROR:case U.a.LEVEL_LOAD_TIMEOUT:this.state!==ct.ERROR&&(t.fatal?(this.state=ct.ERROR,B.b.warn("streamController: "+t.details+",switch to "+this.state+" state ...")):t.levelRetry||this.state!==ct.WAITING_LEVEL||(this.state=ct.IDLE));break;case U.a.BUFFER_FULL_ERROR:"main"!==t.parent||this.state!==ct.PARSING&&this.state!==ct.PARSED||(i?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=ct.IDLE):(B.b.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}},Ht.prototype._reduceMaxBufferLength=function(t){var e=this.config;e.maxMaxBufferLength>=t&&(e.maxMaxBufferLength/=2,B.b.warn("main:reduce max buffer length to "+e.maxMaxBufferLength+"s"),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*e.fragLoadingLoopThreshold))},Ht.prototype._checkBuffer=function(){var t,e,r,i,a,n,o,s,l=this.media,u=this.config;l&&l.readyState&&(t=l.currentTime,e=(a=this.mediaBuffer||l).buffered,!this.loadedmetadata&&e.length?(this.loadedmetadata=!0,s=l.seeking?t:this.startPosition,r=rt.isBuffered(a,s),o=e.start(0),i=!r&&Math.abs(s-o)<u.maxSeekHole,t===s&&!i||(B.b.log("target start position:"+s),i&&B.b.log("target start position not buffered, seek to buffered.start(0) "+(s=o)),B.b.log("adjust currentTime from "+t+" to "+s),l.currentTime=s)):this.immediateSwitch?this.immediateLevelSwitchEnd():(n=rt.bufferInfo(l,t,0),a=!(l.paused||l.ended||0===l.buffered.length),t!==this.lastCurrentTime?(this.stallReported&&(B.b.warn("playback not stuck anymore @"+t+", after "+Math.round(performance.now()-this.stalled)+"ms"),this.stallReported=!1),this.stalled=void 0,this.nudgeRetry=0):a&&(e=performance.now(),r=this.hls,this.stalled?(i=e-this.stalled,o=n.len,s=this.nudgeRetry||0,o<=.5&&i>1e3*u.lowBufferWatchdogPeriod?(this.stallReported||(this.stallReported=!0,B.b.warn("playback stalling in low buffer @"+t),r.trigger(M.a.ERROR,{type:U.b.MEDIA_ERROR,details:U.a.BUFFER_STALLED_ERROR,fatal:!1,buffer:o})),n=(a=n.nextStart)-t,a&&n<u.maxSeekHole&&0<n&&(this.nudgeRetry=++s,n=s*u.nudgeOffset,B.b.log("adjust currentTime from "+l.currentTime+" to next buffered @ "+a+" + nudge "+n),l.currentTime=a+n,this.stalled=void 0,r.trigger(M.a.ERROR,{type:U.b.MEDIA_ERROR,details:U.a.BUFFER_SEEK_OVER_HOLE,fatal:!1,hole:a+n-t}))):.5<o&&i>1e3*u.highBufferWatchdogPeriod&&(this.stallReported||(this.stallReported=!0,B.b.warn("playback stalling in high buffer @"+t),r.trigger(M.a.ERROR,{type:U.b.MEDIA_ERROR,details:U.a.BUFFER_STALLED_ERROR,fatal:!1,buffer:o})),this.stalled=void 0,this.nudgeRetry=++s,s<u.nudgeMaxRetry?(s=(o=l.currentTime)+s*u.nudgeOffset,B.b.log("adjust currentTime from "+o+" to "+s),l.currentTime=s,r.trigger(M.a.ERROR,{type:U.b.MEDIA_ERROR,details:U.a.BUFFER_NUDGE_ON_STALL,fatal:!1})):(B.b.error("still stuck in high buffer @"+t+" after "+u.nudgeMaxRetry+", raise fatal error"),r.trigger(M.a.ERROR,{type:U.b.MEDIA_ERROR,details:U.a.BUFFER_STALLED_ERROR,fatal:!0})))):(this.stalled=e,this.stallReported=!1))))},Ht.prototype.onFragLoadEmergencyAborted=function(){this.state=ct.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},Ht.prototype.onBufferFlushed=function(){var e=this.mediaBuffer||this.media;this._bufferedFrags=this._bufferedFrags.filter(function(t){return rt.isBuffered(e,(t.startPTS+t.endPTS)/2)}),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.state=ct.IDLE,this.fragPrevious=null},Ht.prototype.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},Ht.prototype.computeLivePosition=function(t,e){var r=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*e.targetduration;return t+Math.max(0,e.totalduration-r)},ht(Ht,[{key:"state",set:function(t){var e;this.state!==t&&(e=this.state,this._state=t,B.b.log("main stream:"+e+"->"+t),this.hls.trigger(M.a.STREAM_STATE_TRANSITION,{previousState:e,nextState:t}))},get:function(){return this._state}},{key:"currentLevel",get:function(){var t=this.media;if(t){t=this.getBufferedFrag(t.currentTime);if(t)return t.level}return-1}},{key:"nextBufferedFrag",get:function(){var t=this.media;return t?this.followingBufferedFrag(this.getBufferedFrag(t.currentTime)):null}},{key:"nextLevel",get:function(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(t){this._liveSyncPosition=t}}]),Ht),pt=function(t,e,r){return e&&jt(t.prototype,e),r&&jt(t,r),t},gt=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(Gt,k=j),Gt.prototype.destroy=function(){this.cleanTimer(),this.manualLevelIndex=-1},Gt.prototype.cleanTimer=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},Gt.prototype.startLoad=function(){var t=this._levels;this.canload=!0,this.levelRetryCount=0,t&&t.forEach(function(t){t.loadError=0;var e=t.details;e&&e.live&&(t.details=void 0)}),null!==this.timer&&this.loadLevel()},Gt.prototype.stopLoad=function(){this.canload=!1},Gt.prototype.onManifestLoaded=function(t){var e,r=[],i={},a=null,n=!1,o=!1,s=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),l=[];if(t.levels.forEach(function(t){t.loadError=0,t.fragmentError=!1,n=n||!!t.videoCodec,o=o||!!t.audioCodec||!(!t.attrs||!t.attrs.AUDIO),!0===s&&t.audioCodec&&-1!==t.audioCodec.indexOf("mp4a.40.34")&&(t.audioCodec=void 0),void 0===(a=i[t.bitrate])?(t.url=[t.url],t.urlId=0,i[t.bitrate]=t,r.push(t)):a.url.push(t.url)}),r=(r=!0===n&&!0===o?r.filter(function(t){return!!t.videoCodec}):r).filter(function(t){var e=t.audioCodec,t=t.videoCodec;return(!e||d(e))&&(!t||d(t))}),t.audioTracks&&(l=t.audioTracks.filter(function(t){return!t.audioCodec||d(t.audioCodec,"audio")})),0<r.length){e=r[0].bitrate,r.sort(function(t,e){return t.bitrate-e.bitrate}),this._levels=r;for(var u=0;u<r.length;u++)if(r[u].bitrate===e){this._firstLevel=u,B.b.log("manifest loaded,"+r.length+" level(s) found, first bitrate:"+e);break}this.hls.trigger(M.a.MANIFEST_PARSED,{levels:r,audioTracks:l,firstLevel:this._firstLevel,stats:t.stats,audio:o,video:n,altAudio:0<l.length})}else this.hls.trigger(M.a.ERROR,{type:U.b.MEDIA_ERROR,details:U.a.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},Gt.prototype.setLevelInternal=function(t){var e,r=this._levels,i=this.hls;0<=t&&t<r.length?(this.cleanTimer(),this.currentLevelIndex!==t&&(B.b.log("switching to level "+t),(e=r[this.currentLevelIndex=t]).level=t,i.trigger(M.a.LEVEL_SWITCH,e),i.trigger(M.a.LEVEL_SWITCHING,e)),(r=(e=r[t]).details)&&!0!==r.live||(r=e.urlId,i.trigger(M.a.LEVEL_LOADING,{url:e.url[r],level:t,id:r}))):i.trigger(M.a.ERROR,{type:U.b.OTHER_ERROR,details:U.a.LEVEL_SWITCH_ERROR,level:t,fatal:!1,reason:"invalid level idx"})},Gt.prototype.onError=function(t){if(!0!==t.fatal){var e=!1,r=!1,i=void 0;switch(t.details){case U.a.FRAG_LOAD_ERROR:case U.a.FRAG_LOAD_TIMEOUT:case U.a.FRAG_LOOP_LOADING_ERROR:case U.a.KEY_LOAD_ERROR:case U.a.KEY_LOAD_TIMEOUT:i=t.frag.level,r=!0;break;case U.a.LEVEL_LOAD_ERROR:case U.a.LEVEL_LOAD_TIMEOUT:i=t.context.level,e=!0;break;case U.a.REMUX_ALLOC_ERROR:i=t.level,e=!0}void 0!==i&&this.recoverLevel(t,i,e,r)}else t.type===U.b.NETWORK_ERROR&&this.cleanTimer()},Gt.prototype.recoverLevel=function(t,e,r,i){var a,n,o,s=this,l=this.hls.config,u=t.details,d=this._levels[e];if(d.loadError++,d.fragmentError=i,!0===r){if(!(this.levelRetryCount+1<=l.levelLoadingMaxRetry))return B.b.error("level controller, cannot recover from "+u+" error"),this.currentLevelIndex=null,this.cleanTimer(),void(t.fatal=!0);n=Math.min(Math.pow(2,this.levelRetryCount)*l.levelLoadingRetryDelay,l.levelLoadingMaxRetryTimeout),this.timer=setTimeout(function(){return s.loadLevel()},n),t.levelRetry=!0,this.levelRetryCount++,B.b.warn("level controller, "+u+", retry in "+n+" ms, current retry count is "+this.levelRetryCount)}!0!==r&&!0!==i||(1<(a=d.url.length)&&d.loadError<a?(B.b.warn("level controller, "+u+" for level "+e+": switching to redundant stream id "+d.urlId),d.urlId=(d.urlId+1)%a,d.details=void 0):-1===this.manualLevelIndex?(o=0===e?this._levels.length-1:e-1,B.b.warn("level controller, "+u+": switch to "+o),this.hls.nextAutoLevel=this.currentLevelIndex=o):!0===i&&(B.b.warn("level controller, "+u+": reload a fragment"),this.currentLevelIndex=null))},Gt.prototype.onFragLoaded=function(t){t=t.frag;void 0===t||"main"!==t.type||void 0!==(t=this._levels[t.level])&&(t.fragmentError=!1,t.loadError=0,this.levelRetryCount=0)},Gt.prototype.onLevelLoaded=function(t){var e,r,i=this,a=t.level;a===this.currentLevelIndex&&(!1===(r=this._levels[a]).fragmentError&&(r.loadError=0,this.levelRetryCount=0),(e=t.details).live?(a=1e3*(e.averagetargetduration||e.targetduration),(r=r.details)&&e.endSN===r.endSN&&(a/=2,B.b.log("same live playlist, reload twice faster")),a-=performance.now()-t.stats.trequest,a=Math.max(1e3,Math.round(a)),B.b.log("live playlist, reload in "+a+" ms"),this.timer=setTimeout(function(){return i.loadLevel()},a)):this.cleanTimer())},Gt.prototype.loadLevel=function(){var t,e=void 0;null!==this.currentLevelIndex&&!0===this.canload&&void 0!==(e=this._levels[this.currentLevelIndex])&&0<e.url.length&&(t=e.urlId,this.hls.trigger(M.a.LEVEL_LOADING,{url:e.url[t],level:this.currentLevelIndex,id:t}))},pt(Gt,[{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(t){var e=this._levels;e&&(t=Math.min(t,e.length-1),this.currentLevelIndex===t&&void 0!==e[t].details||this.setLevelInternal(t))}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(t){this.manualLevelIndex=t,void 0===this._startLevel&&(this._startLevel=t),-1!==t&&(this.level=t)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(t){this._firstLevel=t}},{key:"startLevel",get:function(){if(void 0!==this._startLevel)return this._startLevel;var t=this.hls.config.startLevel;return void 0!==t?t:this._firstLevel},set:function(t){this._startLevel=t}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(t){this.level=t,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=t)}}]),Gt),yt=r(3),mt=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(Bt,I=j),Bt.prototype.destroy=function(){j.prototype.destroy.call(this)},Bt.prototype.onMediaAttached=function(t){this.media=t.media,this.media},Bt.prototype.onMediaDetaching=function(){this.media=void 0},Bt.prototype.onFragParsingMetadata=function(t){var e=t.frag,r=t.samples;this.id3Track||(this.id3Track=this.media.addTextTrack("metadata","id3"),this.id3Track.mode="hidden");for(var i=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,a=0;a<r.length;a++){var n=yt.a.getID3Frames(r[a].data);if(n){var o=r[a].pts,s=a<r.length-1?r[a+1].pts:e.endPTS;o===s&&(s+=1e-4);for(var l=0;l<n.length;l++){var u,d=n[l];yt.a.isTimeStampFrame(d)||((u=new i(o,s,"")).value=d,this.id3Track.addCue(u))}}}},Bt),vt=(Ut.prototype.sample=function(t,e){var r=Math.pow(this.alpha_,t);this.estimate_=e*(1-r)+r*this.estimate_,this.totalWeight_+=t},Ut.prototype.getTotalWeight=function(){return this.totalWeight_},Ut.prototype.getEstimate=function(){if(this.alpha_){var t=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/t}return this.estimate_},Ut),bt=(Mt.prototype.sample=function(t,e){e=8e3*e/(t=Math.max(t,this.minDelayMs_)),t/=1e3;this.fast_.sample(t,e),this.slow_.sample(t,e)},Mt.prototype.canEstimate=function(){var t=this.fast_;return t&&t.getTotalWeight()>=this.minWeight_},Mt.prototype.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},Mt.prototype.destroy=function(){},Mt),Et=function(t,e,r){return e&&Nt(t.prototype,e),r&&Nt(t,r),t},Tt=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(Ft,D=j),Ft.prototype.destroy=function(){this.clearTimer(),j.prototype.destroy.call(this)},Ft.prototype.onFragLoading=function(t){var e,r,i,a,n=t.frag;"main"===n.type&&(this.timer||(this.timer=setInterval(this.onCheck,100)),this._bwEstimator||(e=this.hls,a=t.frag.level,r=e.levels[a].details.live,i=e.config,a=t=void 0,a=r?(t=i.abrEwmaFastLive,i.abrEwmaSlowLive):(t=i.abrEwmaFastVoD,i.abrEwmaSlowVoD),this._bwEstimator=new bt(e,a,t,i.abrEwmaDefaultEstimate)),this.fragCurrent=n)},Ft.prototype._abandonRulesCheck=function(){var t=this.hls,e=t.media,r=this.fragCurrent,i=r.loader,a=t.minAutoLevel;if(!i||i.stats&&i.stats.aborted)return B.b.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var n=i.stats;if(e&&n&&(!e.paused&&0!==e.playbackRate||!e.readyState)&&r.autoLevel&&r.level){var o=performance.now()-n.trequest,s=Math.abs(e.playbackRate);if(o>500*r.duration/s){var l=t.levels,u=Math.max(1,n.bw?n.bw/8:1e3*n.loaded/o),d=l[r.level],h=d.realBitrate?Math.max(d.realBitrate,d.bitrate):d.bitrate,d=n.total||Math.max(n.loaded,Math.round(r.duration*h/8)),h=e.currentTime,d=(d-n.loaded)/u,c=(rt.bufferInfo(e,h,t.config.maxBufferHole).end-h)/s;if(c<2*r.duration/s&&c<d){for(var f=void 0,p=void 0,p=r.level-1;a<p;p--){var g=l[p].realBitrate?Math.max(l[p].realBitrate,l[p].bitrate):l[p].bitrate;if((f=r.duration*g/(6.4*u))<c)break}f<d&&(B.b.warn("loading too slow, abort fragment loading and switch to level "+p+":fragLoadedDelay["+p+"]<fragLoadedDelay["+(r.level-1)+"];bufferStarvationDelay:"+f.toFixed(1)+"<"+d.toFixed(1)+":"+c.toFixed(1)),t.nextLoadLevel=p,this._bwEstimator.sample(o,n.loaded),i.abort(),this.clearTimer(),t.trigger(M.a.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,stats:n}))}}}},Ft.prototype.onFragLoaded=function(t){var e,r,i=t.frag;"main"!==i.type||isNaN(i.sn)||(this.clearTimer(),this.lastLoadedFragLevel=i.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate&&(i=((e=this.hls.levels[i.level]).loaded?e.loaded.bytes:0)+t.stats.loaded,r=(e.loaded?e.loaded.duration:0)+t.frag.duration,e.loaded={bytes:i,duration:r},e.realBitrate=Math.round(8*i/r)),t.frag.bitrateTest&&((r=t.stats).tparsed=r.tbuffered=r.tload,this.onFragBuffered(t)))},Ft.prototype.onFragBuffered=function(t){var e=t.stats,r=t.frag;!0===e.aborted||1!==r.loadCounter||"main"!==r.type||isNaN(r.sn)||r.bitrateTest&&e.tload!==e.tbuffered||(t=e.tparsed-e.trequest,B.b.log("latency/loading/parsing/append/kbps:"+Math.round(e.tfirst-e.trequest)+"/"+Math.round(e.tload-e.tfirst)+"/"+Math.round(e.tparsed-e.tload)+"/"+Math.round(e.tbuffered-e.tparsed)+"/"+Math.round(8*e.loaded/(e.tbuffered-e.trequest))),this._bwEstimator.sample(t,e.loaded),e.bwEstimate=this._bwEstimator.getEstimate(),r.bitrateTest?this.bitrateTestDelay=t/1e3:this.bitrateTestDelay=0)},Ft.prototype.onError=function(t){switch(t.details){case U.a.FRAG_LOAD_ERROR:case U.a.FRAG_LOAD_TIMEOUT:this.clearTimer()}},Ft.prototype.clearTimer=function(){clearInterval(this.timer),this.timer=null},Ft.prototype._findBestLevel=function(t,e,r,i,a,n,o,s,l){for(var u=a;i<=u;u--){var d=l[u].details,h=d?d.totalduration/d.fragments.length:e,c=!!d&&d.live,f=u<=t?o*r:s*r,p=l[u].realBitrate?Math.max(l[u].realBitrate,l[u].bitrate):l[u].bitrate,d=p*h/f;if(B.b.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+u+"/"+Math.round(f)+"/"+p+"/"+h+"/"+n+"/"+d),p<f&&(!d||c&&!this.bitrateTestDelay||d<n))return u}return-1},Et(Ft,[{key:"nextAutoLevel",get:function(){var t=this._nextAutoLevel,e=this._bwEstimator;if(!(-1===t||e&&e.canEstimate()))return t;e=this._nextABRAutoLevel;return e=-1!==t?Math.min(t,e):e},set:function(t){this._nextAutoLevel=t}},{key:"_nextABRAutoLevel",get:function(){var t=this.hls,e=t.maxAutoLevel,r=t.levels,i=t.config,a=t.minAutoLevel,n=t.media,o=this.lastLoadedFragLevel,s=this.fragCurrent?this.fragCurrent.duration:0,l=n?n.currentTime:0,u=n&&0!==n.playbackRate?Math.abs(n.playbackRate):1,d=this._bwEstimator?this._bwEstimator.getEstimate():i.abrEwmaDefaultEstimate,h=(rt.bufferInfo(n,l,i.maxBufferHole).end-l)/u,c=this._findBestLevel(o,s,d,a,e,h,i.abrBandWidthFactor,i.abrBandWidthUpFactor,r);if(0<=c)return c;B.b.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");t=s?Math.min(s,i.maxStarvationDelay):i.maxStarvationDelay,n=i.abrBandWidthFactor,l=i.abrBandWidthUpFactor;return 0!=h||(u=this.bitrateTestDelay)&&(t=(s?Math.min(s,i.maxLoadingDelay):i.maxLoadingDelay)-u,B.b.trace("bitrate test took "+Math.round(1e3*u)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*t)+" ms"),n=l=1),c=this._findBestLevel(o,s,d,a,e,h+t,n,l,r),Math.max(c,0)}}]),Ft),Rt=a(),At=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(xt,w=j),xt.prototype.destroy=function(){j.prototype.destroy.call(this)},xt.prototype.onLevelPtsUpdated=function(t){var e=t.type,r=this.tracks.audio;if("audio"===e&&r&&"audio/mpeg"===r.container){e=this.sourceBuffer.audio;if(.1<Math.abs(e.timestampOffset-t.start)){r=e.updating;try{e.abort()}catch(t){r=!0,B.b.warn("can not abort audio buffer: "+t)}r?this.audioTimestampOffset=t.start:(B.b.warn("change mpeg audio timestamp offset from "+e.timestampOffset+" to "+t.start),e.timestampOffset=t.start)}}},xt.prototype.onManifestParsed=function(t){var e=t.audio,r=t.video||t.levels.length&&t.audio,i=0;t.altAudio&&(e||r)&&B.b.log((i=(e?1:0)+(r?1:0))+" sourceBuffer(s) expected"),this.sourceBufferNb=i},xt.prototype.onMediaAttaching=function(t){var e=this.media=t.media;e&&(t=this.mediaSource=new Rt,this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),t.addEventListener("sourceopen",this.onmso),t.addEventListener("sourceended",this.onmse),t.addEventListener("sourceclose",this.onmsc),e.src=URL.createObjectURL(t),this._objectUrl=e.src)},xt.prototype.onMediaDetaching=function(){B.b.log("media source detaching");var t=this.mediaSource;if(t){if("open"===t.readyState)try{t.endOfStream()}catch(t){B.b.warn("onMediaDetaching:"+t.message+" while calling endOfStream")}t.removeEventListener("sourceopen",this.onmso),t.removeEventListener("sourceended",this.onmse),t.removeEventListener("sourceclose",this.onmsc),this.media&&(URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):B.b.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(M.a.MEDIA_DETACHED)},xt.prototype.onMediaSourceOpen=function(){B.b.log("media source opened"),this.hls.trigger(M.a.MEDIA_ATTACHED,{media:this.media});var t=this.mediaSource;t&&t.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()},xt.prototype.checkPendingTracks=function(){var t=this.pendingTracks,e=Object.keys(t).length;e&&(this.sourceBufferNb<=e||0===this.sourceBufferNb)&&(this.createSourceBuffers(t),this.pendingTracks={},this.doAppending())},xt.prototype.onMediaSourceClose=function(){B.b.log("media source closed")},xt.prototype.onMediaSourceEnded=function(){B.b.log("media source ended")},xt.prototype.onSBUpdateEnd=function(){this.audioTimestampOffset&&(t=this.sourceBuffer.audio,B.b.warn("change mpeg audio timestamp offset from "+t.timestampOffset+" to "+this.audioTimestampOffset),t.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset),this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var r=this.parent,t=this.segments.reduce(function(t,e){return e.parent===r?t+1:t},0);this.hls.trigger(M.a.BUFFER_APPENDED,{parent:r,pending:t}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration()},xt.prototype.onSBUpdateError=function(t){B.b.error("sourceBuffer error:",t),this.hls.trigger(M.a.ERROR,{type:U.b.MEDIA_ERROR,details:U.a.BUFFER_APPENDING_ERROR,fatal:!1})},xt.prototype.onBufferReset=function(){var t,e=this.sourceBuffer;for(t in e){var r=e[t];try{this.mediaSource.removeSourceBuffer(r),r.removeEventListener("updateend",this.onsbue),r.removeEventListener("error",this.onsbe)}catch(e){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},xt.prototype.onBufferCodecs=function(t){if(0===Object.keys(this.sourceBuffer).length){for(var e in t)this.pendingTracks[e]=t[e];var r=this.mediaSource;r&&"open"===r.readyState&&this.checkPendingTracks()}},xt.prototype.createSourceBuffers=function(t){var e,r=this.sourceBuffer,i=this.mediaSource;for(e in t)if(!r[e]){var a=t[e],n=a.levelCodec||a.codec,o=a.container+";codecs="+n;B.b.log("creating sourceBuffer("+o+")");try{var s=r[e]=i.addSourceBuffer(o);s.addEventListener("updateend",this.onsbue),s.addEventListener("error",this.onsbe),this.tracks[e]={codec:n,container:a.container},a.buffer=s}catch(t){B.b.error("error while trying to add sourceBuffer:"+t.message),this.hls.trigger(M.a.ERROR,{type:U.b.MEDIA_ERROR,details:U.a.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:t,mimeType:o})}}this.hls.trigger(M.a.BUFFER_CREATED,{tracks:t})},xt.prototype.onBufferAppending=function(t){this._needsFlush||(this.segments?this.segments.push(t):this.segments=[t],this.doAppending())},xt.prototype.onBufferAppendFail=function(t){B.b.error("sourceBuffer error:",t.event),this.hls.trigger(M.a.ERROR,{type:U.b.MEDIA_ERROR,details:U.a.BUFFER_APPENDING_ERROR,fatal:!1})},xt.prototype.onBufferEos=function(t){var e,r=this.sourceBuffer,i=t.type;for(e in r)i&&e!==i||r[e].ended||(r[e].ended=!0,B.b.log(e+" sourceBuffer now EOS"));this.checkEos()},xt.prototype.checkEos=function(){var t=this.sourceBuffer,e=this.mediaSource;if(e&&"open"===e.readyState){for(var r in t){r=t[r];if(!r.ended)return;if(r.updating)return void(this._needsEos=!0)}B.b.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{e.endOfStream()}catch(t){B.b.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}else this._needsEos=!1},xt.prototype.onBufferFlushing=function(t){this.flushRange.push({start:t.startOffset,end:t.endOffset,type:t.type}),this.flushBufferCounter=0,this.doFlush()},xt.prototype.onLevelUpdated=function(t){t=t.details;0<t.fragments.length&&(this._levelDuration=t.totalduration+t.fragments[0].start,this._live=t.live,this.updateMediaElementDuration())},xt.prototype.updateMediaElementDuration=function(){var t,e=this.hls.config;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(var r in this.sourceBuffer)if(!0===this.sourceBuffer[r].updating)return;t=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),!0===this._live&&!0===e.liveDurationInfinity?(B.b.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>t||t===1/0||isNaN(t))&&(B.b.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},xt.prototype.doFlush=function(){for(;this.flushRange.length;){var t=this.flushRange[0];if(!this.flushBuffer(t.start,t.end,t.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var e=0,r=this.sourceBuffer;try{for(var i in r)e+=r[i].buffered.length}catch(t){B.b.error("error while accessing sourceBuffer.buffered")}this.appended=e,this.hls.trigger(M.a.BUFFER_FLUSHED)}},xt.prototype.doAppending=function(){var t=this.hls,e=this.sourceBuffer,r=this.segments;if(Object.keys(e).length){if(this.media.error)return this.segments=[],void B.b.error("trying to append although a media error occured, flush segment and abort");if(!this.appending&&(r&&r.length)){var i=r.shift();try{var a=e[i.type];a?a.updating?r.unshift(i):(a.ended=!1,this.parent=i.parent,a.appendBuffer(i.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(e){B.b.error("error while trying to append buffer:"+e.message),r.unshift(i);i={type:U.b.MEDIA_ERROR,parent:i.parent};if(22===e.code)return this.segments=[],i.details=U.a.BUFFER_FULL_ERROR,i.fatal=!1,void t.trigger(M.a.ERROR,i);if(this.appendError?this.appendError++:this.appendError=1,i.details=U.a.BUFFER_APPEND_ERROR,this.appendError>t.config.appendErrorMaxRetry)return B.b.log("fail "+t.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),r=[],i.fatal=!0,void t.trigger(M.a.ERROR,i);i.fatal=!1,t.trigger(M.a.ERROR,i)}}}},xt.prototype.flushBuffer=function(t,e,r){var i,a,n,o,s,l,u=this.sourceBuffer;if(Object.keys(u).length){if(B.b.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+t+"/"+e),this.flushBufferCounter<this.appended){for(var d in u)if(!r||d===r){if((i=u[d]).ended=!1,i.updating)return B.b.warn("cannot flush, sb updating in progress"),!1;try{for(a=0;a<i.buffered.length;a++)if(n=i.buffered.start(a),o=i.buffered.end(a),l=-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&e===Number.POSITIVE_INFINITY?(s=t,e):(s=Math.max(n,t),Math.min(o,e)),.5<Math.min(l,o)-s)return this.flushBufferCounter++,B.b.log("flush "+d+" ["+s+","+l+"], of ["+n+","+o+"], pos:"+this.media.currentTime),i.remove(s,l),!1}catch(t){B.b.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}}else B.b.warn("abort flushing too many retries");B.b.log("buffer flushed")}return!0},xt),F=function(t,e,r){return e&&Pt(t.prototype,e),r&&Pt(t,r),t},Y=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(Ct,_=j),Ct.prototype.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=this.restrictedLevels=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer)))},Ct.prototype.onFpsDropLevelCapping=function(t){Ct.isLevelAllowed(t.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(t.droppedLevel)},Ct.prototype.onMediaAttaching=function(t){this.media=t.media instanceof HTMLVideoElement?t.media:null},Ct.prototype.onManifestParsed=function(t){var e=this.hls;this.restrictedLevels=[],e.config.capLevelToPlayerSize&&(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.levels=t.levels,e.firstLevel=this.getMaxLevel(t.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},Ct.prototype.detectPlayerSize=function(){var t,e;!this.media||(t=this.levels?this.levels.length:0)&&((e=this.hls).autoLevelCapping=this.getMaxLevel(t-1),e.autoLevelCapping>this.autoLevelCapping&&e.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping)},Ct.prototype.getMaxLevel=function(r){var i=this;if(!this.levels)return-1;var t=this.levels.filter(function(t,e){return Ct.isLevelAllowed(e,i.restrictedLevels)&&e<=r});return Ct.getMaxLevelByMediaSize(t,this.mediaWidth,this.mediaHeight)},Ct.isLevelAllowed=function(t){return-1===(1<arguments.length&&void 0!==arguments[1]?arguments[1]:[]).indexOf(t)},Ct.getMaxLevelByMediaSize=function(t,e,r){if(!t||t&&!t.length)return-1;for(var i,a=t.length-1,n=0;n<t.length;n+=1){var o=t[n];if((o.width>=e||o.height>=r)&&(!(i=t[n+1])||o.width!==i.width||o.height!==i.height)){a=n;break}}return a},F(Ct,[{key:"mediaWidth",get:function(){var t=void 0,e=this.media;return e&&(t=e.width||e.clientWidth||e.offsetWidth,t*=Ct.contentScaleFactor),t}},{key:"mediaHeight",get:function(){var t=void 0,e=this.media;return e&&(t=e.height||e.clientHeight||e.offsetHeight,t*=Ct.contentScaleFactor),t}}],[{key:"contentScaleFactor",get:function(){var t=1;try{t=window.devicePixelRatio}catch(t){}return t}}]),Ct),at=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(Ot,L=j),Ot.prototype.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},Ot.prototype.onMediaAttaching=function(t){var e=this.hls.config;e.capLevelOnFPSDrop&&("function"==typeof(this.video=t.media instanceof HTMLVideoElement?t.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),e.fpsDroppedMonitoringPeriod))},Ot.prototype.checkFPS=function(t,e,r){var i,a,n,o,s=performance.now();e&&(this.lastTime&&(n=s-this.lastTime,i=r-this.lastDroppedFrames,o=e-this.lastDecodedFrames,a=1e3*i/n,(n=this.hls).trigger(M.a.FPS_DROP,{currentDropped:i,currentDecoded:o,totalDroppedFrames:r}),0<a&&i>n.config.fpsDroppedMonitoringThreshold*o&&(o=n.currentLevel,B.b.warn("drop FPS ratio greater than max allowed value for currentLevel: "+o),0<o&&(-1===n.autoLevelCapping||n.autoLevelCapping>=o)&&(n.trigger(M.a.FPS_DROP_LEVEL_CAPPING,{level:--o,droppedLevel:n.currentLevel}),n.autoLevelCapping=o,n.streamController.nextLevelSwitch()))),this.lastTime=s,this.lastDroppedFrames=r,this.lastDecodedFrames=e)},Ot.prototype.checkFPSInterval=function(){var t,e=this.video;e&&(this.isVideoPlaybackQualityAvailable?(t=e.getVideoPlaybackQuality(),this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)):this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount))},Ot),ot=(kt.prototype.destroy=function(){this.abort(),this.loader=null},kt.prototype.abort=function(){var t=this.loader;t&&4!==t.readyState&&(this.stats.aborted=!0,t.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},kt.prototype.load=function(t,e,r){this.context=t,this.config=e,this.callbacks=r,this.stats={trequest:performance.now(),retry:0},this.retryDelay=e.retryDelay,this.loadInternal()},kt.prototype.loadInternal=function(){var t=this.context,e=this.loader=new XMLHttpRequest,r=this.stats;r.tfirst=0,r.loaded=0;var i=this.xhrSetup;try{if(i)try{i(e,t.url)}catch(r){e.open("GET",t.url,!0),i(e,t.url)}e.readyState||e.open("GET",t.url,!0)}catch(r){return void this.callbacks.onError({code:e.status,text:r.message},t,e)}t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),e.send()},kt.prototype.readystatechange=function(t){var e,r=t.currentTarget,i=r.readyState,a=this.stats,n=this.context,o=this.config;!a.aborted&&2<=i&&(window.clearTimeout(this.requestTimeout),0===a.tfirst&&(a.tfirst=Math.max(performance.now(),a.trequest)),4===i?200<=(e=r.status)&&e<300?(a.tload=Math.max(a.tfirst,performance.now()),i=t=void 0,i="arraybuffer"===n.responseType?(t=r.response).byteLength:(t=r.responseText).length,a.loaded=a.total=i,t={url:r.responseURL,data:t},this.callbacks.onSuccess(t,a,n,r)):a.retry>=o.maxRetry||400<=e&&e<499?(B.b.error(e+" while loading "+n.url),this.callbacks.onError({code:e,text:r.statusText},n,r)):(B.b.warn(e+" while loading "+n.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,o.maxRetryDelay),a.retry++):this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),o.timeout))},kt.prototype.loadtimeout=function(){B.b.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},kt.prototype.loadprogress=function(t){var e=t.currentTarget,r=this.stats;r.loaded=t.loaded,t.lengthComputable&&(r.total=t.total);t=this.callbacks.onProgress;t&&t(r,this.context,null,e)},kt),ht=function(t,e,r){return e&&It(t.prototype,e),r&&It(t,r),t},pt=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(Dt,S=j),Dt.prototype.destroy=function(){this.cleanTimer(),j.prototype.destroy.call(this)},Dt.prototype.cleanTimer=function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},Dt.prototype.tick=function(){1==++this.ticks&&(this.doTick(),1<this.ticks&&setTimeout(this.tick,1),this.ticks=0)},Dt.prototype.doTick=function(){this.updateTrack(this.trackId)},Dt.prototype.onError=function(t){t.fatal&&t.type===U.b.NETWORK_ERROR&&this.cleanTimer()},Dt.prototype.onManifestLoading=function(){this.tracks=[],this.trackId=-1},Dt.prototype.onManifestParsed=function(t){var e=this,t=t.audioTracks||[],r=!1;this.tracks=t,this.hls.trigger(M.a.AUDIO_TRACKS_UPDATED,{audioTracks:t});var i=0;t.forEach(function(t){return t.default&&!r?(e.audioTrack=i,void(r=!0)):void i++}),!1===r&&t.length&&(B.b.log("no default audio track defined, use first audio track as default"),this.audioTrack=0)},Dt.prototype.onAudioTrackLoaded=function(t){t.id<this.tracks.length&&(B.b.log("audioTrack "+t.id+" loaded"),this.tracks[t.id].details=t.details,t.details.live&&!this.timer&&(this.timer=setInterval(this.ontick,1e3*t.details.targetduration)),!t.details.live&&this.timer&&this.cleanTimer())},Dt.prototype.setAudioTrackInternal=function(t){var e,r,i,a;0<=t&&t<this.tracks.length&&(this.cleanTimer(),this.trackId=t,B.b.log("switching to audioTrack "+t),a=this.tracks[t],e=this.hls,i=a.type,r=a.url,e.trigger(M.a.AUDIO_TRACK_SWITCH,i={id:t,type:i,url:r}),e.trigger(M.a.AUDIO_TRACK_SWITCHING,i),a=a.details,!r||void 0!==a&&!0!==a.live||(B.b.log("(re)loading playlist for audioTrack "+t),e.trigger(M.a.AUDIO_TRACK_LOADING,{url:r,id:t})))},Dt.prototype.updateTrack=function(t){var e,r;0<=t&&t<this.tracks.length&&(this.cleanTimer(),this.trackId=t,B.b.log("updating audioTrack "+t),e=(r=this.tracks[t]).url,r=r.details,!e||void 0!==r&&!0!==r.live||(B.b.log("(re)loading playlist for audioTrack "+t),this.hls.trigger(M.a.AUDIO_TRACK_LOADING,{url:e,id:t})))},ht(Dt,[{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this.trackId},set:function(t){this.trackId===t&&void 0!==this.tracks[t].details||this.setAudioTrackInternal(t)}}]),Dt),Et=function(t,e,r){return e&&wt(t.prototype,e),r&&wt(t,r),t},St={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS"},F=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(_t,A=j),_t.prototype.destroy=function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),j.prototype.destroy.call(this),this.state=St.STOPPED},_t.prototype.onInitPtsFound=function(t){var e=t.id,r=t.frag.cc,t=t.initPTS;"main"===e&&(this.initPTS[r]=t,this.videoTrackCC=r,B.b.log("InitPTS for cc:"+r+" found from video track:"+t),this.state===St.WAITING_INIT_PTS&&this.tick())},_t.prototype.startLoad=function(t){var e;this.tracks?(e=this.lastCurrentTime,this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),(this.fragLoadError=0)<e&&-1===t?(B.b.log("audio:override startPosition with lastCurrentTime @"+e.toFixed(3)),this.state=St.IDLE):(this.lastCurrentTime=this.startPosition||t,this.state=St.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()):(this.startPosition=t,this.state=St.STOPPED)},_t.prototype.stopLoad=function(){var t=this.fragCurrent;t&&(t.loader&&t.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=St.STOPPED},_t.prototype.tick=function(){1==++this.ticks&&(this.doTick(),1<this.ticks&&setTimeout(this.tick,1),this.ticks=0)},_t.prototype.doTick=function(){var t,e,r,i=this.hls,a=i.config;switch(this.state){case St.ERROR:case St.PAUSED:case St.BUFFER_FLUSHING:break;case St.STARTING:this.state=St.WAITING_TRACK,this.loadedmetadata=!1;break;case St.IDLE:var n=this.tracks;if(!n)break;if(!this.media&&(this.startFragRequested||!a.startFragPrefetch))break;if(this.loadedmetadata)v=this.media.currentTime;else if(void 0===(v=this.nextLoadPosition))break;var o=this.mediaBuffer||this.media,s=this.videoBuffer||this.media,l=rt.bufferInfo(o,v,a.maxBufferHole),u=rt.bufferInfo(s,v,a.maxBufferHole),d=l.len,h=l.end,c=this.fragPrevious,f=Math.max(a.maxBufferLength,u.len),p=this.audioSwitch,s=this.trackId;if((d<f||p)&&s<n.length){if(void 0===(e=n[s].details)){this.state=St.WAITING_TRACK;break}if(!p&&!e.live&&c&&c.sn===e.endSN&&!l.nextStart&&(!this.media.seeking||this.media.duration-h<c.duration/2)){this.hls.trigger(M.a.BUFFER_EOS,{type:"audio"}),this.state=St.ENDED;break}var u=e.fragments,d=u.length,f=u[0].start,n=u[d-1].start+u[d-1].duration,g=void 0;if(p)if(e.live&&!e.PTSKnown)B.b.log("switching audiotrack, live stream, unknown PTS,load first fragment"),h=0;else if(h=v,e.PTSKnown&&v<f){if(!(l.end>f||l.nextStart))return;B.b.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=f+.05}if(e.initSegment&&!e.initSegment.data)g=e.initSegment;else if(h<=f){if(g=u[0],null!==this.videoTrackCC&&g.cc!==this.videoTrackCC&&(r=this.videoTrackCC,g=et.search(u,function(t){return t.cc<r?1:t.cc>r?-1:0})),e.live&&g.loadIdx&&g.loadIdx===this.fragLoadIdx){var y=l.nextStart||f;return B.b.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(y+.05)),void(this.media.currentTime=y+.05)}}else{var p=void 0,m=a.maxFragLookUpTolerance,l=c?u[c.sn-u[0].sn+1]:void 0,y=function(t){var e=Math.min(m,t.duration);return t.start+t.duration-e<=h?1:t.start-e>h&&t.start?-1:0};(p=h<n?(n-m<h&&(m=0),l&&!y(l)?l:et.search(u,y)):u[d-1])&&(f=(g=p).start,c&&g.level===c.level&&g.sn===c.sn&&(g.sn<e.endSN?(g=u[g.sn+1-e.startSN],B.b.log("SN just loaded, load next one: "+g.sn)):g=null))}if(g)if(g.decryptdata&&null!=g.decryptdata.uri&&null==g.decryptdata.key)B.b.log("Loading key for "+g.sn+" of ["+e.startSN+" ,"+e.endSN+"],track "+s),this.state=St.KEY_LOADING,i.trigger(M.a.KEY_LOADING,{frag:g});else{if(B.b.log("Loading "+g.sn+", cc: "+g.cc+" of ["+e.startSN+" ,"+e.endSN+"],track "+s+", currentTime:"+v+",bufferEnd:"+h.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,g.loadCounter){g.loadCounter++;var v=a.fragLoadingLoopThreshold;if(g.loadCounter>v&&Math.abs(this.fragLoadIdx-g.loadIdx)<v)return void i.trigger(M.a.ERROR,{type:U.b.MEDIA_ERROR,details:U.a.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:g})}else g.loadCounter=1;g.loadIdx=this.fragLoadIdx,this.fragCurrent=g,this.startFragRequested=!0,isNaN(g.sn)||(this.nextLoadPosition=g.start+g.duration),i.trigger(M.a.FRAG_LOADING,{frag:g}),this.state=St.FRAG_LOADING}}break;case St.WAITING_TRACK:(t=this.tracks[this.trackId])&&t.details&&(this.state=St.IDLE);break;case St.FRAG_LOADING_WAITING_RETRY:var b=performance.now(),g=this.retryDate,E=(o=this.media)&&o.seeking;(!g||g<=b||E)&&(B.b.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=St.IDLE);break;case St.WAITING_INIT_PTS:b=this.videoTrackCC;if(void 0===this.initPTS[b])break;E=this.waitingFragment;E?b!==(E=E.frag.cc)?(t=this.tracks[this.trackId]).details&&t.details.live&&(B.b.warn("Waiting fragment CC ("+E+") does not match video track CC ("+b+")"),this.waitingFragment=null,this.state=St.IDLE):(this.state=St.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null):this.state=St.IDLE;break;case St.STOPPED:case St.FRAG_LOADING:case St.PARSING:case St.PARSED:case St.ENDED:}},_t.prototype.onMediaAttached=function(t){t=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("ended",this.onvended);t=this.config;this.tracks&&t.autoStartLoad&&this.startLoad(t.startPosition)},_t.prototype.onMediaDetaching=function(){var t=this.media;t&&t.ended&&(B.b.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var e=this.tracks;e&&e.forEach(function(t){t.details&&t.details.fragments.forEach(function(t){t.loadCounter=void 0})}),t&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.stopLoad()},_t.prototype.onMediaSeeking=function(){this.state===St.ENDED&&(this.state=St.IDLE),this.media&&(this.lastCurrentTime=this.media.currentTime),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.tick()},_t.prototype.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},_t.prototype.onAudioTracksUpdated=function(t){B.b.log("audio tracks updated"),this.tracks=t.audioTracks},_t.prototype.onAudioTrackSwitching=function(t){var e=!!t.url;this.trackId=t.id,this.fragCurrent=null,this.state=St.PAUSED,this.waitingFragment=null,e?this.timer||(this.timer=setInterval(this.ontick,100)):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),e&&(this.audioSwitch=!0,this.state=St.IDLE,void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold)),this.tick()},_t.prototype.onAudioTrackLoaded=function(t){var e=t.details,r=t.id,i=this.tracks[r],a=e.totalduration,t=0;B.b.log("track "+r+" loaded ["+e.startSN+","+e.endSN+"],duration:"+a),e.live?(a=i.details)&&0<e.fragments.length?(s(a,e),t=e.fragments[0].start,e.PTSKnown?B.b.log("live audio playlist sliding:"+t.toFixed(3)):B.b.log("live audio playlist - outdated PTS, unknown sliding")):(e.PTSKnown=!1,B.b.log("live audio playlist - first load, unknown sliding")):e.PTSKnown=!1,i.details=e,this.startFragRequested||(-1===this.startPosition&&(e=e.startTimeOffset,isNaN(e)?this.startPosition=0:(B.b.log("start time offset found in playlist, adjust startPosition to "+e),this.startPosition=e)),this.nextLoadPosition=this.startPosition),this.state===St.WAITING_TRACK&&(this.state=St.IDLE),this.tick()},_t.prototype.onKeyLoaded=function(){this.state===St.KEY_LOADING&&(this.state=St.IDLE,this.tick())},_t.prototype.onFragLoaded=function(t){var e,r,i,a,n,o,s,l=this.fragCurrent,u=t.frag;this.state===St.FRAG_LOADING&&l&&"audio"===u.type&&u.level===l.level&&u.sn===l.sn&&(r=(e=(s=this.tracks[this.trackId]).details).totalduration,i=l.level,a=l.sn,n=l.cc,o=this.config.defaultAudioCodec||s.audioCodec||"mp4a.40.2",u=this.stats=t.stats,"initSegment"===a?(this.state=St.IDLE,u.tparsed=u.tbuffered=performance.now(),e.initSegment.data=t.payload,this.hls.trigger(M.a.FRAG_BUFFERED,{stats:u,frag:l,id:"audio"}),this.tick()):(this.state=St.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new ut(this.hls,"audio")),s=this.initPTS[n],u=e.initSegment?e.initSegment.data:[],e.initSegment||void 0!==s?(this.pendingBuffering=!0,B.b.log("Demuxing "+a+" of ["+e.startSN+" ,"+e.endSN+"],track "+i),this.demuxer.push(t.payload,u,o,null,l,r,!1,s)):(B.b.log("unknown video PTS for continuity counter "+n+", waiting for video PTS before demuxing audio frag "+a+" of ["+e.startSN+" ,"+e.endSN+"],track "+i),this.waitingFragment=t,this.state=St.WAITING_INIT_PTS))),this.fragLoadError=0},_t.prototype.onFragParsingInitSegment=function(t){var e=this.fragCurrent,r=t.frag;e&&"audio"===t.id&&r.sn===e.sn&&r.level===e.level&&this.state===St.PARSING&&(r=void 0,(e=t.tracks).video&&delete e.video,(r=e.audio)&&(r.levelCodec=r.codec,r.id=t.id,this.hls.trigger(M.a.BUFFER_CODECS,e),B.b.log("audio track:audio,container:"+r.container+",codecs[level/parsed]=["+r.levelCodec+"/"+r.codec+"]"),(r=r.initSegment)&&(r={type:"audio",data:r,parent:"audio",content:"initSegment"},this.audioSwitch?this.pendingData=[r]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(M.a.BUFFER_APPENDING,r))),this.tick()))},_t.prototype.onFragParsingData=function(e){var t,r,i,a,n=this,o=this.fragCurrent,s=e.frag;o&&"audio"===e.id&&"audio"===e.type&&s.sn===o.sn&&s.level===o.level&&this.state===St.PARSING&&(t=this.trackId,i=this.tracks[t],r=this.hls,isNaN(e.endPTS)&&(e.endPTS=e.startPTS+o.duration,e.endDTS=e.startDTS+o.duration),B.b.log("parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb),f(i.details,o,e.startPTS,e.endPTS),s=this.audioSwitch,i=this.media,o=!1,s&&i&&(i.readyState?(i=i.currentTime,B.b.log("switching audio track : currentTime:"+i),i>=e.startPTS&&(B.b.log("switching audio track : flushing all audio"),this.state=St.BUFFER_FLUSHING,r.trigger(M.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),this.audioSwitch=!(o=!0),r.trigger(M.a.AUDIO_TRACK_SWITCHED,{id:t}))):(this.audioSwitch=!1,r.trigger(M.a.AUDIO_TRACK_SWITCHED,{id:t}))),a=this.pendingData,this.audioSwitch||([e.data1,e.data2].forEach(function(t){t&&t.length&&a.push({type:e.type,data:t,parent:"audio",content:"data"})}),!o&&a.length&&(a.forEach(function(t){n.state===St.PARSING&&(n.pendingBuffering=!0,n.hls.trigger(M.a.BUFFER_APPENDING,t))}),this.pendingData=[],this.appended=!0)),this.tick())},_t.prototype.onFragParsed=function(t){var e=this.fragCurrent,r=t.frag;e&&"audio"===t.id&&r.sn===e.sn&&r.level===e.level&&this.state===St.PARSING&&(this.stats.tparsed=performance.now(),this.state=St.PARSED,this._checkAppendedParsed())},_t.prototype.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},_t.prototype.onBufferCreated=function(t){var e=t.tracks.audio;e&&(this.mediaBuffer=e.buffer,this.loadedmetadata=!0),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer)},_t.prototype.onBufferAppended=function(t){var e;"audio"===t.parent&&((e=this.state)!==St.PARSING&&e!==St.PARSED||(this.pendingBuffering=0<t.pending,this._checkAppendedParsed()))},_t.prototype._checkAppendedParsed=function(){var t,e,r;this.state!==St.PARSED||this.appended&&this.pendingBuffering||(r=this.fragCurrent,t=this.stats,e=this.hls,r&&(this.fragPrevious=r,t.tbuffered=performance.now(),e.trigger(M.a.FRAG_BUFFERED,{stats:t,frag:r,id:"audio"}),r=this.mediaBuffer||this.media,B.b.log("audio buffered : "+dt.toString(r.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,e.trigger(M.a.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=St.IDLE),this.tick())},_t.prototype.onError=function(t){var e,r,i,a=t.frag;if(!a||"audio"===a.type)switch(t.details){case U.a.FRAG_LOAD_ERROR:case U.a.FRAG_LOAD_TIMEOUT:t.fatal||((e=this.fragLoadError)?e++:e=1,e<=(r=this.config).fragLoadingMaxRetry?(this.fragLoadError=e,a.loadCounter=0,i=Math.min(Math.pow(2,e-1)*r.fragLoadingRetryDelay,r.fragLoadingMaxRetryTimeout),B.b.warn("audioStreamController: frag loading failed, retry in "+i+" ms"),this.retryDate=performance.now()+i,this.state=St.FRAG_LOADING_WAITING_RETRY):(B.b.error("audioStreamController: "+t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.state=St.ERROR));break;case U.a.FRAG_LOOP_LOADING_ERROR:case U.a.AUDIO_TRACK_LOAD_ERROR:case U.a.AUDIO_TRACK_LOAD_TIMEOUT:case U.a.KEY_LOAD_ERROR:case U.a.KEY_LOAD_TIMEOUT:this.state!==St.ERROR&&(this.state=t.fatal?St.ERROR:St.IDLE,B.b.warn("audioStreamController: "+t.details+" while loading frag,switch to "+this.state+" state ..."));break;case U.a.BUFFER_FULL_ERROR:"audio"!==t.parent||this.state!==St.PARSING&&this.state!==St.PARSED||(r=this.mediaBuffer,i=this.media.currentTime,r&&rt.isBuffered(r,i)&&rt.isBuffered(r,i+.5)?((i=this.config).maxMaxBufferLength>=i.maxBufferLength&&(i.maxMaxBufferLength/=2,B.b.warn("audio:reduce max buffer length to "+i.maxMaxBufferLength+"s"),this.fragLoadIdx+=2*i.fragLoadingLoopThreshold),this.state=St.IDLE):(B.b.warn("buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=St.BUFFER_FLUSHING,this.hls.trigger(M.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})))}},_t.prototype.onBufferFlushed=function(){var e=this,t=this.pendingData;t&&t.length?(B.b.log("appending pending audio data on Buffer Flushed"),t.forEach(function(t){e.hls.trigger(M.a.BUFFER_APPENDING,t)}),this.appended=!0,this.pendingData=[],this.state=St.PARSED):(this.state=St.IDLE,this.fragPrevious=null,this.tick())},Et(_t,[{key:"state",set:function(t){var e;this.state!==t&&(e=this.state,this._state=t,B.b.log("audio stream:"+e+"->"+t))},get:function(){return this._state}}]),_t),Lt=function(){function E(t){return"string"==typeof t&&!!e[t.toLowerCase()]&&t.toLowerCase()}function T(t){for(var e=1;e<arguments.length;e++){var r,i=arguments[e];for(r in i)t[r]=i[r]}return t}function t(t,e,r){var i=this,a=function(){if("undefined"!=typeof navigator)return/MSIE\s8\.0/.test(navigator.userAgent)}(),n={};a?i=document.createElement("custom"):n.enumerable=!0,i.hasBeenReset=!1;var o="",s=!1,l=t,u=e,d=r,h=null,c="",f=!0,p="auto",g="start",y=50,m="middle",v=50,b="middle";if(Object.defineProperty(i,"id",T({},n,{get:function(){return o},set:function(t){o=""+t}})),Object.defineProperty(i,"pauseOnExit",T({},n,{get:function(){return s},set:function(t){s=!!t}})),Object.defineProperty(i,"startTime",T({},n,{get:function(){return l},set:function(t){if("number"!=typeof t)throw new TypeError("Start time must be set to a number.");l=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"endTime",T({},n,{get:function(){return u},set:function(t){if("number"!=typeof t)throw new TypeError("End time must be set to a number.");u=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"text",T({},n,{get:function(){return d},set:function(t){d=""+t,this.hasBeenReset=!0}})),Object.defineProperty(i,"region",T({},n,{get:function(){return h},set:function(t){h=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"vertical",T({},n,{get:function(){return c},set:function(t){t="string"==typeof(t=t)&&!!R[t.toLowerCase()]&&t.toLowerCase();if(!1===t)throw new SyntaxError("An invalid or illegal string was specified.");c=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"snapToLines",T({},n,{get:function(){return f},set:function(t){f=!!t,this.hasBeenReset=!0}})),Object.defineProperty(i,"line",T({},n,{get:function(){return p},set:function(t){if("number"!=typeof t&&"auto"!==t)throw new SyntaxError("An invalid number or illegal string was specified.");p=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"lineAlign",T({},n,{get:function(){return g},set:function(t){t=E(t);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");g=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"position",T({},n,{get:function(){return y},set:function(t){if(t<0||100<t)throw new Error("Position must be between 0 and 100.");y=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"positionAlign",T({},n,{get:function(){return m},set:function(t){t=E(t);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");m=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"size",T({},n,{get:function(){return v},set:function(t){if(t<0||100<t)throw new Error("Size must be between 0 and 100.");v=t,this.hasBeenReset=!0}})),Object.defineProperty(i,"align",T({},n,{get:function(){return b},set:function(t){t=E(t);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");b=t,this.hasBeenReset=!0}})),i.displayState=void 0,a)return i}if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var R={"":!0,lr:!0,rl:!0},e={start:!0,middle:!0,end:!0,left:!0,right:!0};return t.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},t}();function _t(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,_t);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,A.call(this,t,M.a.MEDIA_ATTACHED,M.a.MEDIA_DETACHING,M.a.AUDIO_TRACKS_UPDATED,M.a.AUDIO_TRACK_SWITCHING,M.a.AUDIO_TRACK_LOADED,M.a.KEY_LOADED,M.a.FRAG_LOADED,M.a.FRAG_PARSING_INIT_SEGMENT,M.a.FRAG_PARSING_DATA,M.a.FRAG_PARSED,M.a.ERROR,M.a.BUFFER_RESET,M.a.BUFFER_CREATED,M.a.BUFFER_APPENDED,M.a.BUFFER_FLUSHED,M.a.INIT_PTS_FOUND));return e.config=t.config,e.audioCodecSwap=!1,e.ticks=0,e._state=St.STOPPED,e.ontick=e.tick.bind(e),e.initPTS=[],e.waitingFragment=null,e.videoTrackCC=null,e}function wt(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Dt(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,Dt);t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,S.call(this,t,M.a.MANIFEST_LOADING,M.a.MANIFEST_PARSED,M.a.AUDIO_TRACK_LOADED,M.a.ERROR));return t.ticks=0,t.ontick=t.tick.bind(t),t}function It(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function kt(t){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,kt),t&&t.xhrSetup&&(this.xhrSetup=t.xhrSetup)}function Ot(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,Ot),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,L.call(this,t,M.a.MEDIA_ATTACHING))}function Ct(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,Ct),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,_.call(this,t,M.a.FPS_DROP_LEVEL_CAPPING,M.a.MEDIA_ATTACHING,M.a.MANIFEST_PARSED))}function Pt(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function xt(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,xt);t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,w.call(this,t,M.a.MEDIA_ATTACHING,M.a.MEDIA_DETACHING,M.a.MANIFEST_PARSED,M.a.BUFFER_RESET,M.a.BUFFER_APPENDING,M.a.BUFFER_CODECS,M.a.BUFFER_EOS,M.a.BUFFER_FLUSHING,M.a.LEVEL_PTS_UPDATED,M.a.LEVEL_UPDATED));return t._msDuration=null,t._levelDuration=null,t._live=null,t._objectUrl=null,t.onsbue=t.onSBUpdateEnd.bind(t),t.onsbe=t.onSBUpdateError.bind(t),t.pendingTracks={},t.tracks={},t}function Ft(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,Ft);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,D.call(this,t,M.a.FRAG_LOADING,M.a.FRAG_LOADED,M.a.FRAG_BUFFERED,M.a.ERROR));return e.lastLoadedFragLevel=0,e._nextAutoLevel=-1,e.hls=t,e.timer=null,e._bwEstimator=null,e.onCheck=e._abandonRulesCheck.bind(e),e}function Nt(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Mt(t,e,r,i){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,Mt),this.hls=t,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new vt(e),this.fast_=new vt(r)}function Ut(t){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,Ut),this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=0,this.totalWeight_=0}function Bt(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,Bt);t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,I.call(this,t,M.a.MEDIA_ATTACHED,M.a.MEDIA_DETACHING,M.a.FRAG_PARSING_METADATA));return t.id3Track=void 0,t.media=void 0,t}function Gt(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,Gt);t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,k.call(this,t,M.a.MANIFEST_LOADED,M.a.LEVEL_LOADED,M.a.FRAG_LOADED,M.a.ERROR));return t.canload=!1,t.currentLevelIndex=null,t.manualLevelIndex=-1,t.timer=null,t}function jt(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Ht(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,Ht);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,O.call(this,t,M.a.MEDIA_ATTACHED,M.a.MEDIA_DETACHING,M.a.MANIFEST_LOADING,M.a.MANIFEST_PARSED,M.a.LEVEL_LOADED,M.a.KEY_LOADED,M.a.FRAG_LOADED,M.a.FRAG_LOAD_EMERGENCY_ABORTED,M.a.FRAG_PARSING_INIT_SEGMENT,M.a.FRAG_PARSING_DATA,M.a.FRAG_PARSED,M.a.ERROR,M.a.AUDIO_TRACK_SWITCHING,M.a.AUDIO_TRACK_SWITCHED,M.a.BUFFER_CREATED,M.a.BUFFER_APPENDED,M.a.BUFFER_FLUSHED));return e.config=t.config,e.audioCodecSwap=!1,e.ticks=0,e._state=ct.STOPPED,e.ontick=e.tick.bind(e),e}function Kt(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Wt(r,t){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,Wt),this.hls=r,this.id=t;var a=this.observer=new nt.a,e=r.config;a.trigger=function(t){for(var e=arguments.length,r=Array(1<e?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];a.emit.apply(a,[t,t].concat(r))},a.off=function(t){for(var e=arguments.length,r=Array(1<e?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];a.removeListener.apply(a,[t].concat(r))};var i=function(t,e){(e=e||{}).frag=this.frag,e.id=this.id,r.trigger(t,e)}.bind(this);a.on(M.a.FRAG_DECRYPTED,i),a.on(M.a.FRAG_PARSING_INIT_SEGMENT,i),a.on(M.a.FRAG_PARSING_DATA,i),a.on(M.a.FRAG_PARSED,i),a.on(M.a.ERROR,i),a.on(M.a.FRAG_PARSING_METADATA,i),a.on(M.a.FRAG_PARSING_USERDATA,i),a.on(M.a.INIT_PTS_FOUND,i);var n={mp4:lt.isTypeSupported("video/mp4"),mpeg:lt.isTypeSupported("audio/mpeg"),mp3:lt.isTypeSupported('audio/mp4; codecs="mp3"')},o=navigator.vendor;if(e.enableWorker&&"undefined"!=typeof Worker){B.b.log("demuxing in webworker");i=void 0;try{i=this.w=st()(10),this.onwmsg=this.onWorkerMessage.bind(this),i.addEventListener("message",this.onwmsg),i.onerror=function(t){r.trigger(M.a.ERROR,{type:U.b.OTHER_ERROR,details:U.a.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:t.message+" ("+t.filename+":"+t.lineno+")"}})},i.postMessage({cmd:"init",typeSupported:n,vendor:o,id:t,config:JSON.stringify(e)})}catch(t){B.b.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),i&&URL.revokeObjectURL(i.objectURL),this.demuxer=new it.a(a,n,e,o),this.w=void 0}}else this.demuxer=new it.a(a,n,e,o)}function Vt(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,Vt);t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,C.call(this,t,M.a.KEY_LOADING));return t.loaders={},t.decryptkey=null,t.decrypturl=null,t}function Yt(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,Yt);t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,P.call(this,t,M.a.FRAG_LOADING));return t.loaders={},t}function zt(t){i(this,zt);t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,x.call(this,t,M.a.MANIFEST_LOADING,M.a.LEVEL_LOADING,M.a.AUDIO_TRACK_LOADING,M.a.SUBTITLE_TRACK_LOADING));return t.loaders={},t}function Xt(){i(this,Xt),this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[]}function qt(){i(this,qt),this.method=null,this.key=null,this.iv=null,this._uri=null}function Qt(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Jt(t){for(var e in function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,Jt),t="string"==typeof t?Jt.parseAttrList(t):t)t.hasOwnProperty(e)&&(this[e]=t[e])}function $t(t){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,$t),this.hls=t,this.onEvent=this.onEvent.bind(this);for(var e=arguments.length,r=Array(1<e?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];this.handledEvents=r,this.useGenericHandler=!0,this.registerListeners()}p.prototype={set:function(t,e){this.get(t)||""===e||(this.values[t]=e)},get:function(t,e,r){return r?this.has(t)?this.values[t]:e[r]:this.has(t)?this.values[t]:e},has:function(t){return t in this.values},alt:function(t,e,r){for(var i=0;i<r.length;++i)if(e===r[i]){this.set(t,e);break}},integer:function(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))},percent:function(t,e){return!!(e.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&0<=(e=parseFloat(e))&&e<=100)&&(this.set(t,e),!0)}};var Zt=new Lt(0,0,0),te="middle"===Zt.align?"middle":"center";n.prototype={parse:function(t){function e(){for(var t=0,e=m(e=i.buffer);t<e.length&&"\r"!==e[t]&&"\n"!==e[t];)++t;var r=e.substr(0,t);return"\r"===e[t]&&++t,"\n"===e[t]&&++t,i.buffer=e.substr(t),r}var i=this;t&&(i.buffer+=i.decoder.decode(t,{stream:!0}));try{if("INITIAL"===i.state){if(!/\r\n|\n/.test(i.buffer))return this;var r,a=(r=e()).match(/^()?WEBVTT([ \t].*)?$/);if(!a||!a[0])throw new Error("Malformed WebVTT signature.");i.state="HEADER"}for(var n=!1;i.buffer;){if(!/\r\n|\n/.test(i.buffer))return this;switch(n?n=!1:r=e(),i.state){case"HEADER":/:/.test(r)?g(r,function(t,e){"Region"===t&&console.log("parse region",e)},/:/):r||(i.state="ID");continue;case"NOTE":r||(i.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){i.state="NOTE";break}if(!r)continue;if(i.cue=new Lt(0,0,""),i.state="CUE",-1===r.indexOf("--\x3e")){i.cue.id=r;continue}case"CUE":try{y(r,i.cue,i.regionList)}catch(t){i.cue=null,i.state="BADCUE";continue}i.state="CUETEXT";continue;case"CUETEXT":var o=-1!==r.indexOf("--\x3e");if(!r||o&&(n=!0)){i.oncue&&i.oncue(i.cue),i.cue=null,i.state="ID";continue}i.cue.text&&(i.cue.text+="\n"),i.cue.text+=r;continue;case"BADCUE":r||(i.state="ID");continue}}}catch(t){"CUETEXT"===i.state&&i.cue&&i.oncue&&i.oncue(i.cue),i.cue=null,i.state="INITIAL"===i.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var t=this;try{if(t.buffer+=t.decoder.decode(),!t.cue&&"HEADER"!==t.state||(t.buffer+="\n\n",t.parse()),"INITIAL"===t.state)throw new Error("Malformed WebVTT signature.")}catch(t){throw t}return t.onflush&&t.onflush(),this}};function ee(t){var e=t;return ue.hasOwnProperty(t)&&(e=ue[t]),String.fromCharCode(e)}function re(t){for(var e=[],r=0;r<t.length;r++)e.push(t[r].toString(16));return e}function ie(t,e,r){return t.substr(r||0,e.length)===e}function ae(t){for(var e=5381,r=t.length;r;)e=33*e^t.charCodeAt(--r);return(e>>>0).toString()}var ne,oe,se,le=n,ue={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},de=15,he=100,ce={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},fe={17:2,18:4,21:6,22:8,23:10,19:13,20:15},pe={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},ge={25:2,26:4,29:6,30:8,31:10,27:13,28:15},ye=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],me={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(t){this.time=t},log:function(t,e){var r=this.verboseFilter[t];this.verboseLevel>=r&&console.log(this.time+" ["+t+"] "+e)}},ve=(Be.prototype.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},Be.prototype.setStyles=function(t){for(var e=["foreground","underline","italics","background","flash"],r=0;r<e.length;r++){var i=e[r];t.hasOwnProperty(i)&&(this[i]=t[i])}},Be.prototype.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},Be.prototype.equals=function(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash},Be.prototype.copy=function(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash},Be.prototype.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},Be),be=(Ue.prototype.reset=function(){this.uchar=" ",this.penState.reset()},Ue.prototype.setChar=function(t,e){this.uchar=t,this.penState.copy(e)},Ue.prototype.setPenState=function(t){this.penState.copy(t)},Ue.prototype.equals=function(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)},Ue.prototype.copy=function(t){this.uchar=t.uchar,this.penState.copy(t.penState)},Ue.prototype.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},Ue),Ee=(Me.prototype.equals=function(t){for(var e=!0,r=0;r<he;r++)if(!this.chars[r].equals(t.chars[r])){e=!1;break}return e},Me.prototype.copy=function(t){for(var e=0;e<he;e++)this.chars[e].copy(t.chars[e])},Me.prototype.isEmpty=function(){for(var t=!0,e=0;e<he;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t},Me.prototype.setCursor=function(t){this.pos!==t&&(this.pos=t),this.pos<0?(me.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>he&&(me.log("ERROR","Too large cursor position "+this.pos),this.pos=he)},Me.prototype.moveCursor=function(t){var e=this.pos+t;if(1<t)for(var r=this.pos+1;r<e+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(e)},Me.prototype.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},Me.prototype.insertChar=function(t){144<=t&&this.backSpace();var e=ee(t);this.pos>=he?me.log("ERROR","Cannot insert "+t.toString(16)+" ("+e+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1))},Me.prototype.clearFromPos=function(t){for(var e=t;e<he;e++)this.chars[e].reset()},Me.prototype.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},Me.prototype.clearToEndOfRow=function(){this.clearFromPos(this.pos)},Me.prototype.getTextString=function(){for(var t=[],e=!0,r=0;r<he;r++){var i=this.chars[r].uchar;" "!==i&&(e=!1),t.push(i)}return e?"":t.join("")},Me.prototype.setPenStyles=function(t){this.currPenState.setStyles(t),this.chars[this.pos].setPenState(this.currPenState)},Me),Te=(Ne.prototype.reset=function(){for(var t=0;t<de;t++)this.rows[t].clear();this.currRow=de-1},Ne.prototype.equals=function(t){for(var e=!0,r=0;r<de;r++)if(!this.rows[r].equals(t.rows[r])){e=!1;break}return e},Ne.prototype.copy=function(t){for(var e=0;e<de;e++)this.rows[e].copy(t.rows[e])},Ne.prototype.isEmpty=function(){for(var t=!0,e=0;e<de;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t},Ne.prototype.backSpace=function(){this.rows[this.currRow].backSpace()},Ne.prototype.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},Ne.prototype.insertChar=function(t){this.rows[this.currRow].insertChar(t)},Ne.prototype.setPen=function(t){this.rows[this.currRow].setPenStyles(t)},Ne.prototype.moveCursor=function(t){this.rows[this.currRow].moveCursor(t)},Ne.prototype.setCursor=function(t){me.log("INFO","setCursor: "+t),this.rows[this.currRow].setCursor(t)},Ne.prototype.setPAC=function(t){me.log("INFO","pacData = "+JSON.stringify(t));var e=t.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(var r=0;r<de;r++)this.rows[r].clear();var i=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){var n=a.rows[i].cueStartTime;if(n&&n<me.time)for(var o=0;o<this.nrRollUpRows;o++)this.rows[e-this.nrRollUpRows+o+1].copy(a.rows[i+o])}}this.currRow=e;var s=this.rows[this.currRow];null!==t.indent&&(n=t.indent,n=Math.max(n-1,0),s.setCursor(t.indent),t.color=s.chars[n].penState.foreground);t={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(t)},Ne.prototype.setBkgData=function(t){me.log("INFO","bkgData = "+JSON.stringify(t)),this.backSpace(),this.setPen(t),this.insertChar(32)},Ne.prototype.setRollUpRows=function(t){this.nrRollUpRows=t},Ne.prototype.rollUp=function(){var t;null!==this.nrRollUpRows?(me.log("TEXT",this.getDisplayText()),t=this.currRow+1-this.nrRollUpRows,(t=this.rows.splice(t,1)[0]).clear(),this.rows.splice(this.currRow,0,t),me.log("INFO","Rolling up")):me.log("DEBUG","roll_up but nrRollUpRows not set yet")},Ne.prototype.getDisplayText=function(t){t=t||!1;for(var e=[],r="",i=0;i<de;i++){var a=this.rows[i].getTextString();a&&(t?e.push("Row "+(i+1)+": '"+a+"'"):e.push(a.trim()))}return r=0<e.length?t?"["+e.join(" | ")+"]":e.join("\n"):r},Ne.prototype.getTextAndFormat=function(){return this.rows},Ne),Re=(Fe.prototype.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[de-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},Fe.prototype.getHandler=function(){return this.outputFilter},Fe.prototype.setHandler=function(t){this.outputFilter=t},Fe.prototype.setPAC=function(t){this.writeScreen.setPAC(t)},Fe.prototype.setBkgData=function(t){this.writeScreen.setBkgData(t)},Fe.prototype.setMode=function(t){t!==this.mode&&(this.mode=t,me.log("INFO","MODE="+t),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)},Fe.prototype.insertChars=function(t){for(var e=0;e<t.length;e++)this.writeScreen.insertChar(t[e]);var r=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";me.log("INFO",r+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(me.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},Fe.prototype.ccRCL=function(){me.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},Fe.prototype.ccBS=function(){me.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},Fe.prototype.ccAOF=function(){},Fe.prototype.ccAON=function(){},Fe.prototype.ccDER=function(){me.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},Fe.prototype.ccRU=function(t){me.log("INFO","RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)},Fe.prototype.ccFON=function(){me.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},Fe.prototype.ccRDC=function(){me.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},Fe.prototype.ccTR=function(){me.log("INFO","TR"),this.setMode("MODE_TEXT")},Fe.prototype.ccRTD=function(){me.log("INFO","RTD"),this.setMode("MODE_TEXT")},Fe.prototype.ccEDM=function(){me.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},Fe.prototype.ccCR=function(){me.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},Fe.prototype.ccENM=function(){me.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},Fe.prototype.ccEOC=function(){var t;me.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode&&(t=this.displayedMemory,this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,me.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())),this.outputDataUpdate(!0)},Fe.prototype.ccTO=function(t){me.log("INFO","TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)},Fe.prototype.ccMIDROW=function(t){var e={flash:!1};e.underline=t%2==1,e.italics=46<=t,e.italics?e.foreground="white":(t=Math.floor(t/2)-16,e.foreground=["white","green","blue","cyan","red","yellow","magenta"][t]),me.log("INFO","MIDROW: "+JSON.stringify(e)),this.writeScreen.setPen(e)},Fe.prototype.outputDataUpdate=function(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],e=me.time;null!==e&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),!0===t&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue()),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))},Fe.prototype.cueSplitAtTime=function(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))},Fe),Ae=(xe.prototype.getHandler=function(t){return this.channels[t].getHandler()},xe.prototype.setHandler=function(t,e){this.channels[t].setHandler(e)},xe.prototype.addData=function(t,e){var r,i,a,n=!1;this.lastTime=t,me.setTime(t);for(var o=0;o<e.length;o+=2)i=127&e[o],a=127&e[o+1],0!=i||0!=a?(me.log("DATA","["+re([e[o],e[o+1]])+"] -> ("+re([i,a])+")"),!(r=(r=(r=(r=this.parseCmd(i,a))||this.parseMidrow(i,a))||this.parsePAC(i,a))||this.parseBackgroundAttributes(i,a))&&(n=this.parseChars(i,a))&&(this.currChNr&&0<=this.currChNr?this.channels[this.currChNr-1].insertChars(n):me.log("WARNING","No channel found yet. TEXT-MODE?")),r?this.dataCounters.cmd+=2:n?this.dataCounters.char+=2:(this.dataCounters.other+=2,me.log("WARNING","Couldn't parse cleaned data "+re([i,a])+" orig: "+re([e[o],e[o+1]])))):this.dataCounters.padding+=2},xe.prototype.parseCmd=function(t,e){var r=null;if(!((20===t||28===t)&&32<=e&&e<=47)&&!((23===t||31===t)&&33<=e&&e<=35))return!1;if(t===this.lastCmdA&&e===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,me.log("DEBUG","Repeated command ("+re([t,e])+") is dropped"),!0;var i=this.channels[(r=20===t||23===t?1:2)-1];return 20===t||28===t?32===e?i.ccRCL():33===e?i.ccBS():34===e?i.ccAOF():35===e?i.ccAON():36===e?i.ccDER():37===e?i.ccRU(2):38===e?i.ccRU(3):39===e?i.ccRU(4):40===e?i.ccFON():41===e?i.ccRDC():42===e?i.ccTR():43===e?i.ccRTD():44===e?i.ccEDM():45===e?i.ccCR():46===e?i.ccENM():47===e&&i.ccEOC():i.ccTO(e-32),this.lastCmdA=t,this.lastCmdB=e,this.currChNr=r,!0},xe.prototype.parseMidrow=function(t,e){var r;return(17===t||25===t)&&32<=e&&e<=47&&((r=17===t?1:2)!==this.currChNr?(me.log("ERROR","Mismatch channel in midrow parsing"),!1):(this.channels[r-1].ccMIDROW(e),me.log("DEBUG","MIDROW ("+re([t,e])+")"),!0))},xe.prototype.parsePAC=function(t,e){if(!((17<=t&&t<=23||25<=t&&t<=31)&&64<=e&&e<=127)&&!((16===t||24===t)&&64<=e&&e<=95))return!1;if(t===this.lastCmdA&&e===this.lastCmdB)return this.lastCmdA=null,!(this.lastCmdB=null);var r=t<=23?1:2,i=this.interpretPAC((64<=e&&e<=95?1==r?ce:pe:1==r?fe:ge)[t],e);return this.channels[r-1].setPAC(i),this.lastCmdA=t,this.lastCmdB=e,this.currChNr=r,!0},xe.prototype.interpretPAC=function(t,e){var r=e,t={color:null,italics:!1,indent:null,underline:!1,row:t};return t.underline=1==(1&(r=95<e?e-96:e-64)),r<=13?t.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(t.italics=!0,t.color="white"):t.indent=4*Math.floor((r-16)/2),t},xe.prototype.parseChars=function(t,e){var r,i=null,a=null,n=null;return 17<=(n=25<=t?(i=2,t-8):(i=1,t))&&n<=19?(r=e,me.log("INFO","Special char '"+ee(r=17===n?e+80:18===n?e+112:e+144)+"' in channel "+i),a=[r]):32<=t&&t<=127&&(a=0===e?[t]:[t,e]),a&&(e=re(a),me.log("DEBUG","Char codes =  "+e.join(",")),this.lastCmdA=null,this.lastCmdB=null),a},xe.prototype.parseBackgroundAttributes=function(t,e){var r,i;return!(!((16===t||24===t)&&32<=e&&e<=47)&&!((23===t||31===t)&&45<=e&&e<=47)||(r={},16===t||24===t?(i=Math.floor((e-32)/2),r.background=ye[i],e%2==1&&(r.background=r.background+"_semi")):45===e?r.background="transparent":(r.foreground="black",47===e&&(r.underline=!0)),this.channels[(t<24?1:2)-1].setBkgData(r),this.lastCmdA=null,this.lastCmdB=null))},xe.prototype.reset=function(){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].reset();this.lastCmdA=null,this.lastCmdB=null},xe.prototype.cueSplitAtTime=function(t){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].cueSplitAtTime(t)},xe),Se=(Pe.prototype.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues("textTrack"+this.track,this.startTime,this.endTime,this.screen),this.startTime=null)},Pe.prototype.newCue=function(t,e,r){(null===this.startTime||this.startTime>t)&&(this.startTime=t),this.endTime=e,this.screen=r,this.timelineController.createCaptionsTrack(this.track)},Pe),Le={parse:function(t,n,i,a,e,r){var t=Object(yt.b)(new Uint8Array(t)).trim().replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n"),o="00:00.000",s=0,l=0,u=0,d=[],h=void 0,c=!0,f=new le;f.oncue=function(t){var e=i[a],r=i.ccOffset;e&&e.new&&(void 0!==l?r=i.ccOffset=e.start:function(t,e,r){var i=t[e],a=t[i.prevCC];if(!a||!a.new&&i.new)return t.ccOffset=t.presentationOffset=i.start,i.new=!1;for(;a&&a.new;)t.ccOffset+=i.start-a.start,i.new=!1,a=t[(i=a).prevCC];t.presentationOffset=r}(i,a,u)),u&&(r=u+i.ccOffset-i.presentationOffset),t.startTime+=r-l,t.endTime+=r-l,t.id=ae(t.startTime.toString())+ae(t.endTime.toString())+ae(t.text),t.text=decodeURIComponent(encodeURIComponent(t.text)),0<t.endTime&&d.push(t)},f.onparsingerror=function(t){h=t},f.onflush=function(){h&&r?r(h):e(d)},t.forEach(function(e){if(c){if(ie(e,"X-TIMESTAMP-MAP=")){c=!1,e.substr(16).split(",").forEach(function(t){ie(t,"LOCAL:")?o=t.substr(6):ie(t,"MPEGTS:")&&(s=parseInt(t.substr(7)))});try{s-=n=n<0?n+8589934592:n,t=o,r=parseInt(t.substr(-3)),i=parseInt(t.substr(-6,2)),a=parseInt(t.substr(-9,2)),t=9<t.length?parseInt(t.substr(0,t.indexOf(":"))):0,l=(isNaN(r)||isNaN(i)||isNaN(a)||isNaN(t)?-1:(r+=1e3*i,(r+=6e4*a)+36e5*t))/1e3,u=s/9e4,-1===l&&(h=new Error("Malformed X-TIMESTAMP-MAP: "+e))}catch(t){h=new Error("Malformed X-TIMESTAMP-MAP: "+e)}return}""===e&&(c=!1)}var t,r,i,a;f.parse(e+"\n")}),f.flush()}},ht=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(Ce,se=j),Ce.prototype.addCues=function(t,e,r,i){for(var a,n,o=this.cueRanges,s=!1,l=o.length;l--;){var u=o[l],d=(a=u[0],n=u[1],d=e,Math.min(n,r)-Math.max(a,d));if(0<=d&&(u[0]=Math.min(u[0],e),u[1]=Math.max(u[1],r),s=!0,.5<d/(r-e)))return}s||o.push([e,r]),this.Cues.newCue(this[t],e,r,i)},Ce.prototype.onInitPtsFound=function(t){var e=this;void 0===this.initPTS&&(this.initPTS=t.initPTS),this.unparsedVttFrags.length&&(this.unparsedVttFrags.forEach(function(t){e.onFragLoaded(t)}),this.unparsedVttFrags=[])},Ce.prototype.getExistingTrack=function(t){var e=this.media;if(e)for(var r=0;r<e.textTracks.length;r++){var i=e.textTracks[r];if(!0===i["textTrack"+t])return i}return null},Ce.prototype.sendAddTrackEvent=function(t,e){var r=null;try{r=new window.Event("addtrack")}catch(t){(r=document.createEvent("Event")).initEvent("addtrack",!1,!1)}r.track=t,e.dispatchEvent(r)},Ce.prototype.createCaptionsTrack=function(t){var e,r="textTrack"+t;this[r]||((e=this.getExistingTrack(t))?(this[r]=e,b(this[r]),this.sendAddTrackEvent(this[r],this.media)):(t=this.createTextTrack("captions",this.config["captionsTextTrack"+t+"Label"],this.config.captionsTextTrack1LanguageCode))&&(t[r]=!0,this[r]=t))},Ce.prototype.createTextTrack=function(t,e,r){var i=this.media;if(i)return i.addTextTrack(t,e,r)},Ce.prototype.destroy=function(){j.prototype.destroy.call(this)},Ce.prototype.onMediaAttaching=function(t){this.media=t.media,this._cleanTracks()},Ce.prototype.onMediaDetaching=function(){b(this.textTrack1),b(this.textTrack2)},Ce.prototype.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0},this._cleanTracks()},Ce.prototype._cleanTracks=function(){var t=this.media;if(t){var e=t.textTracks;if(e)for(var r=0;r<e.length;r++)b(e[r])}},Ce.prototype.onManifestLoaded=function(t){var n,o=this;this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=void 0,this.cueRanges=[],this.config.enableWebVTT&&(this.tracks=t.subtitles||[],n=this.media?this.media.textTracks:[],this.tracks.forEach(function(t,e){var r,i,a=void 0;e<n.length&&(r=n[e],i=t,!(e=r)||e.label!==i.name||e.textTrack1||e.textTrack2||(a=r)),(a=a||o.createTextTrack("subtitles",t.name,t.lang)).mode=t.default?"showing":"hidden",o.textTracks.push(a)}))},Ce.prototype.onLevelSwitching=function(){this.enabled="NONE"!==this.hls.currentLevel.closedCaptions},Ce.prototype.onFragLoaded=function(t){var e,r,i=t.frag,a=t.payload;"main"===i.type?((r=i.sn)===this.lastSn+1||(e=this.cea608Parser)&&e.reset(),this.lastSn=r):"subtitle"===i.type&&(a.byteLength?void 0!==this.initPTS?null!=(r=i.decryptdata)&&null!=r.key&&"AES-128"===r.method||this._parseVTTs(i,a):this.unparsedVttFrags.push(t):this.hls.trigger(M.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i}))},Ce.prototype._parseVTTs=function(e,t){var r=this.vttCCs;r[e.cc]||(r[e.cc]={start:e.start,prevCC:this.prevCC,new:!0},this.prevCC=e.cc);var a=this.textTracks,n=this.hls;Le.parse(t,this.initPTS,r,e.cc,function(t){var i=a[e.trackId];t.forEach(function(e){if(!i.cues.getCueById(e.id))try{i.addCue(e)}catch(t){var r=new window.TextTrackCue(e.startTime,e.endTime,e.text);r.id=e.id,i.addCue(r)}}),n.trigger(M.a.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(t){B.b.log("Failed to parse VTT cue: "+t),n.trigger(M.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})})},Ce.prototype.onFragDecrypted=function(t){var e=t.payload,r=t.frag;"subtitle"===r.type&&(void 0!==this.initPTS?this._parseVTTs(r,e):this.unparsedVttFrags.push(t))},Ce.prototype.onFragParsingUserdata=function(t){if(this.enabled&&this.config.enableCEA708Captions)for(var e=0;e<t.samples.length;e++){var r=this.extractCea608Data(t.samples[e].bytes);this.cea608Parser.addData(t.samples[e].pts,r)}},Ce.prototype.extractCea608Data=function(t){for(var e,r,i,a=31&t[0],n=2,o=[],s=0;s<a;s++)e=t[n++],r=127&t[n++],i=127&t[n++],0==r&&0==i||0!=(4&e)&&0==(3&e)&&(o.push(r),o.push(i));return o},Ce),Et=function(t,e,r){return e&&Oe(t.prototype,e),r&&Oe(t,r),t},Et=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(ke,oe=j),ke.prototype._onTextTracksChanged=function(){if(this.media){for(var t=-1,e=E(this.media.textTracks),r=0;r<e.length;r++)"showing"===e[r].mode&&(t=r);this.subtitleTrack=t}},ke.prototype.destroy=function(){j.prototype.destroy.call(this)},ke.prototype.onMediaAttached=function(t){var e=this;this.media=t.media,this.media&&(void 0!==this.queuedDefaultTrack&&(this.subtitleTrack=this.queuedDefaultTrack,delete this.queuedDefaultTrack),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval(function(){e.trackChangeListener()},500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},ke.prototype.onMediaDetaching=function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),this.media=void 0)},ke.prototype.onManifestLoading=function(){this.tracks=[],this.trackId=-1},ke.prototype.onManifestLoaded=function(t){var e=this,t=t.subtitles||[];this.tracks=t,this.trackId=-1,this.hls.trigger(M.a.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:t}),t.forEach(function(t){t.default&&(e.media?e.subtitleTrack=t.id:e.queuedDefaultTrack=t.id)})},ke.prototype.onTick=function(){var t,e=this.trackId,r=this.tracks[e];r&&(void 0!==(t=r.details)&&!0!==t.live||(B.b.log("(re)loading playlist for subtitle track "+e),this.hls.trigger(M.a.SUBTITLE_TRACK_LOADING,{url:r.url,id:e})))},ke.prototype.onSubtitleTrackLoaded=function(t){var e=this;t.id<this.tracks.length&&(B.b.log("subtitle track "+t.id+" loaded"),this.tracks[t.id].details=t.details,t.details.live&&!this.timer&&(this.timer=setInterval(function(){e.onTick()},1e3*t.details.targetduration,this)),!t.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null))},ke.prototype.setSubtitleTrackInternal=function(t){var e,r;t<-1||t>=this.tracks.length||(this.timer&&(clearInterval(this.timer),this.timer=null),r=E(this.media.textTracks),-1!==this.trackId&&this.subtitleDisplay&&(r[this.trackId].mode="hidden"),this.trackId=t,B.b.log("switching to subtitle track "+t),this.hls.trigger(M.a.SUBTITLE_TRACK_SWITCH,{id:t}),-1!==t&&(e=this.tracks[t],this.subtitleDisplay&&(r[t].mode="showing"),void 0!==(r=e.details)&&!0!==r.live||(B.b.log("(re)loading playlist for subtitle track "+t),this.hls.trigger(M.a.SUBTITLE_TRACK_LOADING,{url:e.url,id:t}))))},Et(ke,[{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.trackId!==t&&this.setSubtitleTrackInternal(t)}}]),ke),_e=r(4),we={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING"},r=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(Ie,ne=j),Ie.prototype.destroy=function(){j.prototype.destroy.call(this),this.state=we.STOPPED},Ie.prototype.clearVttFragQueues=function(){var e=this;this.vttFragQueues={},this.tracks.forEach(function(t){e.vttFragQueues[t.id]=[]})},Ie.prototype.nextFrag=function(){var t;null===this.currentlyProcessing&&-1<this.currentTrackId&&this.vttFragQueues[this.currentTrackId].length&&(t=this.currentlyProcessing=this.vttFragQueues[this.currentTrackId].shift(),this.fragCurrent=t,this.hls.trigger(M.a.FRAG_LOADING,{frag:t}),this.state=we.FRAG_LOADING)},Ie.prototype.onSubtitleFragProcessed=function(t){t.success&&this.vttFragSNsProcessed[t.frag.trackId].push(t.frag.sn),this.currentlyProcessing=null,this.state=we.IDLE,this.nextFrag()},Ie.prototype.onMediaAttached=function(){this.state=we.IDLE},Ie.prototype.onError=function(t){t=t.frag;t&&"subtitle"!==t.type||this.currentlyProcessing&&(this.currentlyProcessing=null,this.nextFrag())},Ie.prototype.tick=function(){var t=this;1==++this.ticks&&(this.doTick(),1<this.ticks&&setTimeout(function(){t.tick()},1),this.ticks=0)},Ie.prototype.doTick=function(){var r=this;switch(this.state){case we.IDLE:var t,e=this.tracks,i=this.currentTrackId,a=this.vttFragSNsProcessed[i],n=this.vttFragQueues[i],o=this.currentlyProcessing?this.currentlyProcessing.sn:-1;if(!e)break;if(void 0===(t=i<e.length?e[i].details:t))break;t.fragments.forEach(function(t){var e;-1<a.indexOf(t.sn)||t.sn===o||(e=t,n.some(function(t){return t.sn===e.sn}))||(t.decryptdata&&null!=t.decryptdata.uri&&null==t.decryptdata.key?(B.b.log("Loading key for "+t.sn),r.state=we.KEY_LOADING,r.hls.trigger(M.a.KEY_LOADING,{frag:t})):(t.trackId=i,n.push(t),r.nextFrag()))})}},Ie.prototype.onSubtitleTracksUpdated=function(t){var e=this;B.b.log("subtitle tracks updated"),this.tracks=t.subtitleTracks,this.clearVttFragQueues(),this.vttFragSNsProcessed={},this.tracks.forEach(function(t){e.vttFragSNsProcessed[t.id]=[]})},Ie.prototype.onSubtitleTrackSwitch=function(t){this.currentTrackId=t.id,this.clearVttFragQueues()},Ie.prototype.onSubtitleTrackLoaded=function(){this.tick()},Ie.prototype.onKeyLoaded=function(){this.state===we.KEY_LOADING&&(this.state=we.IDLE,this.tick())},Ie.prototype.onFragLoaded=function(t){var r,e=this.fragCurrent,i=t.frag.decryptdata,a=t.frag,n=this.hls;if(this.state===we.FRAG_LOADING&&e&&"subtitle"===t.frag.type&&e.sn===t.frag.sn&&0<t.payload.byteLength&&null!=i&&null!=i.key&&"AES-128"===i.method){try{r=performance.now()}catch(t){r=Date.now()}this.decrypter.decrypt(t.payload,i.key.buffer,i.iv.buffer,function(t){var e;try{e=performance.now()}catch(t){e=Date.now()}n.trigger(M.a.FRAG_DECRYPTED,{frag:a,payload:t,stats:{tstart:r,tdecrypt:e}})})}},Ie),De={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,maxSeekHole:2,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,fragLoadingLoopThreshold:3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:ot,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,fetchSetup:void 0,abrController:Tt,bufferController:At,capLevelController:Y,fpsController:at,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0};function Ie(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,Ie);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,ne.call(this,t,M.a.MEDIA_ATTACHED,M.a.ERROR,M.a.KEY_LOADED,M.a.FRAG_LOADED,M.a.SUBTITLE_TRACKS_UPDATED,M.a.SUBTITLE_TRACK_SWITCH,M.a.SUBTITLE_TRACK_LOADED,M.a.SUBTITLE_FRAG_PROCESSED));return e.config=t.config,e.vttFragSNsProcessed={},e.vttFragQueues=void 0,e.currentlyProcessing=null,e.state=we.STOPPED,e.currentTrackId=-1,e.ticks=0,e.decrypter=new _e.a(t.observer,t.config),e}function ke(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,ke);t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,oe.call(this,t,M.a.MEDIA_ATTACHED,M.a.MEDIA_DETACHING,M.a.MANIFEST_LOADING,M.a.MANIFEST_LOADED,M.a.SUBTITLE_TRACK_LOADED));return t.tracks=[],t.trackId=-1,t.media=void 0,t.subtitleDisplay=!1,t}function Oe(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Ce(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,Ce);var e,r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,se.call(this,t,M.a.MEDIA_ATTACHING,M.a.MEDIA_DETACHING,M.a.FRAG_PARSING_USERDATA,M.a.FRAG_DECRYPTED,M.a.MANIFEST_LOADING,M.a.MANIFEST_LOADED,M.a.FRAG_LOADED,M.a.LEVEL_SWITCHING,M.a.INIT_PTS_FOUND));return r.hls=t,r.config=t.config,r.enabled=!0,r.Cues=t.config.cueHandler,r.textTracks=[],r.tracks=[],r.unparsedVttFrags=[],r.initPTS=void 0,r.cueRanges=[],r.config.enableCEA708Captions&&(e=new Se(r,1),t=new Se(r,2),r.cea608Parser=new Ae(0,e,t)),r}function Pe(t,e){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,Pe),this.timelineController=t,this.track=e,this.startTime=null,this.endTime=null,this.screen=null}function xe(t,e,r){v(this,xe),this.field=t||1,this.outputs=[e,r],this.channels=[new Re(1,e),new Re(2,r)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}function Fe(t,e){v(this,Fe),this.chNr=t,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new Te,this.nonDisplayedMemory=new Te,this.lastOutputScreen=new Te,this.currRollUpRow=this.displayedMemory.rows[de-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}function Ne(){v(this,Ne),this.rows=[];for(var t=0;t<de;t++)this.rows.push(new Ee);this.currRow=de-1,this.nrRollUpRows=null,this.reset()}function Me(){v(this,Me),this.chars=[];for(var t=0;t<he;t++)this.chars.push(new be);this.pos=0,this.currPenState=new ve}function Ue(t,e,r,i,a,n){v(this,Ue),this.uchar=t||" ",this.penState=new ve(e,r,i,a,n)}function Be(t,e,r,i,a){v(this,Be),this.foreground=t||"white",this.underline=e||!1,this.italics=r||!1,this.background=i||"black",this.flash=a||!1}De.subtitleStreamController=r,De.subtitleTrackController=Et,De.timelineController=ht,De.cueHandler=T,De.enableCEA708Captions=!0,De.enableWebVTT=!0,De.captionsTextTrack1Label="English",De.captionsTextTrack1LanguageCode="en",De.captionsTextTrack2Label="Spanish",De.captionsTextTrack2LanguageCode="es",De.audioStreamController=F,De.audioTrackController=pt;pt=function(t,e,r){return e&&je(t.prototype,e),r&&je(t,r),t},Ge.isSupported=function(){return t=a(),e=window.SourceBuffer||window.WebKitSourceBuffer,t=t&&"function"==typeof t.isTypeSupported&&t.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),e=!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove,!!t&&!!e;var t,e},pt(Ge,null,[{key:"version",get:function(){return"0.8.9"}},{key:"Events",get:function(){return M.a}},{key:"ErrorTypes",get:function(){return U.b}},{key:"ErrorDetails",get:function(){return U.a}},{key:"DefaultConfig",get:function(){return Ge.defaultConfig||De},set:function(t){Ge.defaultConfig=t}}]),Ge.prototype.destroy=function(){B.b.log("destroy"),this.trigger(M.a.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(t){t.destroy()}),this.url=null,this.observer.removeAllListeners(),this._autoLevelCapping=-1},Ge.prototype.attachMedia=function(t){B.b.log("attachMedia"),this.media=t,this.trigger(M.a.MEDIA_ATTACHING,{media:t})},Ge.prototype.detachMedia=function(){B.b.log("detachMedia"),this.trigger(M.a.MEDIA_DETACHING),this.media=null},Ge.prototype.loadSource=function(t){t=N.a.buildAbsoluteURL(window.location.href,t,{alwaysNormalize:!0}),B.b.log("loadSource:"+t),this.url=t,this.trigger(M.a.MANIFEST_LOADING,{url:t})},Ge.prototype.startLoad=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:-1;B.b.log("startLoad("+e+")"),this.networkControllers.forEach(function(t){t.startLoad(e)})},Ge.prototype.stopLoad=function(){B.b.log("stopLoad"),this.networkControllers.forEach(function(t){t.stopLoad()})},Ge.prototype.swapAudioCodec=function(){B.b.log("swapAudioCodec"),this.streamController.swapAudioCodec()},Ge.prototype.recoverMediaError=function(){B.b.log("recoverMediaError");var t=this.media;this.detachMedia(),this.attachMedia(t)},pt(Ge,[{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(t){B.b.log("set currentLevel:"+t),this.loadLevel=t,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(t){B.b.log("set nextLevel:"+t),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(t){B.b.log("set loadLevel:"+t),this.levelController.manualLevel=t}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(t){this.levelController.nextLoadLevel=t}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(t){B.b.log("set firstLevel:"+t),this.levelController.firstLevel=t}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(t){B.b.log("set startLevel:"+t);-1!==t&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(t){B.b.log("set autoLevelCapping:"+t),this._autoLevelCapping=t}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var t=this.levels,e=this.config.minAutoBitrate,r=t?t.length:0,i=0;i<r;i++)if((t[i].realBitrate?Math.max(t[i].realBitrate,t[i].bitrate):t[i].bitrate)>e)return i;return 0}},{key:"maxAutoLevel",get:function(){var t=this.levels,e=this.autoLevelCapping;return-1===e&&t&&t.length?t.length-1:e}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(t){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,t)}},{key:"audioTracks",get:function(){var t=this.audioTrackController;return t?t.audioTracks:[]}},{key:"audioTrack",get:function(){var t=this.audioTrackController;return t?t.audioTrack:-1},set:function(t){var e=this.audioTrackController;e&&(e.audioTrack=t)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTrack:-1},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleTrack=t)}},{key:"subtitleDisplay",get:function(){var t=this.subtitleTrackController;return!!t&&t.subtitleDisplay},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleDisplay=t)}}]),pt=Ge;function Ge(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,Ge);var r,i=Ge.DefaultConfig;if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(r in i)r in t||(t[r]=i[r]);if(void 0!==t.liveMaxLatencyDurationCount&&t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(t.liveMaxLatencyDuration<=t.liveSyncDuration||void 0===t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');Object(B.a)(t.debug),this.config=t,this._autoLevelCapping=-1;var a=this.observer=new nt.a;a.trigger=function(t){for(var e=arguments.length,r=Array(1<e?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];a.emit.apply(a,[t,t].concat(r))},a.off=function(t){for(var e=arguments.length,r=Array(1<e?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];a.removeListener.apply(a,[t].concat(r))},this.on=a.on.bind(a),this.off=a.off.bind(a),this.trigger=a.trigger.bind(a);var n=this.abrController=new t.abrController(this),o=new t.bufferController(this),s=new t.capLevelController(this),l=new t.fpsController(this),u=new $(this),d=new Z(this),h=new tt(this),c=new mt(this),f=[this.levelController=new gt(this),this.streamController=new ft(this)],p=t.audioStreamController;p&&f.push(new p(this)),this.networkControllers=f;var g=[u,d,h,n,o,s,l,c];(p=t.audioTrackController)&&(c=new p(this),this.audioTrackController=c,g.push(c)),(p=t.subtitleTrackController)&&(p=new p(this),this.subtitleTrackController=p,g.push(p)),[t.subtitleStreamController,t.timelineController].forEach(function(t){t&&g.push(new t(e))}),this.coreComponents=g}function je(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}e.default=pt},function(t,e,a){function n(t,e){for(var r=[e],i=[],a={};r.length;){var n=r.pop();!a[n]&&t[n]&&(a[n]=!0,i.push(n),n=function(t){var e=[],r=t.toString();if(!(t=r.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/)))return e;for(var i,t=t[1],a=new RegExp("(\\\\n|\\W)"+(t+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")+"\\((/\\*.*?\\*/)?s?.*?([\\.|\\-|\\w|/|@]+).*?\\)","g");i=a.exec(r);)e.push(i[3]);return e}(t[n]),r=r.concat(n))}return i}t.exports=function(t,e){var r=a.m,i=(e=e||{}).all?Object.keys(r):n(r,t),i="("+function(r){function i(t){if(a[t])return a[t].exports;var e=a[t]={i:t,l:!1,exports:{}};return r[t].call(e.exports,e,e.exports,i),e.l=!0,e.exports}var a={};i.m=r,i.c=a,i.i=function(t){return t},i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/",i.oe=function(t){throw console.error(t),t};var t=i(i.s=ENTRY_MODULE);return t.default||t}.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+i.map(function(t){return JSON.stringify(t)+": "+r[t].toString()}).join(",")+"})(self);",i=new window.Blob([i],{type:"text/javascript"});if(e.bare)return i;e=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(i),i=new window.Worker(e);return i.objectURL=e,i}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=r(7),s=r(1),l=r(0),i=r(5),u=r.n(i);e.default=function(i){var a=new u.a;a.trigger=function(t){for(var e=arguments.length,r=Array(1<e?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];a.emit.apply(a,[t,t].concat(r))},a.off=function(t){for(var e=arguments.length,r=Array(1<e?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];a.removeListener.apply(a,[t].concat(r))};function n(t,e){i.postMessage({event:t,data:e})}i.addEventListener("message",function(t){var e=t.data;switch(e.cmd){case"init":var r=JSON.parse(e.config);i.demuxer=new o.a(a,e.typeSupported,r,e.vendor);try{Object(l.a)(!0===r.debug)}catch(t){console.warn("demuxerWorker: unable to enable logs")}n("init",null);break;case"demux":i.demuxer.push(e.data,e.decryptdata,e.initSegment,e.audioCodec,e.videoCodec,e.timeOffset,e.discontinuity,e.trackSwitch,e.contiguous,e.duration,e.accurateTimeOffset,e.defaultInitPTS)}}),a.on(s.a.FRAG_DECRYPTED,n),a.on(s.a.FRAG_PARSING_INIT_SEGMENT,n),a.on(s.a.FRAG_PARSED,n),a.on(s.a.ERROR,n),a.on(s.a.FRAG_PARSING_METADATA,n),a.on(s.a.FRAG_PARSING_USERDATA,n),a.on(s.a.INIT_PTS_FOUND,n),a.on(s.a.FRAG_PARSING_DATA,function(t,e){var r=[],t={event:t,data:e};e.data1&&(t.data1=e.data1.buffer,r.push(e.data1.buffer),delete e.data1),e.data2&&(t.data2=e.data2.buffer,r.push(e.data2.buffer),delete e.data2),i.postMessage(t,r)})}}]).default},function(t,e){t.exports=r},function(t,e,r){"use strict";function i(t,i){function e(){var e=null,r=null;return function(){var t=Date.now();!e||2e3<t-e?(e=t,o.recoverMediaError()):!r||2e3<t-r?(r=t,o.swapAudioCodec(),o.recoverMediaError()):console.error("Error loading media: File could not be played")}}var r=i.options_,a=i.el(),n=null,o=this.hls=new u(r.hlsjsConfig),s=e(),l=e();a.addEventListener("error",function(t){t=t.currentTarget.error;t.code===t.MEDIA_ERR_DECODE?l():console.error("Error loading media: File could not be played")}),this.dispose=function(){o.destroy()},this.duration=function(){return n||a.duration||0},o.on(u.Events.LEVEL_LOADED,function(t,e){n=e.details.live?1/0:e.details.totalduration}),o.on(u.Events.ERROR,function(t,e){if(e.fatal)switch(e.type){case u.ErrorTypes.NETWORK_ERROR:o.startLoad();break;case u.ErrorTypes.MEDIA_ERROR:s();break;default:console.error("Error loading media: File could not be played")}}),Object.keys(u.Events).forEach(function(t){var r=u.Events[t];o.on(r,function(t,e){i.trigger(r,e)})}),i.featuresNativeTextTracks||(Object.defineProperty(a,"textTracks",{value:i.textTracks,writable:!1}),a.addTextTrack=function(){return i.addTextTrack.apply(i,arguments)}),o.attachMedia(a),o.loadSource(t.src)}var u=r(0);window.Hls||(window.Hls=u);var a,n=/^application\/(x-mpegURL|vnd\.apple\.mpegURL)$/i,o=/\.m3u8/i,s={canHandleSource:function(t){return t.skipContribHlsJs?"":n.test(t.type)?"probably":o.test(t.src)?"maybe":""},handleSource:function(t,e){return new i(t,e)},canPlayType:function(t){return n.test(t)?"probably":""}};u.isSupported()&&((a=(a=r(1))&&a.default||a)?(r=(r=a.getTech&&a.getTech("Html5"))||a.getComponent&&a.getComponent("Html5"))&&r.registerSourceHandler(s,0):console.warn("videojs-contrib-hls.js: Couldn't find find window.videojs nor require('video.js')"))}],n={},i.m=a,i.c=n,i.i=function(t){return t},i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=2);function i(t){if(n[t])return n[t].exports;var e=n[t]={i:t,l:!1,exports:{}};return a[t].call(e.exports,e,e.exports,i),e.l=!0,e.exports}var a,n});